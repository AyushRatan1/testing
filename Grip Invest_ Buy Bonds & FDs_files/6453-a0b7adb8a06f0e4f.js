"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6453],{46453:function(t,e,i){i.d(e,{O:function(){return l}});class r{scaleDown(t){let e=this.getWidth(),i=this.getHeight(),r=1;if(t.maxDimension>0){let n=Math.max(e,i);n>t.maxDimension&&(r=t.maxDimension/n)}else r=1/t.quality;r<1&&this.resize(e*r,i*r,r)}}class n extends r{_getCanvas(){if(!this._canvas)throw Error("Canvas is not initialized");return this._canvas}_getContext(){if(!this._context)throw Error("Context is not initialized");return this._context}_getWidth(){if(!this._width)throw Error("Width is not initialized");return this._width}_getHeight(){if(!this._height)throw Error("Height is not initialized");return this._height}_initCanvas(){let t=this.image;if(!t)throw Error("Image is not initialized");let e=this._canvas=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw ReferenceError("Failed to create canvas context");this._context=i,e.className="@vibrant/canvas",e.style.display="none",this._width=e.width=t.width,this._height=e.height=t.height,i.drawImage(t,0,0),document.body.appendChild(e)}load(t){let e,i;if("string"==typeof t)e=document.createElement("img"),!function(t){let e=new URL(t,location.href);return e.protocol===location.protocol&&e.host===location.host&&e.port===location.port}(i=t)&&!function(t,e){let i=new URL(t),r=new URL(e);return i.protocol===r.protocol&&i.hostname===r.hostname&&i.port===r.port}(window.location.href,i)&&(e.crossOrigin="anonymous"),e.src=i;else{if(!(t instanceof HTMLImageElement))return Promise.reject(Error("Cannot load buffer as an image in browser"));e=t,i=t.src}return this.image=e,new Promise((t,r)=>{let n=()=>{this._initCanvas(),t(this)};e.complete?n():(e.onload=n,e.onerror=t=>r(Error(`Fail to load image: ${i}`)))})}clear(){this._getContext().clearRect(0,0,this._getWidth(),this._getHeight())}update(t){this._getContext().putImageData(t,0,0)}getWidth(){return this._getWidth()}getHeight(){return this._getHeight()}resize(t,e,i){if(!this.image)throw Error("Image is not initialized");this._width=this._getCanvas().width=t,this._height=this._getCanvas().height=e,this._getContext().scale(i,i),this._getContext().drawImage(this.image,0,0)}getPixelCount(){return this._getWidth()*this._getHeight()}getImageData(){return this._getContext().getImageData(0,0,this._getWidth(),this._getHeight())}remove(){this._canvas&&this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}}function s(t,...e){return e.forEach(e=>{if(e){for(let i in e)if(e.hasOwnProperty(i)){let r=e[i];Array.isArray(r)?t[i]=r.slice(0):"object"==typeof r?(t[i]||(t[i]={}),s(t[i],r)):t[i]=r}}}),t}class a{constructor(t,e={}){this._src=t,this._opts=s({},l.DefaultOpts,e)}maxColorCount(t){return this._opts.colorCount=t,this}maxDimension(t){return this._opts.maxDimension=t,this}addFilter(t){return this._opts.filters?this._opts.filters.push(t):this._opts.filters=[t],this}removeFilter(t){if(this._opts.filters){let e=this._opts.filters.indexOf(t);e>0&&this._opts.filters.splice(e)}return this}clearFilters(){return this._opts.filters=[],this}quality(t){return this._opts.quality=t,this}useImageClass(t){return this._opts.ImageClass=t,this}useGenerator(t,e){return this._opts.generators||(this._opts.generators=[]),this._opts.generators.push(e?{name:t,options:e}:t),this}useQuantizer(t,e){return this._opts.quantizer=e?{name:t,options:e}:t,this}build(){return new l(this._src,this._opts)}getPalette(){return this.build().getPalette()}}let o=class t{constructor(e,i){this._src=e,this.opts=s({},t.DefaultOpts,i)}static use(t){this._pipeline=t}static from(t){return new a(t)}get result(){return this._result}_process(e,i){e.scaleDown(this.opts);let r=function(t,e){let{colorCount:i,quantizer:r,generators:n,filters:a}=t,o="string"==typeof r?{name:r,options:{}}:r;return o.options=s({},{colorCount:i},o.options),s({},{quantizer:o,generators:n,filters:a},e)}(this.opts,i);return t._pipeline.process(e.getImageData(),r)}async getPalette(){let t=new this.opts.ImageClass;try{let e=await t.load(this._src),i=await this._process(e,{generators:["default"]});this._result=i;let r=i.palettes.default;if(!r)throw Error("Something went wrong and a palette was not found, please file a bug against our GitHub repo: https://github.com/vibrant-Colors/node-vibrant/");return t.remove(),r}catch(e){return t.remove(),Promise.reject(e)}}async getPalettes(){let t=new this.opts.ImageClass;try{let e=await t.load(this._src),i=await this._process(e,{generators:["*"]});this._result=i;let r=i.palettes;return t.remove(),r}catch(e){return t.remove(),Promise.reject(e)}}};o.DefaultOpts={colorCount:64,quality:5,filters:[]};let l=o;function h(t,e,i){let r,n,s;function a(t,e,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?t+(e-t)*6*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}if(0===e)r=n=s=i;else{let o=i<.5?i*(1+e):i+e-i*e,l=2*i-o;r=a(l,o,t+1/3),n=a(l,o,t),s=a(l,o,t-1/3)}return[255*r,255*n,255*s]}l.DefaultOpts.quantizer="mmcq",l.DefaultOpts.generators=["default"],l.DefaultOpts.filters=["default"],l.DefaultOpts.ImageClass=n;class u{static applyFilters(t,e){return e.length>0?t.filter(({r:t,g:i,b:r})=>{var n;for(let s=0;s<e.length;s++)if(!(null==(n=e[s])?void 0:n.call(e,t,i,r,255)))return!1;return!0}):t}static clone(t){return new u(t._rgb,t._population)}get r(){return this._rgb[0]}get g(){return this._rgb[1]}get b(){return this._rgb[2]}get rgb(){return this._rgb}get hsl(){if(!this._hsl){let[t,e,i]=this._rgb;this._hsl=function(t,e,i){let r=Math.max(t/=255,e/=255,i/=255),n=Math.min(t,e,i),s=0,a=0,o=(r+n)/2;if(r!==n){let l=r-n;switch(a=o>.5?l/(2-r-n):l/(r+n),r){case t:s=(e-i)/l+(e<i?6:0);break;case e:s=(i-t)/l+2;break;case i:s=(t-e)/l+4}s/=6}return[s,a,o]}(t,e,i)}return this._hsl}get hex(){if(!this._hex){let[t,e,i]=this._rgb;this._hex="#"+(16777216+(t<<16)+(e<<8)+i).toString(16).slice(1,7)}return this._hex}get population(){return this._population}toJSON(){return{rgb:this.rgb,population:this.population}}getYiq(){if(!this._yiq){let t=this._rgb;this._yiq=(299*t[0]+587*t[1]+114*t[2])/1e3}return this._yiq}get titleTextColor(){return this._titleTextColor||(this._titleTextColor=200>this.getYiq()?"#fff":"#000"),this._titleTextColor}get bodyTextColor(){return this._bodyTextColor||(this._bodyTextColor=150>this.getYiq()?"#fff":"#000"),this._bodyTextColor}constructor(t,e){this._rgb=t,this._population=e}}class g{constructor(t,e){let i,r,n,s,a,o,l,h,u;this.pixels=t,this.opts=e;let{sigBits:g}=e,m=(t,e,i)=>(t<<2*g)+(e<<g)+i;this.getColorIndex=m;let c=8-g,f=new Uint32Array(1<<3*g);i=n=a=0,r=s=o=Number.MAX_VALUE;let _=t.length/4,p=0;for(;p<_;){let e=4*p;if(p++,l=t[e+0],h=t[e+1],u=t[e+2],0===t[e+3])continue;let g=m(l>>=c,h>>=c,u>>=c);void 0===f[g]&&(f[g]=0),f[g]+=1,l>i&&(i=l),l<r&&(r=l),h>n&&(n=h),h<s&&(s=h),u>a&&(a=u),u<o&&(o=u)}this._colorCount=f.reduce((t,e)=>e>0?t+1:t,0),this.hist=f,this.rmax=i,this.rmin=r,this.gmax=n,this.gmin=s,this.bmax=a,this.bmin=o}get colorCount(){return this._colorCount}}class m{constructor(t,e,i,r,n,s,a){this.histogram=a,this._volume=-1,this._avg=null,this._count=-1,this.dimension={r1:t,r2:e,g1:i,g2:r,b1:n,b2:s}}static build(t){let e=new g(t,{sigBits:5}),{rmin:i,rmax:r,gmin:n,gmax:s,bmin:a,bmax:o}=e;return new m(i,r,n,s,a,o,e)}invalidate(){this._volume=this._count=-1,this._avg=null}volume(){if(this._volume<0){let{r1:t,r2:e,g1:i,g2:r,b1:n,b2:s}=this.dimension;this._volume=(e-t+1)*(r-i+1)*(s-n+1)}return this._volume}count(){if(this._count<0){let{hist:t,getColorIndex:e}=this.histogram,{r1:i,r2:r,g1:n,g2:s,b1:a,b2:o}=this.dimension,l=0;for(let h=i;h<=r;h++)for(let i=n;i<=s;i++)for(let r=a;r<=o;r++){let n=e(h,i,r);t[n]&&(l+=t[n])}this._count=l}return this._count}clone(){let{histogram:t}=this,{r1:e,r2:i,g1:r,g2:n,b1:s,b2:a}=this.dimension;return new m(e,i,r,n,s,a,t)}avg(){if(!this._avg){let t,e,i;let{hist:r,getColorIndex:n}=this.histogram,{r1:s,r2:a,g1:o,g2:l,b1:h,b2:u}=this.dimension,g=0;t=e=i=0;for(let m=s;m<=a;m++)for(let s=o;s<=l;s++)for(let a=h;a<=u;a++){let o=r[n(m,s,a)];o&&(g+=o,t+=o*(m+.5)*8,e+=o*(s+.5)*8,i+=o*(a+.5)*8)}g?this._avg=[~~(t/g),~~(e/g),~~(i/g)]:this._avg=[~~(8*(s+a+1)/2),~~(8*(o+l+1)/2),~~(8*(h+u+1)/2)]}return this._avg}contains(t){let[e,i,r]=t,{r1:n,r2:s,g1:a,g2:o,b1:l,b2:h}=this.dimension;return i>>=3,r>>=3,(e>>=3)>=n&&e<=s&&i>=a&&i<=o&&r>=l&&r<=h}split(){let t,e;let{hist:i,getColorIndex:r}=this.histogram,{r1:n,r2:s,g1:a,g2:o,b1:l,b2:h}=this.dimension,u=this.count();if(!u)return[];if(1===u)return[this.clone()];let g=s-n+1,m=o-a+1,c=Math.max(g,m,h-l+1),f=null;t=e=0;let _=null;if(c===g){_="r",f=new Uint32Array(s+1);for(let u=n;u<=s;u++){t=0;for(let e=a;e<=o;e++)for(let n=l;n<=h;n++){let s=r(u,e,n);i[s]&&(t+=i[s])}e+=t,f[u]=e}}else if(c===m){_="g",f=new Uint32Array(o+1);for(let u=a;u<=o;u++){t=0;for(let e=n;e<=s;e++)for(let n=l;n<=h;n++){let s=r(e,u,n);i[s]&&(t+=i[s])}e+=t,f[u]=e}}else{_="b",f=new Uint32Array(h+1);for(let u=l;u<=h;u++){t=0;for(let e=n;e<=s;e++)for(let n=a;n<=o;n++){let s=r(e,n,u);i[s]&&(t+=i[s])}e+=t,f[u]=e}}let p=-1,d=new Uint32Array(f.length);for(let t=0;t<f.length;t++){let i=f[t];i&&(p<0&&i>e/2&&(p=t),d[t]=e-i)}let b=this;return function(t){let e=t+"1",i=t+"2",r=b.dimension[e],n=b.dimension[i],s=b.clone(),a=b.clone(),o=p-r,l=n-p;for(o<=l?n=Math.max(0,n=Math.min(n-1,~~(p+l/2))):(n=Math.max(r,~~(p-1-o/2)),n=Math.min(b.dimension[i],n));!f[n];)n++;let h=d[n];for(;!h&&f[n-1];)h=d[--n];return s.dimension[i]=n,a.dimension[e]=n+1,[s,a]}(_)}}class c{_sort(){this._sorted||(this.contents.sort(this._comparator),this._sorted=!0)}constructor(t){this._comparator=t,this.contents=[],this._sorted=!1}push(t){this.contents.push(t),this._sorted=!1}peek(t){return this._sort(),t="number"==typeof t?t:this.contents.length-1,this.contents[t]}pop(){return this._sort(),this.contents.pop()}size(){return this.contents.length}map(t){return this._sort(),this.contents.map(t)}}function f(t,e){let i=t.size();for(;t.size()<e;){let e=t.pop();if(e&&e.count()>0){let[r,n]=e.split();if(!r||(t.push(r),n&&n.count()>0&&t.push(n),t.size()===i))break;i=t.size()}else break}}let _={targetDarkLuma:.26,maxDarkLuma:.45,minLightLuma:.55,targetLightLuma:.74,minNormalLuma:.3,targetNormalLuma:.5,maxNormalLuma:.7,targetMutesSaturation:.3,maxMutesSaturation:.4,targetVibrantSaturation:1,minVibrantSaturation:.35,weightSaturation:3,weightLuma:6.5,weightPopulation:.5};function p(t,e,i,r,n,s,a,o,l,h){let u=null,g=0;return e.forEach(e=>{let[,m,c]=e.hsl;if(m>=o&&m<=l&&c>=n&&c<=s&&t.Vibrant!==e&&t.DarkVibrant!==e&&t.LightVibrant!==e&&t.Muted!==e&&t.DarkMuted!==e&&t.LightMuted!==e){let t=function(t,e,i,r,n,s,a){function o(t,e){return 1-Math.abs(t-e)}return function(...t){let e=0,i=0;for(let r=0;r<t.length;r+=2){let n=t[r],s=t[r+1];n&&s&&(e+=n*s,i+=s)}return e/i}(o(t,e),a.weightSaturation,o(i,r),a.weightLuma,n/s,a.weightPopulation)}(m,a,c,r,e.population,i,h);(null===u||t>g)&&(u=e,g=t)}}),u}class d{constructor(t){this.pipeline=t,this._map={}}names(){return Object.keys(this._map)}has(t){return!!this._map[t]}get(t){return this._map[t]}register(t,e){return this._map[t]=e,this.pipeline}}class b{constructor(){this.filter=new d(this),this.quantizer=new d(this),this.generator=new d(this)}_buildProcessTasks({filters:t,quantizer:e,generators:i}){return 1===i.length&&"*"===i[0]&&(i=this.generator.names()),{filters:t.map(t=>r(this.filter,t)),quantizer:r(this.quantizer,e),generators:i.map(t=>r(this.generator,t))};function r(t,e){let i,r;return"string"==typeof e?i=e:(i=e.name,r=e.options),{name:i,fn:t.get(i),options:r}}}async process(t,e){let{filters:i,quantizer:r,generators:n}=this._buildProcessTasks(e),s=await this._filterColors(i,t),a=await this._generateColors(r,s),o=await this._generatePalettes(n,a);return{colors:a,palettes:o}}_filterColors(t,e){return Promise.resolve(function(t,e){var i;if(e.length>0){let r,n,s,a,o;let l=t.data,h=l.length/4;for(let t=0;t<h;t++){n=l[(r=4*t)+0],s=l[r+1],a=l[r+2],o=l[r+3];for(let t=0;t<e.length;t++)if(!(null==(i=e[t])?void 0:i.call(e,n,s,a,o))){l[r+3]=0;break}}}return t}(e,t.map(({fn:t})=>t)))}_generateColors(t,e){return Promise.resolve(t.fn(e.data,t.options))}async _generatePalettes(t,e){return Promise.resolve((await Promise.all(t.map(({fn:t,options:i})=>Promise.resolve(t(e,i))))).reduce((e,i,r)=>(e[t[r].name]=i,e),{}))}}let w=new b().filter.register("default",(t,e,i,r)=>r>=125&&!(t>250&&e>250&&i>250)).quantizer.register("mmcq",(t,e)=>{if(0===t.length||e.colorCount<2||e.colorCount>256)throw Error("Wrong MMCQ parameters");let i=m.build(t);i.histogram.colorCount;let r=new c((t,e)=>t.count()-e.count());r.push(i),f(r,.75*e.colorCount);let n=new c((t,e)=>t.count()*t.volume()-e.count()*e.volume());return n.contents=r.contents,f(n,e.colorCount-n.size()),function(t){let e=[];for(;t.size();){let i=t.pop(),r=i.avg();e.push(new u(r,i.count()))}return e}(n)}).generator.register("default",(t,e)=>{let i;e=Object.assign({},_,e);let r=(i=0,t.forEach(t=>{i=Math.max(i,t.population)}),i),n=function(t,e,i){let r={Vibrant:null,DarkVibrant:null,LightVibrant:null,Muted:null,DarkMuted:null,LightMuted:null};return r.Vibrant=p(r,t,e,i.targetNormalLuma,i.minNormalLuma,i.maxNormalLuma,i.targetVibrantSaturation,i.minVibrantSaturation,1,i),r.LightVibrant=p(r,t,e,i.targetLightLuma,i.minLightLuma,1,i.targetVibrantSaturation,i.minVibrantSaturation,1,i),r.DarkVibrant=p(r,t,e,i.targetDarkLuma,0,i.maxDarkLuma,i.targetVibrantSaturation,i.minVibrantSaturation,1,i),r.Muted=p(r,t,e,i.targetNormalLuma,i.minNormalLuma,i.maxNormalLuma,i.targetMutesSaturation,0,i.maxMutesSaturation,i),r.LightMuted=p(r,t,e,i.targetLightLuma,i.minLightLuma,1,i.targetMutesSaturation,0,i.maxMutesSaturation,i),r.DarkMuted=p(r,t,e,i.targetDarkLuma,0,i.maxDarkLuma,i.targetMutesSaturation,0,i.maxMutesSaturation,i),r}(t,r,e);return!function(t,e,i){if(!t.Vibrant&&!t.DarkVibrant&&!t.LightVibrant){if(!t.DarkVibrant&&t.DarkMuted){let[e,r,n]=t.DarkMuted.hsl;n=i.targetDarkLuma,t.DarkVibrant=new u(h(e,r,n),0)}if(!t.LightVibrant&&t.LightMuted){let[e,r,n]=t.LightMuted.hsl;n=i.targetDarkLuma,t.DarkVibrant=new u(h(e,r,n),0)}}if(!t.Vibrant&&t.DarkVibrant){let[e,r,n]=t.DarkVibrant.hsl;n=i.targetNormalLuma,t.Vibrant=new u(h(e,r,n),0)}else if(!t.Vibrant&&t.LightVibrant){let[e,r,n]=t.LightVibrant.hsl;n=i.targetNormalLuma,t.Vibrant=new u(h(e,r,n),0)}if(!t.DarkVibrant&&t.Vibrant){let[e,r,n]=t.Vibrant.hsl;n=i.targetDarkLuma,t.DarkVibrant=new u(h(e,r,n),0)}if(!t.LightVibrant&&t.Vibrant){let[e,r,n]=t.Vibrant.hsl;n=i.targetLightLuma,t.LightVibrant=new u(h(e,r,n),0)}if(!t.Muted&&t.Vibrant){let[e,r,n]=t.Vibrant.hsl;n=i.targetMutesSaturation,t.Muted=new u(h(e,r,n),0)}if(!t.DarkMuted&&t.DarkVibrant){let[e,r,n]=t.DarkVibrant.hsl;n=i.targetMutesSaturation,t.DarkMuted=new u(h(e,r,n),0)}if(!t.LightMuted&&t.LightVibrant){let[e,r,n]=t.LightVibrant.hsl;n=i.targetMutesSaturation,t.LightMuted=new u(h(e,r,n),0)}}(n,0,e),n});l.use(w)}}]);