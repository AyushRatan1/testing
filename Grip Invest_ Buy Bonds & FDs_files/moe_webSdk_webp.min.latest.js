/*! For license information please see sdk.webp.js.LICENSE.txt */
(()=>{var e={372:(e,t,n)=>{e.exports=function(e,t,n){if("number"!=typeof t)throw new Error("second argument must be a Number");let i,s,a,o,c,l,u=!0;Array.isArray(e)?(i=[],a=s=e.length):(o=Object.keys(e),i={},a=s=o.length);function d(e){function t(){n&&n(e,i),n=null}u?r(t):t()}function g(t,n,r){if(i[t]=r,n&&(c=!0),0===--a||n)d(n);else if(!c&&l<s){let t;o?(t=o[l],l+=1,e[t](function(e,n){g(t,e,n)})):(t=l,l+=1,e[t](function(e,n){g(t,e,n)}))}}l=t,a?o?o.some(function(n,r){return e[n](function(e,t){g(n,e,t)}),r===t-1}):e.some(function(e,n){return e(function(e,t){g(n,e,t)}),n===t-1}):d(null);u=!1};const r=n(596)},596:(e,t,n)=>{let r;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:n.g):e=>(r||(r=Promise.resolve())).then(e).catch(e=>setTimeout(()=>{throw e},0))},790:(e,t,n)=>{e.exports=function e(t,n,r){function i(a,o){if(!n[a]){if(!t[a]){if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var s=void 0,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,r){(function(e){"use strict";var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var s=0,a=new i(u),o=e.document.createTextNode("");a.observe(o,{characterData:!0}),n=function(){o.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,n=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}function d(e){1!==l.push(e)||r||n()}t.exports=d}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function i(){}var s={},a=["REJECTED"],o=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&p(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r(function(){var r;try{r=t(n)}catch(t){return s.reject(e,t)}r===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,r)})}function g(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var n=!1;function r(t){n||(n=!0,s.reject(e,t))}function i(t){n||(n=!0,s.resolve(e,t))}function a(){t(i,r)}var o=h(a);"error"===o.status&&r(o.value)}function h(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function f(e){return e instanceof this?e:s.resolve(new this(i),e)}function m(e){var t=new this(i);return s.reject(t,e)}function E(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a=new Array(n),o=0,c=-1,l=new this(i);++c<n;)u(e[c],c);return l;function u(e,i){function c(e){a[i]=e,++o!==n||r||(r=!0,s.resolve(l,a))}t.resolve(e).then(c,function(e){r||(r=!0,s.reject(l,e))})}}function _(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a=-1,o=new this(i);++a<n;)c(e[a]);return o;function c(e){t.resolve(e).then(function(e){r||(r=!0,s.resolve(o,e))},function(e){r||(r=!0,s.reject(o,e))})}}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===o||"function"!=typeof t&&this.state===a)return this;var n=new this.constructor(i);return this.state!==c?d(n,this.state===o?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){s.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=h(g,t);if("error"===n.status)return s.reject(e,n.value);var r=n.value;if(r)p(e,r);else{e.state=o,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},s.reject=function(e,t){e.state=a,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=f,l.reject=m,l.all=E,l.race=_},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var a=s();function o(){try{if(!a||!a.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var l=Promise;function u(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function d(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function g(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function p(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h="local-forage-detect-blob-support",f=void 0,m={},E=Object.prototype.toString,_="readonly",v="readwrite";function b(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function T(e){return new l(function(t){var n=e.transaction(h,v),r=c([""]);n.objectStore(h).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}function S(e){return"boolean"==typeof f?l.resolve(f):T(e).then(function(e){return f=e})}function y(e){var t=m[e.name],n={};n.promise=new l(function(e,t){n.resolve=e,n.reject=t}),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then(function(){return n.promise}):t.dbReady=n.promise}function I(e){var t=m[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function A(e,t){var n=m[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function w(e,t){return new l(function(n,r){if(m[e.name]=m[e.name]||x(),e.db){if(!t)return n(e.db);y(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var s=a.open.apply(a,i);t&&(s.onupgradeneeded=function(t){var n=s.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(h)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),s.onerror=function(e){e.preventDefault(),r(s.error)},s.onsuccess=function(){var t=s.result;t.onversionchange=function(e){e.target.close()},n(t),I(e)}})}function O(e){return w(e,!1)}function D(e){return w(e,!0)}function N(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var s=e.db.version+1;s>e.version&&(e.version=s)}return!0}return!1}function R(e){return new l(function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)})}function L(e){return c([b(atob(e.data))],{type:e.type})}function k(e){return e&&e.__local_forage_encoded_blob}function P(e){var t=this,n=t._initReady().then(function(){var e=m[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return d(n,e,e),n}function C(e){y(e);for(var t=m[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,O(e).then(function(t){return e.db=t,N(e)?D(e):t}).then(function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r}).catch(function(t){throw A(e,t),t})}function M(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return l.resolve().then(function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),D(e)}).then(function(){return C(e).then(function(){M(e,t,n,r-1)})}).catch(n);n(i)}}function x(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function U(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=m[n.name];i||(i=x(),m[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=P);var s=[];function a(){return l.resolve()}for(var o=0;o<i.forages.length;o++){var c=i.forages[o];c!==t&&s.push(c._initReady().catch(a))}var u=i.forages.slice(0);return l.all(s).then(function(){return n.db=i.db,O(n)}).then(function(e){return n.db=e,N(n,t._defaultConfig.version)?D(n):e}).then(function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var s=u[r];s!==t&&(s._dbInfo.db=n.db,s._dbInfo.version=n.version)}})}function B(e,t){var n=this;e=g(e);var r=new l(function(t,r){n.ready().then(function(){M(n._dbInfo,_,function(i,s){if(i)return r(i);try{var a=s.objectStore(n._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),k(e)&&(e=L(e)),t(e)},a.onerror=function(){r(a.error)}}catch(e){r(e)}})}).catch(r)});return u(r,t),r}function W(e,t){var n=this,r=new l(function(t,r){n.ready().then(function(){M(n._dbInfo,_,function(i,s){if(i)return r(i);try{var a=s.objectStore(n._dbInfo.storeName).openCursor(),o=1;a.onsuccess=function(){var n=a.result;if(n){var r=n.value;k(r)&&(r=L(r));var i=e(r,n.key,o++);void 0!==i?t(i):n.continue()}else t()},a.onerror=function(){r(a.error)}}catch(e){r(e)}})}).catch(r)});return u(r,t),r}function V(e,t,n){var r=this;e=g(e);var i=new l(function(n,i){var s;r.ready().then(function(){return s=r._dbInfo,"[object Blob]"===E.call(t)?S(s.db).then(function(e){return e?t:R(t)}):t}).then(function(t){M(r._dbInfo,v,function(s,a){if(s)return i(s);try{var o=a.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=o.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),n(t)},a.onabort=a.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}})}).catch(i)});return u(i,n),i}function F(e,t){var n=this;e=g(e);var r=new l(function(t,r){n.ready().then(function(){M(n._dbInfo,v,function(i,s){if(i)return r(i);try{var a=s.objectStore(n._dbInfo.storeName).delete(e);s.oncomplete=function(){t()},s.onerror=function(){r(a.error)},s.onabort=function(){var e=a.error?a.error:a.transaction.error;r(e)}}catch(e){r(e)}})}).catch(r)});return u(r,t),r}function K(e){var t=this,n=new l(function(e,n){t.ready().then(function(){M(t._dbInfo,v,function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;n(e)}}catch(e){n(e)}})}).catch(n)});return u(n,e),n}function j(e){var t=this,n=new l(function(e,n){t.ready().then(function(){M(t._dbInfo,_,function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).count();s.onsuccess=function(){e(s.result)},s.onerror=function(){n(s.error)}}catch(e){n(e)}})}).catch(n)});return u(n,e),n}function G(e,t){var n=this,r=new l(function(t,r){e<0?t(null):n.ready().then(function(){M(n._dbInfo,_,function(i,s){if(i)return r(i);try{var a=s.objectStore(n._dbInfo.storeName),o=!1,c=a.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||o?t(n.key):(o=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}})}).catch(r)});return u(r,t),r}function H(e){var t=this,n=new l(function(e,n){t.ready().then(function(){M(t._dbInfo,_,function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).openKeyCursor(),a=[];s.onsuccess=function(){var t=s.result;t?(a.push(t.key),t.continue()):e(a)},s.onerror=function(){n(s.error)}}catch(e){n(e)}})}).catch(n)});return u(n,e),n}function q(e,t){t=p.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;if(e.name){var s=e.name===n.name&&i._dbInfo.db?l.resolve(i._dbInfo.db):O(e).then(function(t){var n=m[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t});r=e.storeName?s.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;y(e);var r=m[e.name],i=r.forages;t.close();for(var s=0;s<i.length;s++){var o=i[s];o._dbInfo.db=null,o._dbInfo.version=n}var c=new l(function(t,r){var i=a.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}});return c.then(function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,I(n._dbInfo)}}).catch(function(t){throw(A(e,t)||l.resolve()).catch(function(){}),t})}}):s.then(function(t){y(e);var n=m[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;var s=new l(function(t,n){var r=a.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}});return s.then(function(e){n.db=e;for(var t=0;t<r.length;t++)I(r[t]._dbInfo)}).catch(function(t){throw(A(e,t)||l.resolve()).catch(function(){}),t})})}else r=l.reject("Invalid arguments");return u(r,t),r}var Y={_driver:"asyncStorage",_initStorage:U,_support:o(),iterate:W,getItem:B,setItem:V,removeItem:F,clear:K,length:j,key:G,keys:H,dropInstance:q};function z(){return"function"==typeof openDatabase}var $="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",X="~~local_forage_type~",J=/^~~local_forage_type~([^~]+)~/,Q="__lfsc__:",Z=Q.length,ee="arbf",te="blob",ne="si08",re="ui08",ie="uic8",se="si16",ae="si32",oe="ur16",ce="ui32",le="fl32",ue="fl64",de=Z+ee.length,ge=Object.prototype.toString;function pe(e){var t,n,r,i,s,a=.75*e.length,o=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var l=new ArrayBuffer(a),u=new Uint8Array(l);for(t=0;t<o;t+=4)n=$.indexOf(e[t]),r=$.indexOf(e[t+1]),i=$.indexOf(e[t+2]),s=$.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|i>>2,u[c++]=(3&i)<<6|63&s;return l}function he(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=$[n[t]>>2],r+=$[(3&n[t])<<4|n[t+1]>>4],r+=$[(15&n[t+1])<<2|n[t+2]>>6],r+=$[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function fe(e,t){var n="";if(e&&(n=ge.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===ge.call(e.buffer))){var r,i=Q;e instanceof ArrayBuffer?(r=e,i+=ee):(r=e.buffer,"[object Int8Array]"===n?i+=ne:"[object Uint8Array]"===n?i+=re:"[object Uint8ClampedArray]"===n?i+=ie:"[object Int16Array]"===n?i+=se:"[object Uint16Array]"===n?i+=oe:"[object Int32Array]"===n?i+=ae:"[object Uint32Array]"===n?i+=ce:"[object Float32Array]"===n?i+=le:"[object Float64Array]"===n?i+=ue:t(new Error("Failed to get type for BinaryArray"))),t(i+he(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n=X+e.type+"~"+he(this.result);t(Q+te+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function me(e){if(e.substring(0,Z)!==Q)return JSON.parse(e);var t,n=e.substring(de),r=e.substring(Z,de);if(r===te&&J.test(n)){var i=n.match(J);t=i[1],n=n.substring(i[0].length)}var s=pe(n);switch(r){case ee:return s;case te:return c([s],{type:t});case ne:return new Int8Array(s);case re:return new Uint8Array(s);case ie:return new Uint8ClampedArray(s);case se:return new Int16Array(s);case oe:return new Uint16Array(s);case ae:return new Int32Array(s);case ce:return new Uint32Array(s);case le:return new Float32Array(s);case ue:return new Float64Array(s);default:throw new Error("Unkown type: "+r)}}var Ee={serialize:fe,deserialize:me,stringToBuffer:pe,bufferToString:he};function _e(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function ve(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new l(function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction(function(i){_e(i,n,function(){t._dbInfo=n,e()},function(e,t){r(t)})},r)});return n.serializer=Ee,i}function be(e,t,n,r,i,s){e.executeSql(n,r,i,function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,o){o.rows.length?s(e,a):_e(e,t,function(){e.executeSql(n,r,i,s)},s)},s):s(e,a)},s)}function Te(e,t){var n=this;e=g(e);var r=new l(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){be(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)},function(e,t){r(t)})})}).catch(r)});return u(r,t),r}function Se(e,t){var n=this,r=new l(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){be(n,i,"SELECT * FROM "+i.storeName,[],function(n,r){for(var s=r.rows,a=s.length,o=0;o<a;o++){var c=s.item(o),l=c.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=e(l,c.key,o+1)))return void t(l)}t()},function(e,t){r(t)})})}).catch(r)});return u(r,t),r}function ye(e,t,n,r){var i=this;e=g(e);var s=new l(function(s,a){i.ready().then(function(){void 0===t&&(t=null);var o=t,c=i._dbInfo;c.serializer.serialize(t,function(t,l){l?a(l):c.db.transaction(function(n){be(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],function(){s(o)},function(e,t){a(t)})},function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void s(ye.apply(i,[e,o,n,r-1]));a(t)}})})}).catch(a)});return u(s,n),s}function Ie(e,t,n){return ye.apply(this,[e,t,n,1])}function Ae(e,t){var n=this;e=g(e);var r=new l(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){be(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){r(t)})})}).catch(r)});return u(r,t),r}function we(e){var t=this,n=new l(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){be(t,r,"DELETE FROM "+r.storeName,[],function(){e()},function(e,t){n(t)})})}).catch(n)});return u(n,e),n}function Oe(e){var t=this,n=new l(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){be(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],function(t,n){var r=n.rows.item(0).c;e(r)},function(e,t){n(t)})})}).catch(n)});return u(n,e),n}function De(e,t){var n=this,r=new l(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){be(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)},function(e,t){r(t)})})}).catch(r)});return u(r,t),r}function Ne(e){var t=this,n=new l(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){be(t,r,"SELECT key FROM "+r.storeName,[],function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)},function(e,t){n(t)})})}).catch(n)});return u(n,e),n}function Re(e){return new l(function(t,n){e.transaction(function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(n,r){for(var i=[],s=0;s<r.rows.length;s++)i.push(r.rows.item(s).name);t({db:e,storeNames:i})},function(e,t){n(t)})},function(e){n(e)})})}function Le(e,t){t=p.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return u(r=e.name?new l(function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(Re(r))}).then(function(e){return new l(function(t,n){e.db.transaction(function(r){function i(e){return new l(function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){n(t)})})}for(var s=[],a=0,o=e.storeNames.length;a<o;a++)s.push(i(e.storeNames[a]));l.all(s).then(function(){t()}).catch(function(e){n(e)})},function(e){n(e)})})}):l.reject("Invalid arguments"),t),r}var ke={_driver:"webSQLStorage",_initStorage:ve,_support:z(),iterate:Se,getItem:Te,setItem:Ie,removeItem:Ae,clear:we,length:Oe,key:De,keys:Ne,dropInstance:Le};function Pe(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Ce(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Me(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function xe(){return!Me()||localStorage.length>0}function Ue(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=Ce(e,t._defaultConfig),xe()?(t._dbInfo=n,n.serializer=Ee,l.resolve()):l.reject()}function Be(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}});return u(n,e),n}function We(e,t){var n=this;e=g(e);var r=n.ready().then(function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r});return u(r,t),r}function Ve(e,t){var n=this,r=n.ready().then(function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,s=localStorage.length,a=1,o=0;o<s;o++){var c=localStorage.key(o);if(0===c.indexOf(r)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(i),a++)))return l}}});return u(r,t),r}function Fe(e,t){var n=this,r=n.ready().then(function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t});return u(r,t),r}function Ke(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var s=localStorage.key(i);0===s.indexOf(e.keyPrefix)&&r.push(s.substring(e.keyPrefix.length))}return r});return u(n,e),n}function je(e){var t=this.keys().then(function(e){return e.length});return u(t,e),t}function Ge(e,t){var n=this;e=g(e);var r=n.ready().then(function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return u(r,t),r}function He(e,t,n){var r=this;e=g(e);var i=r.ready().then(function(){void 0===t&&(t=null);var n=t;return new l(function(i,s){var a=r._dbInfo;a.serializer.serialize(t,function(t,r){if(r)s(r);else try{localStorage.setItem(a.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||s(e),s(e)}})})});return u(i,n),i}function qe(e,t){if(t=p.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return r=e.name?new l(function(t){e.storeName?t(Ce(e,i._defaultConfig)):t(e.name+"/")}).then(function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}}):l.reject("Invalid arguments"),u(r,t),r}var Ye={_driver:"localStorageWrapper",_initStorage:Ue,_support:Pe(),iterate:Ve,getItem:We,setItem:He,removeItem:Ge,clear:Be,length:je,key:Fe,keys:Ke,dropInstance:qe},ze=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},$e=function(e,t){for(var n=e.length,r=0;r<n;){if(ze(e[r],t))return!0;r++}return!1},Xe=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Je={},Qe={},Ze={INDEXEDDB:Y,WEBSQL:ke,LOCALSTORAGE:Ye},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),rt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function it(e,t){e[t]=function(){var n=arguments;return e.ready().then(function(){return e[t].apply(e,n)})}}function st(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Xe(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var at=function(){function e(t){for(var n in i(this,e),Ze)if(Ze.hasOwnProperty(n)){var r=Ze[n],s=r._driver;this[n]=s,Je[s]||this.defineDriver(r)}this._defaultConfig=st({},rt),this._config=st({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new l(function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var s=nt.concat("_initStorage"),a=0,o=s.length;a<o;a++){var c=s[a];if((!$e(tt,c)||e[c])&&"function"!=typeof e[c])return void n(i)}var d=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=l.reject(t);return u(n,arguments[arguments.length-1]),n}},n=0,r=tt.length;n<r;n++){var i=tt[n];e[i]||(e[i]=t(i))}};d();var g=function(n){Je[r]&&console.info("Redefining LocalForage driver: "+r),Je[r]=e,Qe[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(g,n):g(!!e._support):g(!0)}catch(e){n(e)}});return d(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=Je[e]?l.resolve(Je[e]):l.reject(new Error("Driver not found."));return d(r,t,n),r},e.prototype.getSerializer=function(e){var t=l.resolve(Ee);return d(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return d(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;Xe(e)||(e=[e]);var i=this._getSupportedDrivers(e);function s(){r._config.driver=r.driver()}function a(e){return r._extend(e),s(),r._ready=r._initStorage(r._config),r._ready}function o(e){return function(){var t=0;function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(a).catch(n)}s();var o=new Error("No available storage method found.");return r._driverSet=l.reject(o),r._driverSet}return n()}}var c=null!==this._driverSet?this._driverSet.catch(function(){return l.resolve()}):l.resolve();return this._driverSet=c.then(function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then(function(e){r._driver=e._driver,s(),r._wrapLibraryMethodsWithReady(),r._initDriver=o(i)})}).catch(function(){s();var e=new Error("No available storage method found.");return r._driverSet=l.reject(e),r._driverSet}),d(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Qe[e]},e.prototype._extend=function(e){st(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=nt.length;e<t;e++)it(this,nt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),ot=new at;t.exports=ot},{3:3}]},{},[4])(4)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";n.r(r),n.d(r,{default:()=>Es});const e={DEVICE_ADD:"v2/device/add",DEVICE_TOKEN_CHECK:"v2/device/token-check",REPORT_ADD:"v2/report/add"},t=195,i="v1/sdk_logging/",s="USER_ATTRIBUTE_UNIQUE_ID",a="USER_ATTRIBUTE_USER_EMAIL",o="USER_ATTRIBUTE_USER_NAME",c="USER_ATTRIBUTE_USER_FIRST_NAME",l="USER_ATTRIBUTE_USER_LAST_NAME",u="USER_ATTRIBUTE_USER_MOBILE",d="USER_ATTRIBUTE_USER_GENDER",g="USER_ATTRIBUTE_USER_BDAY",p=[s,"USER_ID_MODIFIED_FROM"],h=[{moeName:"uid",attributeName:"USER_ATTRIBUTE_UNIQUE_ID",programName:"id"},{moeName:"u_em",attributeName:"USER_ATTRIBUTE_USER_EMAIL",programName:"email"},{moeName:"u_gd",attributeName:"USER_ATTRIBUTE_USER_GENDER",programName:"gender"},{moeName:"u_bd",attributeName:"USER_ATTRIBUTE_USER_BDAY",programName:"birthday"},{moeName:"u_n",attributeName:"USER_ATTRIBUTE_USER_NAME",programName:"name"},{moeName:"u_fn",attributeName:"USER_ATTRIBUTE_USER_FIRST_NAME",programName:"first_name"},{moeName:"u_ln",attributeName:"USER_ATTRIBUTE_USER_LAST_NAME",programName:"last_name"},{moeName:"u_mb",attributeName:"USER_ATTRIBUTE_USER_MOBILE",programName:"mobile"}],f="moe_push_opted",m="identifiers",E="SESSION",_="sessionKey",v="sessionStartTime",b="sessionExpiryTime",T="sessionMaxTime",S="customIdentifiersToTrack",y="currentSource",I="numberOfSessions",A={TOPIC_NAME:"MOE_LIFECYCLE",EVENT_NAMES:{MOE_INIT:"SDK_INITIALIZED",SETTINGS_FETCHED:"SETTINGS_FETCHED",EVENT_TRACKED:"EVENT_TRACKED",DEVICE_UUID:"DEVICE_UUID",MOE_INIT_COMPLETED:"SDK_INITIALIZATION_COMPLETED",CARDS_INIT:"CARDS_INITIALIZED",SDK_DISABLED:"SDK_DISABLED",SDK_ENABLED:"SDK_ENABLED",OSM_INIT:"OSM_INITIALIZED",WEBP_INIT:"WEBP_INITIALIZED",LANDING_PAGE_DEVICE_ADD:"LANDING_PAGE_DEVICE_ADD"}},w={TOPIC_NAME:"USER_LIFECYCLE",EVENT_NAMES:{USER_IDENTITY_UPDATE:"USER_IDENTITY_UPDATE",LOGOUT:"LOGOUT"}},O={TOPIC_NAME:"SPA",EVENT_NAMES:{PAGE_CHANGED:"PAGE_CHANGED"}},D={dc_1:"DC_1",dc_2:"DC_2",dc_3:"DC_3",dc_4:"DC_4",dc_5:"DC_5",dc_6:"DC_6",dc_100:"DC_100"},N={DC_1:"sdk-01.moengage.com",DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",DC_4:"sdk-04.moengage.com",DC_5:"sdk-05.moengage.com",DC_6:"sdk-06.moengage.com",DC_100:"sdk-100.moengage.com",EU:"sdk-02.moengage.com",IN:"sdk-03.moengage.com"},R={COOKIE_NAME_MAPPING:{USER_DATA:"moe_u_d",SUBSCRIPTION_DETAILS:"moe_s_d",PUSH_TOKEN:"moe_p_t",OPT_IN_SHOWN_TIME:"moe_o_s_t",SOFT_ASK_STATUS:"moe_s_a_s",HARD_ASK_STATUS:"moe_h_a_s",SESSION:"moe_s_n",DEVICE_DATA:"moe_d_d",IDENTITY_MAP:"moe_i_m",SDK_DISABLED:"moe_dis",COOKIE_SHARING:"moe_c_s"},PERMISSION_STATE_MAPPING:{prompt:2,granted:1,dismissed:3,denied:0,shown:4,"not shown":5,allowed:6},SUBSCRIPTION_DETAILS_KEYS:{domain:"d",token:"t",endpoint:"e",keys:"k",p256dh:"p",auth:"a"},USER_DATA_KEYS:{attributes:"a",subscribedToOldSdk:"s_old",deviceUuid:"d_id",deviceAdded:"d_added"},ATTRIBUTE_KEYS:{key:"k",value:"v",updated_at:"u_at",level:"l"},IDENTITY_MAP_KEYS:{userIdentities:"u_i",previousIdentities:"p_i",previousIdentitiesUpdatedTime:"p_i_u_t"},SESSION_KEYS:{sessionKey:"s_k",sessionStartTime:"s_s_t",sessionMaxTime:"s_m_t",customIdentifiersToTrack:"c_i_t_t",sessionExpiryTime:"s_e_t",numberOfSessions:"n_o_s",currentSource:"c_s"},SOURCE_KEYS:{source:"s",medium:"m",source_url:"s_u",term:"t",campaign_name:"c_n",campaign_id:"c_id",content:"c",extra:"e"},DEVICE_DATA_KEYS:{deviceUniqueId:"d_uid"},ENDPOINT_URL_MAPPING:{"https://fcm.googleapis.com/fcm/send/":"f","https://wns2-pn1p.notify.windows.com/w/":"w","https://wns2-sin1p.notify.windows.com/":"w1","https://wns2-bay1p.notify.windows.com/":"w2","https://updates.push.services.mozilla.com/wpush/v2/":"m","https://web.push.apple.com/":"a"}},L={TV:"tv",TABLET:"tablet",MOBILE:"mobile",WEB:"web"},k="Tizen",P="WebOS",C="Xbox",M="viziotv",x="SmartTV",U="number",B="EVENT_ACTION_USER_ATTRIBUTE",W="MOE_WEB_UNSUBSCRIBED",V="MOE_WEB_OPTIN_BANNER_LOAD",F="MOE_OPT_IN_SHOWN",K="MOE_LOGOUT",j="EVENT_ACTION_DEVICE_ATTRIBUTE",G="MOE_PUSH_PERMISSION_STATE_BLOCKED",H="URL",q="moe_logged_in_status",Y="moe_first_visit",z="https://developers.moengage.com/hc/en-us/articles/360060713252-Web-SDK-Integration",$="moe_uuid",X="moe_uuid",J="MoengagePageEventHistoryManager",Q={USER_DATA:"USER_DATA",PUSH_TOKEN:"PUSH_TOKEN",SUBSCRIPTION_DETAILS:"SUBSCRIPTION_DETAILS",SETUP_TIME:"SETUP_TIME",OPT_IN_SHOWN_TIME:"OPT_IN_SHOWN_TIME",OPTED_STATUS_TRACK_TIME:"OPTED_STATUS_TRACK_TIME",SOFT_ASK_STATUS:"SOFT_ASK_STATUS",HARD_ASK_STATUS:"HARD_ASK_STATUS",WEB_SETTINGS:"WEB_SETTINGS",GRACEFUL_DATA:"GRACEFUL_DATA",Q:{PREFIX:"Q",REPORT:"REPORT",DEVICE:"DEVICE"},INIT_DATA:"INIT_DATA",OLD_SDK:{USER_DATA:"moengage_data",SUBSCRIPTION_DETAILS:"MOE_PUSH_ENDPOINT",PUSH_TOKEN:"MOE_PUSH_TOKEN"},BROWSER_DETAILS:"browserDetails",SESSION:"SESSION",DEVICE_DATA:"DEVICE_DATA",IDENTITY_MAP:"IDENTITY_MAP",SDK_VERSION:"SDK_VERSION",SDK_DISABLED:"SDK_DISABLED",LOGOUT_IN_PROGRESS:"LOGOUT_IN_PROGRESS"},Z="initData",ee="browserDetails",te="unifiedLogs",ne="hasUserLoggedOut",re="landingPageTracking",ie={EXPIRY_YEARS:2},se="COOKIE_SHARING",ae="moe_tracking",oe="events",ce="moe_database",le="moe_data",ue=[Q.DEVICE_DATA],de=["Google Chrome","Mozilla Firefox","Opera","Apple Safari","Edge"],ge="v1/experiences/web/live",pe="v1/experiences/web/test",he="v1/experiences/web/stats",fe="v1/experiences/web/actions",me="v1/experiences/web/live_recom",Ee="v1/experiences/web/split",_e="v1/experiences/web/recommendations",ve="v1/experiences/sdk/fetch",be="script",Te="insert",Se="rearrange",ye="insert_js",Ie="update",Ae="attribute",we="tracking",Oe="update_outerhtml",De="replace",Ne="delete",Re="hide",Le=[Te,Se,ye],ke=[Te,Se],Pe="in_gcg",Ce="ids",Me=5,xe="moePageContext",Ue="data-moe-id",Be="moeWpE",We="Version not found in staging",Ve="moe-anti-flicker-hide",Fe="moe-anti-flicker-style",Ke="MOE_WEBP_MESSAGE_SHOWN",je="MOE_WEBP_MESSAGE_CLICKED",Ge="moe-show-personalized-experience",He={LABEL_NAME:"data-moe-personalized-label",BACKUP_TITLE:"data-moe-backup-title"},qe={STYLE_ID:"moe-personalized-experience-css",STYLE_DATA:"\n    .moe-show-personalized-experience {\n      outline-offset: -3px;\n      outline: 3px dashed #06A6B7;\n      border: 3px dashed #06A6B7;\n    }\n    .tooltip {\n      visibility: hidden;\n      opacity: 0;\n      transition: opacity 0.2s, visibility 0.2s;\n      color: #fff;\n      border: 1px solid #06A6B7;\n      border-radius: 3px;\n      background-color: #06A6B7;\n      padding: 4px;\n      font-size: 12px;\n      white-space: nowrap;\n      position: fixed;\n      z-index: 1000;\n      pointer-events: none; /* Ensures the tooltip doesn't interfere with mouse events */\n    }\n    .tooltip.visible {\n      visibility: visible;\n      opacity: 1;\n    }\n    "},Ye={update:"Text edited",attribute:"Attributes updated",tracking:"Tracking enabled",insert:"Custom HTML added",insert_js:"",update_outerhtml:"HTML edited",rearrange:"Element rearranged",insert_image:"Image added",replace:"Element replaced"},ze="moe_webp",$e={STORE_NAME:"experiences"},Xe={STORE_NAME:"ai_experiences",AI_EXPERIENCE_CONTEXT:"ai_experience_context",WEB_ACTION_EVENTS:"web_action_events",WEB_ACTIONS_LAST_FETCHED_TIME:"web_actions_last_fetched_time"},Je={STORE_NAME:"meta",LAST_FETCHED_TIME:"last_fetched_time",SELF_HANDLE_LAST_FETCHED_TIME:"self_handle_last_fetched_time",USER_IN_GCG:"user_in_gcg"},Qe={STORE_NAME:"inSession",IN_SESSION_EVENTS:"in_session_events",IN_SESSION_EVENTS_HISTORY:"in_session_events_history"},Ze={STORE_NAME:"split_experiences"},et={STORE_NAME:"tabbed_experiences"},tt=Xe,nt=Qe;function rt(e,t,n){return null!=e&&t?(e=e[(t=Array.isArray(t)?t:t.split("."))[0]])&&t.length>1?rt(e,t.slice(1),n):void 0===e?n||null:e:null}class it{static baseLogTag="EphemeralStorage";static set(e,t){it.baseLogTag;window&&(window.moeInternals?(window.moeInternals.ephemeral||(window.moeInternals.ephemeral={}),window.moeInternals.ephemeral[e]=t):(window.moeInternals={},window.moeInternals.ephemeral={},window.moeInternals.ephemeral[e]=t))}static get(e){return rt(window,"moeInternals.ephemeral."+e,null)}static clear(){window&&(window.moeInternals={},window.moeInternals.ephemeral={})}}function st(){return window[window.moengage_object||"Moengage"]}class at{static isTrackingEnabled;static logLevel;static logData(e,t){return{log_type:e,sent_time:(new Date).toISOString(),lake_fields:t}}static setRemoteLogging(e,t){return this.isTrackingEnabled||(this.logLevel=e,this.isTrackingEnabled=t),this.isTrackingEnabled}static log(e,t,n,r,...i){!this.isTrackingEnabled||e!==this.logLevel&&"verbose"!==this.logLevel||st().remoteLogs.addRemoteLogs(this.logData(e,{msg:n+[...i].toString(),file_name:t,trace:r}))}}let ot="color: white; background: #41AE55; border-radius: 5px;";class ct{static baseLogTag="Logger";static logBrand="MoEngage";static logLevel=0;static tagLogStyle="color: white; background: #48beab; border-radius: 5px;";static setLogLevel(e,t){const n=ct.baseLogTag+".setLogLevel";null==it.get(te)&&it.set(te,[]),null==e?ct.logLevel=0:e in[0,1,2]?(ct.logLevel=e,e>0&&t&&ct.releaseAllLogs()):ct.warn(0,n,"Value",e,"not supported for setDebugLevel(). Current log level is",ct.logLevel,". Debug level can only be [0, 1, 2]")}static setLogTabStyle(e){ct.tagLogStyle=ct.tagLogStyle.replace("#48beab",e)}static log(e,t,n,...r){e<=ct.logLevel?console.log("%c "+ct.logBrand+" %c %c info %c %c "+t+" ",ot,"","color: white; background: #18a0bf; border-radius: 5px;","",ct.tagLogStyle,n,...r):ct.cacheLog(()=>{ct.log(e,t,n,...r)})}static remoteLogTracking(e,t,n,r,...i){at.log(t,n,r,...i),this.log(e,n,r,...i)}static error(e,t,n,...r){!r[r.length-1]?.isCached&&at.log("error",t,n,...r),e<=ct.logLevel?console.error("%c "+ct.logBrand+" %c %c error %c %c "+t+" ",ot,"","color: white; background: #cc0a0a; border-radius: 5px;","",ct.tagLogStyle,n,...r.slice(0,-1)):ct.cacheLog(()=>{ct.error(e,t,n,...r,{isCached:!0})})}static warn(e,t,n,...r){!r[r.length-1]?.isCached&&at.log("warning",t,n,...r),e<=ct.logLevel?console.warn("%c "+ct.logBrand+" %c %c warn %c %c "+t+" ",ot,"","color: white; background: #e8ab51; border-radius: 5px;","",ct.tagLogStyle,n,...r.slice(0,-1)):ct.cacheLog(()=>{ct.warn(e,t,n,...r,{isCached:!0})})}static customLabel(e,t,n,...r){e<=ct.logLevel?console.log("%c "+ct.logBrand+" %c %c "+t+" %c %c "+n+" %c ",ot,"",ct.tagLogStyle,"","color: white; background: #a400ff; border-radius: 5px;","",...r):ct.cacheLog(()=>{ct.customLabel(e,t,n,...r)})}static image(e,t){e<=ct.logLevel?console.log("%c+","font-size: 1px; padding: 20px 80px; line-height: 45px; background: url("+t+"); background-size: 160px 90px; color: transparent;"):ct.cacheLog(()=>{ct.image(e,t)})}static releaseAllLogs(){const e=it.get(te),t=e.length,n=e;if(it.set(te,[]),t>0){ct.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS BEGIN ----\x3e");for(let e=0;e<t;e++)n[e]();ct.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS END ----\x3e")}}static setLogBrand(e){ct.logBrand=e}static setBrandColor(e){ot="color: white; background: "+e+"; border-radius: 5px;"}static cacheLog(e){let t=it.get(te);null==t&&(t=[]),t.push(e),it.set(te,t)}}const lt=e=>{if(e){const t=e.indexOf("?");if(t<0)return{};const n=(e=e.slice(t+1)).replace("?","").split("&"),r={};return n.forEach(e=>{const t=e.split("="),n=t[0],i=decodeURIComponent(t[1]||"");r[n]?"[object Array]"===Object.prototype.toString.call(r[n])?r[n].push(i):r[n]=[r[n],i]:r[n]=i}),JSON.parse(JSON.stringify(r))}return{}};class ut{static get(e,t){return ut.makeNetworkCall(dt.METHODS.GET,e,t)}static post(e,t){return ut.makeNetworkCall(dt.METHODS.POST,e,t)}static makeNetworkCall(e,t,n={}){return new Promise((r,i)=>{const s=JSON.stringify(rt(n,"postData",null));t=((e,t)=>{if(!t)return e;"?"!==e[e.length-1]&&(e+="?");for(const n in t)t.hasOwnProperty(n)&&null!=t[n]&&(e+=n+"="+encodeURIComponent(t[n])+"&");return"&"===e[e.length-1]&&(e=e.slice(0,-1)),e})(t,rt(n,"queryParams",null));const a=new XMLHttpRequest;a.open(e,t,!0),ut.addRequestHeaders(a,rt(n,"headers",{})),a.onreadystatechange=()=>{4===a.readyState&&200===a.status||4===a.readyState&&410===a.status?r({status:a.status,responseText:a.responseText}):4===a.readyState&&200!==a.status&&i({code:a.status,reason:a.responseText})},a.send(s)})}static addRequestHeaders(e,t){for(const n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n]);return e}}var dt;!function(e){let t;!function(e){e.GET="GET",e.POST="POST"}(t=e.METHODS||(e.METHODS={}))}(dt||(dt={}));var gt=n(790),pt=n.n(gt);class ht{static baseLogTag="MOE_WEBP_STORES";static ready;static experiencesStore;static aiExperiencesStore;static metaStore;static inSessionStore;static splitExperiences;static tabbedExperiences;static async initialize(){if(null==ht.ready){ht.experiencesStore=pt().createInstance({driver:[pt().INDEXEDDB,pt().WEBSQL,pt().LOCALSTORAGE],name:ze,storeName:$e.STORE_NAME}),ht.aiExperiencesStore=pt().createInstance({driver:[pt().INDEXEDDB,pt().WEBSQL,pt().LOCALSTORAGE],name:ze,storeName:Xe.STORE_NAME}),ht.metaStore=pt().createInstance({driver:[pt().INDEXEDDB,pt().WEBSQL,pt().LOCALSTORAGE],name:ze,storeName:Je.STORE_NAME}),ht.inSessionStore=pt().createInstance({driver:[pt().INDEXEDDB,pt().WEBSQL,pt().LOCALSTORAGE],name:ze,storeName:Qe.STORE_NAME}),ht.splitExperiences=pt().createInstance({driver:[pt().INDEXEDDB,pt().WEBSQL,pt().LOCALSTORAGE],name:ze,storeName:Ze.STORE_NAME}),ht.tabbedExperiences=pt().createInstance({driver:[pt().INDEXEDDB,pt().WEBSQL,pt().LOCALSTORAGE],name:ze,storeName:et.STORE_NAME});const e=[ht.experiencesStore.ready(),ht.aiExperiencesStore.ready(),ht.metaStore.ready(),ht.inSessionStore.ready(),ht.splitExperiences.ready(),ht.tabbedExperiences.ready()];ht.ready=Promise.all(e)}return ht.ready}static async clear(){const e=ht.baseLogTag+".clear";try{await ht.initialize(),await Promise.all([ht.experiencesStore.clear(),ht.aiExperiencesStore.clear(),ht.metaStore.clear(),ht.splitExperiences.clear(),ht.tabbedExperiences.clear()]);const e=[ht.experiencesStore.ready(),ht.aiExperiencesStore.ready(),ht.metaStore.ready(),ht.splitExperiences.ready(),ht.tabbedExperiences.ready()];ht.ready=Promise.all(e)}catch(t){ct.error(1,e,"Error clearing web personalization stores:",t)}return ht.ready}}function ft(e,t){return!(e!==a&&e!==u&&!t.includes(e))}class mt{static baseLogTag="LocalQ";items;constructor(){this.items=[]}static enqueue(e,t){const n=mt.getLocalStorageQName(e);let r=new mt;Cn.get(n)&&(r=Cn.get(n)),r.items.push(t),r.items=r.items.slice(Math.max(r.items.length-50,0)),Cn.set(n,r)}static dequeue(e){const t=mt.getLocalStorageQName(e),n=Cn.get(t);let r=null;return n&&n.items.length>0&&(r=n.items[0],n.items.splice(0,1),Cn.set(t,n)),r}static isEmpty(e){const t=mt.getLocalStorageQName(e);if(Cn.get(t)){if(Cn.get(t).items.length>0)return!1}return!0}static purge(e){const t=`${this.baseLogTag}.purge`,n=mt.getLocalStorageQName(e);mt.isEmpty(e)||Cn.remove(n),ct.log(2,t,`Queue "${e}" has been cleared.`)}static getLocalStorageQName(e){return Q.Q.PREFIX+"_"+e}}class Et{static baseLogTag="InitData";integrationType;appId;debugLevel=0;cluster=null;environment=null;baseDomainName="https://sdk-01.moengage.com/";inapp=null;swPath;swScope;customSoftAsk=null;forceSwUpdate;disableOnsite;enableSPA;cards;proxyDomains;disableWebPush;disableCookies;disableSdk;projectId;constructor(e){const t=Et.baseLogTag+".constructor";null!=rt(e,"app_id",null)?(this.appId=rt(e,"app_id",null),this.integrationType=_t.OLD_SDK):null!=rt(e,"appId",null)?(this.appId=rt(e,"appId",null),this.integrationType=_t.NEW_SDK):(ct.error(1,t,"App Id not specified. Please check docs page to complete the integration - ",z),this.integrationType=null),null!=rt(e,"debug_logs",null)?this.debugLevel=rt(e,"debug_logs",0):null!=rt(e,"debugLevel",null)?this.debugLevel=rt(e,"debugLevel",0):(ct.log(2,t,"No log level config found. Using default value of",0),this.debugLevel=0),this.appId&&(this.baseDomainName="https://sdk-01.moengage.com/",this.forceSwUpdate=rt(e,"forceSwUpdate",!1),this.cluster=D.dc_3,this.cluster=rt(e,"cluster",this.cluster),this.cluster&&null!=N[this.cluster.toUpperCase()]&&(this.environment=N[this.cluster.toUpperCase()]),rt(e,"environment",null)&&(this.environment=e.environment),this.environment&&(this.baseDomainName="https://"+this.environment+"/"),this.debugLevel>0&&this.appId.indexOf("_DEBUG")<0?this.appId=this.appId+"_DEBUG":0===this.debugLevel&&this.appId.indexOf("_DEBUG")>=0&&(this.appId=this.appId.substr(0,this.appId.indexOf("_DEBUG"))),this.swPath=rt(e,"swPath",null),null!=e.customSoftAsk?this.customSoftAsk={mainClass:rt(e,"customSoftAsk.mainClass",null),allowClass:rt(e,"customSoftAsk.allowClass",null),dismissClass:rt(e,"customSoftAsk.dismissClass",null)}:this.customSoftAsk={mainClass:rt(e,"main_class",null),allowClass:rt(e,"allow_class",null),dismissClass:rt(e,"block_class",null)},null!=rt(e,"inapp.host",null)&&(this.inapp={host:rt(e,"inapp.host",null)}),null!=rt(e,"swScope",null)&&(this.swScope=rt(e,"swScope",null)),null!=rt(e,"disable_onsite",null)&&(this.disableOnsite=rt(e,"disable_onsite",!1)),null!=rt(e,"enableSPA",null)&&(this.enableSPA=rt(e,"enableSPA",!1)),null!=rt(e,"cards",null)&&(this.cards=rt(e,"cards",{})),null!=rt(e,"proxyDomains",null)&&(this.proxyDomains=rt(e,"proxyDomains",null),this.proxyDomains.api&&(this.baseDomainName="https://"+this.proxyDomains.api+"/",this.environment=this.proxyDomains.api)),null!=rt(e,"disable_web_push",null)&&(this.disableWebPush=rt(e,"disable_web_push",!1)),null!=rt(e,"disableCookies",null)&&(this.disableCookies=rt(e,"disableCookies",!1)),null!=rt(e,"disableSdk",null)&&(this.disableSdk=rt(e,"disableSdk",!1)),null!=rt(e,"project_id",null)&&(this.projectId=rt(e,"project_id",null)))}static save(e){it.set(Z,new Et(e)),Cn.set(Q.INIT_DATA,new Et(e))}static get(){return it.get(Z)}}var _t;!function(e){e.OLD_SDK="OLD_SDK",e.NEW_SDK="NEW_SDK"}(_t||(_t={}));var vt=Uint8Array,bt=Uint16Array,Tt=Int32Array,St=new vt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),yt=new vt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),It=new vt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),At=function(e,t){for(var n=new bt(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new Tt(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return{b:n,r:i}},wt=At(St,2),Ot=wt.b,Dt=wt.r;Ot[28]=258,Dt[258]=28;for(var Nt=At(yt,0),Rt=Nt.b,Lt=Nt.r,kt=new bt(32768),Pt=0;Pt<32768;++Pt){var Ct=(43690&Pt)>>1|(21845&Pt)<<1;Ct=(61680&(Ct=(52428&Ct)>>2|(13107&Ct)<<2))>>4|(3855&Ct)<<4,kt[Pt]=((65280&Ct)>>8|(255&Ct)<<8)>>1}var Mt=function(e,t,n){for(var r=e.length,i=0,s=new bt(t);i<r;++i)e[i]&&++s[e[i]-1];var a,o=new bt(t);for(i=1;i<t;++i)o[i]=o[i-1]+s[i-1]<<1;if(n){a=new bt(1<<t);var c=15-t;for(i=0;i<r;++i)if(e[i])for(var l=i<<4|e[i],u=t-e[i],d=o[e[i]-1]++<<u,g=d|(1<<u)-1;d<=g;++d)a[kt[d]>>c]=l}else for(a=new bt(r),i=0;i<r;++i)e[i]&&(a[i]=kt[o[e[i]-1]++]>>15-e[i]);return a},xt=new vt(288);for(Pt=0;Pt<144;++Pt)xt[Pt]=8;for(Pt=144;Pt<256;++Pt)xt[Pt]=9;for(Pt=256;Pt<280;++Pt)xt[Pt]=7;for(Pt=280;Pt<288;++Pt)xt[Pt]=8;var Ut=new vt(32);for(Pt=0;Pt<32;++Pt)Ut[Pt]=5;var Bt=Mt(xt,9,0),Wt=Mt(xt,9,1),Vt=Mt(Ut,5,0),Ft=Mt(Ut,5,1),Kt=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},jt=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},Gt=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Ht=function(e){return(e+7)/8|0},qt=function(e,t,n){return(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length),new vt(e.subarray(t,n))},Yt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],zt=function(e,t,n){var r=new Error(t||Yt[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,zt),!n)throw r;return r},$t=function(e,t,n,r){var i=e.length,s=r?r.length:0;if(!i||t.f&&!t.l)return n||new vt(0);var a=!n,o=a||2!=t.i,c=t.i;a&&(n=new vt(3*i));var l=function(e){var t=n.length;if(e>t){var r=new vt(Math.max(2*t,e));r.set(n),n=r}},u=t.f||0,d=t.p||0,g=t.b||0,p=t.l,h=t.d,f=t.m,m=t.n,E=8*i;do{if(!p){u=jt(e,d,1);var _=jt(e,d+1,3);if(d+=3,!_){var v=e[(R=Ht(d)+4)-4]|e[R-3]<<8,b=R+v;if(b>i){c&&zt(0);break}o&&l(g+v),n.set(e.subarray(R,b),g),t.b=g+=v,t.p=d=8*b,t.f=u;continue}if(1==_)p=Wt,h=Ft,f=9,m=5;else if(2==_){var T=jt(e,d,31)+257,S=jt(e,d+10,15)+4,y=T+jt(e,d+5,31)+1;d+=14;for(var I=new vt(y),A=new vt(19),w=0;w<S;++w)A[It[w]]=jt(e,d+3*w,7);d+=3*S;var O=Kt(A),D=(1<<O)-1,N=Mt(A,O,1);for(w=0;w<y;){var R,L=N[jt(e,d,D)];if(d+=15&L,(R=L>>4)<16)I[w++]=R;else{var k=0,P=0;for(16==R?(P=3+jt(e,d,3),d+=2,k=I[w-1]):17==R?(P=3+jt(e,d,7),d+=3):18==R&&(P=11+jt(e,d,127),d+=7);P--;)I[w++]=k}}var C=I.subarray(0,T),M=I.subarray(T);f=Kt(C),m=Kt(M),p=Mt(C,f,1),h=Mt(M,m,1)}else zt(1);if(d>E){c&&zt(0);break}}o&&l(g+131072);for(var x=(1<<f)-1,U=(1<<m)-1,B=d;;B=d){var W=(k=p[Gt(e,d)&x])>>4;if((d+=15&k)>E){c&&zt(0);break}if(k||zt(2),W<256)n[g++]=W;else{if(256==W){B=d,p=null;break}var V=W-254;if(W>264){var F=St[w=W-257];V=jt(e,d,(1<<F)-1)+Ot[w],d+=F}var K=h[Gt(e,d)&U],j=K>>4;K||zt(3),d+=15&K;M=Rt[j];if(j>3){F=yt[j];M+=Gt(e,d)&(1<<F)-1,d+=F}if(d>E){c&&zt(0);break}o&&l(g+131072);var G=g+V;if(g<M){var H=s-M,q=Math.min(M,G);for(H+g<0&&zt(3);g<q;++g)n[g]=r[H+g]}for(;g<G;++g)n[g]=n[g-M]}}t.l=p,t.p=B,t.b=g,t.f=u,p&&(u=1,t.m=f,t.d=h,t.n=m)}while(!u);return g!=n.length&&a?qt(n,0,g):n.subarray(0,g)},Xt=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>8},Jt=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>8,e[r+2]|=n>>16},Qt=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var i=n.length,s=n.slice();if(!i)return{t:an,l:0};if(1==i){var a=new vt(n[0].s+1);return a[n[0].s]=1,{t:a,l:1}}n.sort(function(e,t){return e.f-t.f}),n.push({s:-1,f:25001});var o=n[0],c=n[1],l=0,u=1,d=2;for(n[0]={s:-1,f:o.f+c.f,l:o,r:c};u!=i-1;)o=n[n[l].f<n[d].f?l++:d++],c=n[l!=u&&n[l].f<n[d].f?l++:d++],n[u++]={s:-1,f:o.f+c.f,l:o,r:c};var g=s[0].s;for(r=1;r<i;++r)s[r].s>g&&(g=s[r].s);var p=new bt(g+1),h=Zt(n[u-1],p,0);if(h>t){r=0;var f=0,m=h-t,E=1<<m;for(s.sort(function(e,t){return p[t.s]-p[e.s]||e.f-t.f});r<i;++r){var _=s[r].s;if(!(p[_]>t))break;f+=E-(1<<h-p[_]),p[_]=t}for(f>>=m;f>0;){var v=s[r].s;p[v]<t?f-=1<<t-p[v]++-1:++r}for(;r>=0&&f;--r){var b=s[r].s;p[b]==t&&(--p[b],++f)}h=t}return{t:new vt(p),l:h}},Zt=function(e,t,n){return-1==e.s?Math.max(Zt(e.l,t,n+1),Zt(e.r,t,n+1)):t[e.s]=n},en=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new bt(++t),r=0,i=e[0],s=1,a=function(e){n[r++]=e},o=1;o<=t;++o)if(e[o]==i&&o!=t)++s;else{if(!i&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(i),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(i);s=1,i=e[o]}return{c:n.subarray(0,r),n:t}},tn=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},nn=function(e,t,n){var r=n.length,i=Ht(t+2);e[i]=255&r,e[i+1]=r>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var s=0;s<r;++s)e[i+s+4]=n[s];return 8*(i+4+r)},rn=function(e,t,n,r,i,s,a,o,c,l,u){Xt(t,u++,n),++i[256];for(var d=Qt(i,15),g=d.t,p=d.l,h=Qt(s,15),f=h.t,m=h.l,E=en(g),_=E.c,v=E.n,b=en(f),T=b.c,S=b.n,y=new bt(19),I=0;I<_.length;++I)++y[31&_[I]];for(I=0;I<T.length;++I)++y[31&T[I]];for(var A=Qt(y,7),w=A.t,O=A.l,D=19;D>4&&!w[It[D-1]];--D);var N,R,L,k,P=l+5<<3,C=tn(i,xt)+tn(s,Ut)+a,M=tn(i,g)+tn(s,f)+a+14+3*D+tn(y,w)+2*y[16]+3*y[17]+7*y[18];if(c>=0&&P<=C&&P<=M)return nn(t,u,e.subarray(c,c+l));if(Xt(t,u,1+(M<C)),u+=2,M<C){N=Mt(g,p,0),R=g,L=Mt(f,m,0),k=f;var x=Mt(w,O,0);Xt(t,u,v-257),Xt(t,u+5,S-1),Xt(t,u+10,D-4),u+=14;for(I=0;I<D;++I)Xt(t,u+3*I,w[It[I]]);u+=3*D;for(var U=[_,T],B=0;B<2;++B){var W=U[B];for(I=0;I<W.length;++I){var V=31&W[I];Xt(t,u,x[V]),u+=w[V],V>15&&(Xt(t,u,W[I]>>5&127),u+=W[I]>>12)}}}else N=Bt,R=xt,L=Vt,k=Ut;for(I=0;I<o;++I){var F=r[I];if(F>255){Jt(t,u,N[(V=F>>18&31)+257]),u+=R[V+257],V>7&&(Xt(t,u,F>>23&31),u+=St[V]);var K=31&F;Jt(t,u,L[K]),u+=k[K],K>3&&(Jt(t,u,F>>5&8191),u+=yt[K])}else Jt(t,u,N[F]),u+=R[F]}return Jt(t,u,N[256]),u+R[256]},sn=new Tt([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),an=new vt(0),on=function(e,t,n,r,i,s){var a=s.z||e.length,o=new vt(r+a+5*(1+Math.ceil(a/7e3))+i),c=o.subarray(r,o.length-i),l=s.l,u=7&(s.r||0);if(t){u&&(c[0]=s.r>>3);for(var d=sn[t-1],g=d>>13,p=8191&d,h=(1<<n)-1,f=s.p||new bt(32768),m=s.h||new bt(h+1),E=Math.ceil(n/3),_=2*E,v=function(t){return(e[t]^e[t+1]<<E^e[t+2]<<_)&h},b=new Tt(25e3),T=new bt(288),S=new bt(32),y=0,I=0,A=s.i||0,w=0,O=s.w||0,D=0;A+2<a;++A){var N=v(A),R=32767&A,L=m[N];if(f[R]=L,m[N]=R,O<=A){var k=a-A;if((y>7e3||w>24576)&&(k>423||!l)){u=rn(e,c,0,b,T,S,I,w,D,A-D,u),w=y=I=0,D=A;for(var P=0;P<286;++P)T[P]=0;for(P=0;P<30;++P)S[P]=0}var C=2,M=0,x=p,U=R-L&32767;if(k>2&&N==v(A-U))for(var B=Math.min(g,k)-1,W=Math.min(32767,A),V=Math.min(258,k);U<=W&&--x&&R!=L;){if(e[A+C]==e[A+C-U]){for(var F=0;F<V&&e[A+F]==e[A+F-U];++F);if(F>C){if(C=F,M=U,F>B)break;var K=Math.min(U,F-2),j=0;for(P=0;P<K;++P){var G=A-U+P&32767,H=G-f[G]&32767;H>j&&(j=H,L=G)}}}U+=(R=L)-(L=f[R])&32767}if(M){b[w++]=268435456|Dt[C]<<18|Lt[M];var q=31&Dt[C],Y=31&Lt[M];I+=St[q]+yt[Y],++T[257+q],++S[Y],O=A+C,++y}else b[w++]=e[A],++T[e[A]]}}for(A=Math.max(A,O);A<a;++A)b[w++]=e[A],++T[e[A]];u=rn(e,c,l,b,T,S,I,w,D,A-D,u),l||(s.r=7&u|c[u/8|0]<<3,u-=7,s.h=m,s.p=f,s.i=A,s.w=O)}else{for(A=s.w||0;A<a+l;A+=65535){var z=A+65535;z>=a&&(c[u/8|0]=l,z=a),u=nn(c,u+1,e.subarray(A,z))}s.i=a}return qt(o,0,r+Ht(u)+i)},cn=function(e,t,n,r,i){if(!i&&(i={l:1},t.dictionary)){var s=t.dictionary.subarray(-32768),a=new vt(s.length+e.length);a.set(s),a.set(e,s.length),e=a,i.w=s.length}return on(e,null==t.level?6:t.level,null==t.mem?i.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,n,r,i)};function ln(e,t){return cn(e,t||{},0,0)}function un(e,t){return $t(e,{i:2},t&&t.out,t&&t.dictionary)}var dn="undefined"!=typeof TextEncoder&&new TextEncoder,gn="undefined"!=typeof TextDecoder&&new TextDecoder;try{gn.decode(an,{stream:!0})}catch(e){}var pn=function(e){for(var t="",n=0;;){var r=e[n++],i=(r>127)+(r>223)+(r>239);if(n+i>e.length)return{s:t,r:qt(e,n-1)};i?3==i?(r=((15&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|r>>10,56320|1023&r)):t+=1&i?String.fromCharCode((31&r)<<6|63&e[n++]):String.fromCharCode((15&r)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(r)}};function hn(e,t){if(t){for(var n=new vt(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);return n}if(dn)return dn.encode(e);var i=e.length,s=new vt(e.length+(e.length>>1)),a=0,o=function(e){s[a++]=e};for(r=0;r<i;++r){if(a+5>s.length){var c=new vt(a+8+(i-r<<1));c.set(s),s=c}var l=e.charCodeAt(r);l<128||t?o(l):l<2048?(o(192|l>>6),o(128|63&l)):l>55295&&l<57344?(o(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++r))>>18),o(128|l>>12&63),o(128|l>>6&63),o(128|63&l)):(o(224|l>>12),o(128|l>>6&63),o(128|63&l))}return qt(s,0,a)}function fn(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}if(gn)return gn.decode(e);var i=pn(e),s=i.s;return(n=i.r).length&&zt(8),s}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function mn(e){try{let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";const n=atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return fn(un(r))}catch(e){return null}}function En(e){if("undefined"==typeof document)return null;const t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){const r=n[e].trim();if(0===r.indexOf(t)){const e=r.substring(t.length);try{return decodeURIComponent(e)}catch(t){return e}}}return null}const{SUBSCRIPTION_DETAILS_KEYS:_n,USER_DATA_KEYS:vn,ATTRIBUTE_KEYS:bn,IDENTITY_MAP_KEYS:Tn,SESSION_KEYS:Sn,SOURCE_KEYS:yn,DEVICE_DATA_KEYS:In}=R;function An(e){if(!e)return e;const{domain:t,token:n,endpoint:r,keys:i,p256dh:s,auth:a}=_n,o={};return e[t]&&(o.domain=e[t]),e[n]&&(o.token=e[n]),e[r]&&("string"==typeof e[r]&&e[r].startsWith("h://")?o.endpoint=e[r].replace("h://","https://"):o.endpoint=e[r]),e[i]&&(o.keys={},e[i][s]&&(o.keys.p256dh=e[i][s]),e[i][a]&&(o.keys.auth=e[i][a])),o}function wn(e){if(!e)return e;const{attributes:t,subscribedToOldSdk:n,deviceUuid:r,deviceAdded:i}=vn,{key:s,value:a,updated_at:o,level:c}=bn,l={};return e.attributes&&(l[t]=e.attributes.map(e=>{const t={};return e.key&&(t[s]=function(e){const t=h.find(t=>t.attributeName===e);return t?t.moeName:e}(e.key)),void 0!==e.value&&(t[a]=e.value),void 0!==e.updated_at&&(t[o]=e.updated_at),void 0!==e.level&&(t[c]=e.level),t})),void 0!==e.subscribedToOldSdk&&(l[n]=e.subscribedToOldSdk),e.deviceUuid&&(l[r]=e.deviceUuid),void 0!==e.deviceAdded&&(l[i]=e.deviceAdded),l}function On(e){if(!e)return e;const{attributes:t,subscribedToOldSdk:n,deviceUuid:r,deviceAdded:i}=vn,{key:s,value:a,updated_at:o,level:c}=bn,l={};return e[t]&&(l.attributes=e[t].map(e=>{const t={};return e[s]&&(t.key=function(e){const t=h.find(t=>t.moeName===e);return t?t.attributeName:e}(e[s])),void 0!==e[a]&&(t.value=e[a]),void 0!==e[o]&&(t.updated_at=e[o]),void 0!==e[c]&&(t.level=e[c]),t})),void 0!==e[n]&&(l.subscribedToOldSdk=e[n]),e[r]&&(l.deviceUuid=e[r]),void 0!==e[i]&&(l.deviceAdded=e[i]),l}function Dn(e){if(!e)return e;const{userIdentities:t,previousIdentities:n,previousIdentitiesUpdatedTime:r}=Tn,i={};return e[t]&&(i.userIdentities=e[t]),e[n]&&(i.previousIdentities=e[n]),void 0!==e[r]&&(i.previousIdentitiesUpdatedTime=e[r]),i}function Nn(e){if(!e)return e;const{sessionKey:t,sessionStartTime:n,sessionMaxTime:r,customIdentifiersToTrack:i,sessionExpiryTime:s,numberOfSessions:a,currentSource:o}=Sn,c={};return e.sessionKey&&(c[t]=e.sessionKey),e.sessionStartTime&&(c[n]=e.sessionStartTime),void 0!==e.sessionMaxTime&&(c[r]=e.sessionMaxTime),e.customIdentifiersToTrack&&(c[i]=e.customIdentifiersToTrack),void 0!==e.sessionExpiryTime&&(c[s]=e.sessionExpiryTime),void 0!==e.numberOfSessions&&(c[a]=e.numberOfSessions),e.currentSource&&(c[o]=function(e){if(!e)return e;const{source:t,medium:n,source_url:r,term:i,campaign_name:s,campaign_id:a,content:o,extra:c}=yn,l={};e.source&&(l[t]=e.source);e.medium&&(l[n]=e.medium);e.source_url&&(l[r]=e.source_url);e.term&&(l[i]=e.term);e.campaign_name&&(l[s]=e.campaign_name);e.campaign_id&&(l[a]=e.campaign_id);e.content&&(l[o]=e.content);e.extra&&(l[c]=e.extra);return l}(e.currentSource)),c}function Rn(e){if(!e)return e;const{sessionKey:t,sessionStartTime:n,sessionMaxTime:r,customIdentifiersToTrack:i,sessionExpiryTime:s,numberOfSessions:a,currentSource:o}=Sn,c={};return e[t]&&(c.sessionKey=e[t]),e[n]&&(c.sessionStartTime=e[n]),void 0!==e[r]&&(c.sessionMaxTime=e[r]),e[i]&&(c.customIdentifiersToTrack=e[i]),void 0!==e[s]&&(c.sessionExpiryTime=e[s]),void 0!==e[a]&&(c.numberOfSessions=e[a]),e[o]&&(c.currentSource=function(e){if(!e)return e;const{source:t,medium:n,source_url:r,term:i,campaign_name:s,campaign_id:a,content:o,extra:c}=yn,l={};e[t]&&(l.source=e[t]);e[n]&&(l.medium=e[n]);e[r]&&(l.source_url=e[r]);e[i]&&(l.term=e[i]);e[s]&&(l.campaign_name=e[s]);e[a]&&(l.campaign_id=e[a]);e[o]&&(l.content=e[o]);e[c]&&(l.extra=e[c]);return l}(e[o])),c}class Ln{static REVERSE_ENDPOINT_URL_MAPPING=Object.fromEntries(Object.entries(R.ENDPOINT_URL_MAPPING).map(([e,t])=>[t,e]));static REVERSE_COOKIE_NAME_MAPPING=Object.fromEntries(Object.entries(R.COOKIE_NAME_MAPPING).map(([e,t])=>[t,e]));static getCompressedKeyName(e){return R.COOKIE_NAME_MAPPING[e]||e}static getOriginalName(e){return Ln.REVERSE_COOKIE_NAME_MAPPING[e]||e}static getCookieVersion(e,t){if([R.COOKIE_NAME_MAPPING[se],R.COOKIE_NAME_MAPPING[Q.HARD_ASK_STATUS],R.COOKIE_NAME_MAPPING[Q.SOFT_ASK_STATUS],$,R.COOKIE_NAME_MAPPING[Q.OPT_IN_SHOWN_TIME],R.COOKIE_NAME_MAPPING[Q.SDK_DISABLED]].includes(e))return 3;if(Object.keys(R.COOKIE_NAME_MAPPING).includes(e))return 1;if(Object.values(R.COOKIE_NAME_MAPPING).includes(e))try{let n;try{if(n=JSON.parse(t),Ln.hasV3Structure(n,e))return 3;if("string"==typeof n){const e=mn(n);if(null!==e)try{JSON.parse(e);return 3}catch(e){}}return 2}catch(e){const r=mn(t);if(null!==r)try{return n=JSON.parse(r),3}catch(e){return 2}return 2}}catch(e){return 2}return 1}static hasV3Structure(e,t){if(!e||"object"!=typeof e)return!1;switch(Ln.getOriginalName(t)){case Q.SUBSCRIPTION_DETAILS:return e.e&&"string"==typeof e.e&&e.e.length<=2;case Q.USER_DATA:return e.d_uid||e.a&&!Array.isArray(e.a)||!e.hasOwnProperty("a");case Q.IDENTITY_MAP:return!e.hasOwnProperty("p_i")||!e.hasOwnProperty("p_i_u_t");case Q.SESSION:return e.s_s_t&&"number"==typeof e.s_s_t;default:return!1}}static getAllCookieNames(e){const t=[e],n=R.COOKIE_NAME_MAPPING[e];return n&&n!==e&&t.push(n),t}static compressValue(e,t){if(null==e)return e;if("object"!=typeof e||Array.isArray(e))return"boolean"!=typeof e||t!==Q.SDK_DISABLED&&t!==se?"string"==typeof e&&Object.keys(R.PERMISSION_STATE_MAPPING).includes(e)?R.PERMISSION_STATE_MAPPING[e]:e:e?1:0;const n=Ln.compressObjectV3(e,t);if(null===n)return null;const r=JSON.stringify(n),i=function(e){try{const t=ln(hn(e));let n="";for(let e=0;e<t.length;e++)n+=String.fromCharCode(t[e]);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}catch(e){return null}}(r);if(null!==i){const e=encodeURIComponent(r).length;if(i.length<e){if(mn(i)===r)return i}}return n}static decompressValue(e,t,n){if(null==e)return e;if(void 0===n){const r=Ln.getCompressedKeyName(t);n="string"==typeof e?Ln.getCookieVersion(r,e):2}if((3===n||void 0===n)&&"string"==typeof e){const r=mn(e);if(null!==r)try{const e=JSON.parse(r);return Ln.decompressObjectV3(e,t)}catch(e){n=2}}if(1===n&&Ln.isLegacyValue(e))return"string"===e.MOE_DATA_TYPE?e.actualValue?String(e.actualValue):null:(e.MOE_DATA_TYPE,e.actualValue);if(!("number"!=typeof e||0!==e&&1!==e||t!==Q.SDK_DISABLED&&t!==se))return 1===e;if("number"==typeof e&&e>=0&&e<=6&&(t===Q.SOFT_ASK_STATUS||t===Q.HARD_ASK_STATUS))return Object.keys(R.PERMISSION_STATE_MAPPING).find(t=>R.PERMISSION_STATE_MAPPING[t]===e);if("object"==typeof e&&!Array.isArray(e)){if(void 0===n||2===n){const n=Ln.getCompressedKeyName(t);if(Ln.hasV3Structure(e,n))return Ln.decompressObjectV3(e,t)}return 3===n?Ln.decompressObjectV3(e,t):Ln.decompressObject(e,t)}return e}static compressObjectV3(e,t){if(!e)return e;switch(t){case Q.SUBSCRIPTION_DETAILS:return Ln.compressSubscriptionDetailsV3(e);case Q.USER_DATA:return Ln.compressUserDataV3(e);case Q.IDENTITY_MAP:return Ln.compressIdentityMapV3(e);case Q.SESSION:return Ln.compressSessionV3(e);case Q.DEVICE_DATA:return null;default:return e}}static compressSubscriptionDetailsV3(e){const t=function(e){if(!e)return e;const{domain:t,token:n,endpoint:r,keys:i,p256dh:s,auth:a}=_n,o={};return e.domain&&(o[t]=e.domain),e.token&&(o[n]=e.token),e.endpoint&&(o[r]=e.endpoint),e.keys&&(o[i]={},e.keys.p256dh&&(o[i][s]=e.keys.p256dh),e.keys.auth&&(o[i][a]=e.keys.auth)),o}(e);if(t.e&&"string"==typeof t.e){const e=R.ENDPOINT_URL_MAPPING[t.e];e&&(t.e=e)}return t}static compressUserDataV3(e){const t=wn(e);if(!t.d_uid){const e=Ln.getDeviceDataForMigration();e&&e.deviceUniqueId&&(t.d_uid=e.deviceUniqueId)}if(t.d_id&&delete t.d_id,t.a&&Array.isArray(t.a)&&0===t.a.length&&delete t.a,t.a&&Array.isArray(t.a)&&t.a.length>0){const e={};t.a.forEach(t=>{if(t.k&&void 0!==t.v){const n=t.l?`${t.k}_p_attr`:t.k;e[n]={v:t.v,u_at:t.u_at,l:t.l||void 0}}}),t.a=e}return t}static compressIdentityMapV3(e){const t=function(e){if(!e)return e;const{userIdentities:t,previousIdentities:n,previousIdentitiesUpdatedTime:r}=Tn,i={};return e.userIdentities&&(i[t]=e.userIdentities),e.previousIdentities&&(i[n]=e.previousIdentities),void 0!==e.previousIdentitiesUpdatedTime&&(i[r]=e.previousIdentitiesUpdatedTime),i}(e);return t.p_i&&0!==Object.keys(t.p_i).length||0!==t.p_i_u_t||(delete t.p_i,delete t.p_i_u_t),t}static compressSessionV3(e){const t=Nn(e);if(t.s_s_t&&"string"==typeof t.s_s_t){const e=new Date(t.s_s_t).getTime();t.s_s_t=e}return t}static decompressObject(e,t){if(!e)return e;switch(t){case Q.SUBSCRIPTION_DETAILS:return An(e);case Q.USER_DATA:return On(e);case Q.IDENTITY_MAP:return Dn(e);case Q.SESSION:return Rn(e);case Q.DEVICE_DATA:return function(e){if(!e)return e;const{deviceUniqueId:t}=In,n={};return e[t]&&(n.deviceUniqueId=e[t]),n}(e);default:return e}}static decompressObjectV3(e,t){if(!e)return e;switch(t){case Q.SUBSCRIPTION_DETAILS:return Ln.decompressSubscriptionDetailsV3(e);case Q.USER_DATA:return Ln.decompressUserDataV3(e);case Q.IDENTITY_MAP:return Ln.decompressIdentityMapV3(e);case Q.SESSION:return Ln.decompressSessionV3(e);case Q.DEVICE_DATA:return Ln.getDeviceDataFromUserData();default:return e}}static decompressSubscriptionDetailsV3(e){const t={...e};if(t.e&&"string"==typeof t.e){const e=Ln.REVERSE_ENDPOINT_URL_MAPPING[t.e];e&&(t.e=e)}return An(t)}static decompressUserDataV3(e,t){const n={...e},r=!n.hasOwnProperty("a");if(n.a&&"object"==typeof n.a&&!Array.isArray(n.a)){const e=Object.entries(n.a).map(([e,t])=>{const n=void 0!==t.l,r=e.endsWith("_p_attr");return{k:n&&r?e.slice(0,-7):e,v:t.v,u_at:t.u_at||(new Date).getTime(),l:t.l||void 0}});n.a=e}r&&(n.a=[]);const i=On(n);if(!i.deviceUuid){const e=En("moe_uuid");e&&(i.deviceUuid=e)}return i}static decompressIdentityMapV3(e){const t={...e};return t.hasOwnProperty("p_i")||(t.p_i={}),t.hasOwnProperty("p_i_u_t")||(t.p_i_u_t=0),Dn(t)}static decompressSessionV3(e){const t={...e};return t.s_s_t&&"number"==typeof t.s_s_t&&(t.s_s_t=new Date(t.s_s_t).toISOString()),Rn(t)}static getDeviceDataForMigration(){if("undefined"==typeof localStorage)return null;try{const e=localStorage.getItem("MOE_DATA");if(e){const t=JSON.parse(e);if(t&&t.DEVICE_DATA&&t.DEVICE_DATA.deviceUniqueId)return t.DEVICE_DATA}}catch(e){}return null}static getDeviceDataFromUserData(){const e=Ln.getAllCookieNames(Q.USER_DATA);for(const t of e){const e=En(t);if(null!==e)try{let t=JSON.parse(e);if("string"==typeof t){const e=mn(t);null!==e&&(t=JSON.parse(e))}if(t.d_uid)return{deviceUniqueId:t.d_uid};const n=Ln.decompressUserDataV3(t);if(n.deviceUuid)return{deviceUniqueId:n.deviceUuid}}catch(e){continue}}return null}static isCompressedCookie(e){return e.startsWith("moe_")&&Object.values(R.COOKIE_NAME_MAPPING).includes(e)}static isLegacyValue(e){return"object"==typeof e&&null!==e&&e.hasOwnProperty("MOE_DATA_TYPE")&&e.hasOwnProperty("actualValue")}}class kn{static baseTag="CookieStorage";static set(e,t){if(Et.get()?.disableCookies)return;const n=kn.baseTag+".set";if(null==t)kn.remove(e);else{if(e===Q.PUSH_TOKEN)return void ct.log(2,n,"Skipping PUSH_TOKEN as it is redundant with SUBSCRIPTION_DETAILS");if(e===Q.DEVICE_DATA)return;const r=Ln.compressValue(t,e),i=Ln.getCompressedKeyName(e);let s;kn.cleanupOldVersions(e,i),s="string"==typeof r?r:"object"==typeof r&&null!==r?JSON.stringify(r):String(r);const a=Date.now(),o=";expires="+new Date(a+31536e6*ie.EXPIRY_YEARS).toUTCString();document.cookie=i+"="+encodeURIComponent(s)+o+";domain="+kn.getOrigin()+kn.getCookieFlags()}}static get(e){if(Et.get()?.disableCookies)return;const t=Ln.getAllCookieNames(e);let n=null,r=null,i=1;for(const e of t)if(n=kn.getCookieValue(e),null!==n){r=e,i=Ln.getCookieVersion(e,n);break}if(null===n)return null;const s=kn.processParseValue(n,e,i>1,i);return r&&i<3&&kn.migrateToV3(e,s,r),s}static migrateToV3(e,t,n){const r=kn.baseTag+".migrateToV3";try{kn.set(e,t),kn.removeSpecificCookie(n)}catch(e){ct.error(2,r,`Failed to migrate cookie ${n} to V3:`,e)}}static cleanupOldVersions(e,t){Ln.getAllCookieNames(e).forEach(e=>{const t=kn.getCookieValue(e);if(null!==t){Ln.getCookieVersion(e,t)<3&&kn.removeSpecificCookie(e)}})}static removeSpecificCookie(e){document.cookie=e+"=;domain="+kn.getOrigin()+";expires=Thu, 01 Jan 1970 00:00:01 GMT"+kn.getCookieFlags()}static getCookieValue(e){const t=e+"=",n=kn.getDecodedCookies();for(let e=n.length-1;e>=0;e--){let r=n[e];for(;" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null}static processParseValue(e,t,n,r){const i="MOE_DATA_TYPE",s="actualValue";try{let a;try{a=JSON.parse(e)}catch(t){a=e}Ln.isLegacyValue(a)?"string"===rt(a,i,null)?e=(e=rt(a,s,null))?String(e):null:"boolean"===rt(a,i,null)&&(e=rt(a,s,null)):e=n?Ln.decompressValue(a,t,r):a}catch(e){}return e}static remove(e){if(Et.get()?.disableCookies)return;Ln.getAllCookieNames(e).forEach(e=>{kn.removeSpecificCookie(e)})}static setRaw(e,t,n){if(Et.get()?.disableCookies)return;kn.baseTag;if(null==t)kn.remove(e);else{let r="";null!=n&&(r=";expires="+n.toISOString()),document.cookie=e+"="+encodeURIComponent(t)+r+";domain="+kn.getOrigin()+kn.getCookieFlags()}}static getOrigin(){if(Et.get()?.disableCookies)return"";const e=kn.baseTag+".getOrigin",t=window.location.hostname;if("localhost"===t||"127.0.0.1"===t)return ct.warn(1,e,"Cross domain user persistence will not work with localhost. \n\nWe will save the key-value pairs in the localhost cookie store for reference. You'll be able to test this functionality in a hosted staging/test environment."),"";const n=t.split(".");if(n.length<=1||2===n.length)return"."+t;const r=n[n.length-1],i=n[n.length-2],s=2===r.length,a=i.length>=2&&i.length<=3,o=s&&a;return 3===n.length?o?"."+t:"."+n.slice(-2).join("."):n.length>=4?o?"."+n.slice(-3).join("."):"."+n.slice(-2).join("."):void 0}static getCookieFlags(){return"https:"===window.location.protocol||"chrome-extension:"===window.location.protocol?";path=/;SameSite=None;Secure":";path=/;"}static getDecodedCookies(){const e=kn.baseTag+".getDecodedCookies";return document.cookie.split(";").map(t=>{let n=t.trim();"%"===n.slice(-1)&&(n+="25");try{return decodeURIComponent(n)}catch(t){return ct.error(2,e,"Error decoding cookie:",n,t),n}})}}const Pn="MOE_DATA";class Cn{static baseLogTag="PersistentStorage";static prefix="";static isSharedWithCookie=!1;static KEYS_SHARED_WITH_COOKIE=[Q.USER_DATA,Q.SUBSCRIPTION_DETAILS,Q.SOFT_ASK_STATUS,Q.OPT_IN_SHOWN_TIME,Q.HARD_ASK_STATUS,Q.SESSION,Q.DEVICE_DATA,Q.IDENTITY_MAP,Q.SDK_DISABLED];static moeDataStore;static setPrefix(e){Cn.prefix=e+"_"}static set(e,t){Cn.baseLogTag;if(e=Cn.prefix+e,localStorage){const n=Cn.getMoeData();n[e]=t,localStorage.setItem(Pn,JSON.stringify(n))}const n=Cn.KEYS_SHARED_WITH_COOKIE.indexOf(e);if(Cn.isSharedWithCookie&&n>=0){const r="object"!=typeof t||Array.isArray(t)?t:{...t};if(0===n&&Array.isArray(r.attributes)){const e=Cn.get(Q.WEB_SETTINGS);r.attributes=r.attributes.filter(t=>!!this.isPushBillingOrIdentityAttribute(t.key,e))}e===Q.SUBSCRIPTION_DETAILS&&(r.domain=t.domain,r.token=t.token,r.endpoint=t.endpoint,r.keys=t.keys),kn.set(e,r)}}static get(e){Cn.baseLogTag;if(e=Cn.prefix+e,localStorage){return rt(Cn.getMoeData(),e,null)}return null}static remove(e){const t=Cn.baseLogTag+".remove",n=Cn.prefix+e;if(localStorage&&null!=Cn.get(e)){const r=Cn.getMoeData();delete r[n],localStorage.setItem(Pn,JSON.stringify(r)),ct.log(2,t,"Key",e,"removed.")}Cn.isSharedWithCookie&&Cn.KEYS_SHARED_WITH_COOKIE.indexOf(e)>=0&&kn.remove(e)}static logout(){const e=["INIT_DATA","Q","WEB_SETTINGS","SUBSCRIPTION_DETAILS","PUSH_TOKEN","GRACEFUL_DATA","DEVICE_DATA","SDK_VERSION","SDK_DISABLED"];for(const t in Q){if([Q.HARD_ASK_STATUS,Q.SOFT_ASK_STATUS].includes(t)){const e=Cn.get(Q.SUBSCRIPTION_DETAILS);if(e&&e.domain!==window.location.origin)continue}e.indexOf(t)<0&&Cn.remove(Q[t])}for(const e in Q.Q)mt.purge(e)}static getString(e){if(e=Cn.prefix+e,localStorage){const t=Cn.get(e);return"string"==typeof t||t instanceof String?t:JSON.stringify(t)}}static removePrefix(){Cn.prefix=""}static copyKeysFromCookie(){let e=null;for(let t=0;t<Cn.KEYS_SHARED_WITH_COOKIE.length;t++){const n=Cn.KEYS_SHARED_WITH_COOKIE[t],r=kn.get(n);if(null!=r){const t="object"!=typeof r||Array.isArray(r)?r:{...r};if(n===Q.USER_DATA){const r=Cn.get(n)&&Cn.get(n).attributes;if(Array.isArray(t.attributes)&&Array.isArray(r)&&r.length>0){let e=[...r];t.attributes.forEach(t=>{const n=e.findIndex(e=>e.key===t.key&&e.level===t.level);n>=0?e[n]=t:e.push(t)});const n=Cn.get(Q.WEB_SETTINGS);e=e.filter(e=>{if(this.isPushBillingOrIdentityAttribute(e.key,n)){if(t.attributes.findIndex(t=>t.key===e.key&&t.level===e.level)<0)return!1}return!0}),t.attributes=e}t.d_uid&&(e={deviceUniqueId:t.d_uid},delete t.d_uid)}else n===Q.DEVICE_DATA&&(e=t);Cn.set(n,t)}}e&&Cn.set(Q.DEVICE_DATA,e),kn.get(Q.PUSH_TOKEN)&&kn.remove(Q.PUSH_TOKEN),Cn.removeStaleKeysFromLS(),Cn.copyIdentitiesFromCookiesToIDB()}static isPushBillingOrIdentityAttribute(e,t){const n=t?.configs?.identityAttributes||[],r=t?.configs?.subscriberBasedBillingAttributes||[];return!!(t?.isPushSubBilling&&ft(e,r)||p.includes(e)||n.includes(h.find(t=>t.attributeName===e)?.moeName||e))}static copyIdentitiesFromCookiesToIDB(){const e=`${this.baseLogTag}.copyIdentitiesFromCookiesToIDB`,t=kn.get(Q.IDENTITY_MAP),n=kn.get(Q.USER_DATA),r={};if(t?.userIdentities){const{userIdentities:e,previousIdentities:n,previousIdentitiesUpdatedTime:i}=t;r.userIdentities=e,r.previousIdentities=n,r.previousIdentitiesUpdatedTime=i}n?.attributes?.length&&n.attributes.find(e=>e.key===s)&&(r.moe_user_id=n.attributes.find(e=>e.key===s).value),this.moeDataStore?.getItem||(this.moeDataStore=pt().createInstance({driver:[pt().INDEXEDDB],name:"moe_database",storeName:"moe_data"}),this.moeDataStore&&(this.moeDataStore.setItem(m,r),ct.log(2,e,"Copied identities from cookie to IndexedDB")))}static removeStaleKeysFromLS(){const e=Cn.baseLogTag+".removeStaleKeysFromLS";try{Object.keys(Cn.getMoeData()).forEach(e=>{const t=kn.get(e);!this.KEYS_SHARED_WITH_COOKIE.includes(e)||ue.includes(e)||t||!1===t||Cn.remove(e)})}catch(t){ct.error(1,e,t)}}static getMoeData(){const e=Cn.baseLogTag+".getMoeData";let t=localStorage.getItem(Pn);if(null==t)return{};try{return t=JSON.parse(t),t}catch(t){return ct.error(1,e,t),{}}}}class Mn{key;value;updated_at;constructor(e,t){this.key=e,this.value=t,this.updated_at=(new Date).getTime()}static equal(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)}}class xn{name;attributes;constructor(e,t,n=!0){this.name=e,this.attributes=t,n&&this.attributes.push(new Mn(H,location.href))}}class Un{static baseLogTag="CampaignDataModel";experiences;user_in_gcg;personalization_used;split_experiences;constructor(e){this.experiences=e?.experiences?.map(e=>new Bn(e)),this.user_in_gcg=e&&e.user_in_gcg,this.personalization_used=e?.personalization_used,this.split_experiences=e?.split_experiences||[]}}class Bn{delivery;url;id;gcg_enabled;expiry_time;updated_time;context;payload;name;status;in_session_behaviour_segment;url_filters;is_ai;page_attributes;tab_list;constructor(e){this.delivery=rt(e,"delivery",{}),this.url=rt(e,"url",""),this.id=rt(e,"id",""),this.gcg_enabled=rt(e,"gcg_enabled"),this.expiry_time=rt(e,"expiry_time"),this.updated_time=rt(e,"updated_time"),this.context=rt(e,"context",{}),this.payload=rt(e,"payload",[]),this.name=rt(e,"name",""),this.status=rt(e,"status",""),this.in_session_behaviour_segment=rt(e,"in_session_behaviour_segment"),this.url_filters=rt(e,"url_filters"),this.is_ai=rt(e,"is_ai"),this.page_attributes=rt(e,"page_attributes"),this.tab_list=rt(e,"tab_list")}}var Wn,Vn,Fn,Kn;!function(e){e.AND="and",e.OR="or"}(Wn||(Wn={})),function(e){e.BOOL="bool",e.STRING="string",e.DATE="datetime",e.NUMBER="double",e.LONG="long",e.ARRAY_BOOL="array_bool",e.ARRAY_NUMBER="array_double",e.ARRAY_STRING="array_string",e.ARRAY_DATETIME="array_datetime"}(Vn||(Vn={})),function(e){e.EQ="is",e.LT="lessThan",e.GT="greaterThan",e.BETWEEN="between",e.IN="in",e.EXISTS="exists",e.CONTAINS="contains",e.STARTSWITH="startsWith",e.ENDSWITH="endsWith",e.INTHELAST="inTheLast",e.INTHENEXT="inTheNext",e.AFTER="after",e.BEFORE="before",e.ON="on",e.TODAY="today"}(Fn||(Fn={})),function(e){e.ALLOF="all_of",e.ANYOFF="any_of"}(Kn||(Kn={}));class jn{static REMOVE_TRAIL_CHARS=/[^\w\s]+$/gi}class Gn{dataType;availableOperations;event;filter;regex;constructor(e,t,n,r){this.dataType=e,this.availableOperations=t,this.event=n,this.filter=r}validate(){return!(this.availableOperations.indexOf(this.filter.operator)<0)}checkEq(){let e=!1;const t=(t,n)=>{this.dataType===Vn.STRING&&typeof t===Vn.STRING&&(t=this.removeSpecialChars(t),n=this.removeSpecialChars(n)),this.dataType!==Vn.STRING||this.filter.case_sensitive||t.toLowerCase()!==n.toLowerCase()?t===n&&(e=!0):e=!0};if(this.event)this.event.attributes.forEach(e=>{e.key===this.filter.name&&t(e.value,this.filter.value)});else{const e=this.getPageContextObjectValue(this.filter.name);t(e,this.filter.value)}return e}checkExists(){let e=!1;if(this.event)this.event.attributes.forEach(t=>{t.key===this.filter.name&&(e=!0)});else{this.getPageContextObjectValue(this.filter.name)&&(e=!0)}return e}removeSpecialChars(e){return e.replace(jn.REMOVE_TRAIL_CHARS,"")}getPageContextObjectValue(e){const t=e.split(".");let n=Zi();for(const e of t)n=n[e];return n}}const Hn=e=>"string"==typeof e,qn=e=>"[object Date]"===Object.prototype.toString.call(e),Yn=e=>Array.isArray(e),zn=[Fn.EQ,Fn.EXISTS,Fn.CONTAINS,Fn.STARTSWITH,Fn.ENDSWITH,Fn.IN];class $n extends Gn{static baseLogTag="StringDataType";value;constructor(e,t){super(Vn.STRING,zn,e,t),this.event||(this.value=this.getPageContextObjectValue(t.name))}evaluate(){let e=!1;if(this.event){const e=this.event.attributes.filter(e=>e.key===this.filter.name);this.value=e.length>0?e[0].value:null}if(null!=this.value&&Hn(this.value))switch(this.filter.operator){case Fn.EQ:e=this.checkEq();break;case Fn.EXISTS:e=this.checkExists();break;case Fn.CONTAINS:e=this.checkContains();break;case Fn.STARTSWITH:e=this.checkStartsWith();break;case Fn.ENDSWITH:e=this.checkEndsWith();break;case Fn.IN:e=this.checkIn()}return this.filter.negate?!e:e}checkContains(){if(this.event){if(this.filter.case_sensitive)return this.value.indexOf(this.filter.value)>=0}else if(this.filter.case_sensitive)return this.value.indexOf(this.filter.value)>=0;return this.value.toLowerCase().indexOf(this.filter.value.toLowerCase())>=0}checkStartsWith(){const e=(e,t)=>e.substr(0,t.length)===t;return this.filter.case_sensitive?e(this.value,this.filter.value):e(this.value.toLowerCase(),this.filter.value.toLowerCase())}checkEndsWith(){const e=(e,t,n)=>((void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t);if(this.filter.case_sensitive)return e(this.value,this.filter.value);const t=this.removeSpecialChars(this.value),n=this.removeSpecialChars(this.filter.value);return e(t.toLowerCase(),n.toLowerCase())}checkIn(){let e=!1;if(Array.isArray(this.filter.value))for(let t=this.filter.value.length-1;t>=0;t--)if(this.filter.case_sensitive){if(this.filter.value[t]===this.value){e=!0;break}}else if(this.filter.value[t].toLowerCase()===this.value.toLowerCase()){e=!0;break}return e}}const Xn=[Fn.EQ,Fn.EXISTS];class Jn extends Gn{static baseLogTag="BooleanDataType";constructor(e,t){super(Vn.BOOL,Xn,e,t)}evaluate(){let e=!1;switch(this.filter.operator){case Fn.EQ:e=this.checkEq();break;case Fn.EXISTS:e=this.checkExists()}return this.filter.negate?!e:e}}const Qn=[Fn.EXISTS,Fn.ON,Fn.BETWEEN,Fn.BEFORE,Fn.AFTER,Fn.INTHELAST,Fn.INTHENEXT,Fn.TODAY];class Zn extends Gn{static baseLogTag="DateTimeDataType";constructor(e,t){!qn(t.value)&&Hn(t.value)&&(t.value=new Date(t.value.split("Z").join(""))),!qn(t.value2)&&Hn(t.value2)&&null!=t.value2&&(t.value2=new Date(t.value2.split("Z").join(""))),!qn(t.value1)&&Hn(t.value1)&&null!=t.value1&&(t.value1=new Date(t.value1.split("Z").join(""))),super(Vn.DATE,Qn,e,t)}evaluate(){let e=!1;const t=this.event.attributes.filter(e=>e.key===this.filter.name),n=t.length>0?t[0]:null;if(null!=n)switch(n.value.setHours(0,0,0,0),this.filter.operator){case Fn.EQ:e=this.checkEq();break;case Fn.EXISTS:e=this.checkExists();break;case Fn.ON:e=this.checkOn(n);break;case Fn.BETWEEN:e=this.checkBetween(n);break;case Fn.BEFORE:e=this.checkBefore(n);break;case Fn.AFTER:e=this.checkAfter(n);break;case Fn.INTHELAST:e=this.checkLastX(n);break;case Fn.INTHENEXT:e=this.checkNextX(n);break;case Fn.TODAY:e=this.checkToday(n)}return this.filter.negate?!e:e}checkOn(e){return e.value.setHours(0,0,0,0)===this.filter.value.setHours(0,0,0,0)}checkBetween(e){return this.filter.value2?this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value2.getTime():this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value1.getTime()}checkBefore(e){const{filter:{value:t}}=this;return typeof t===U?((new Date).setHours(0,0,0,0)-e.value.setHours(0,0,0,0))/864e5>t:e.value.setHours(0,0,0,0)<t.setHours(0,0,0,0)}checkAfter(e){const{filter:{value:t}}=this;return typeof t===U?(e.value.setHours(0,0,0,0)-(new Date).setHours(0,0,0,0))/864e5>t:e.value.setHours(0,0,0,0)>t.setHours(0,0,0,0)}checkLastX(e){const t=(new Date).setHours(0,0,0,0),n=e.value.setHours(0,0,0,0);return t-n>0&&(t-n)/864e5<=this.filter.value}checkNextX(e){const t=(new Date).setHours(0,0,0,0),n=e.value.setHours(0,0,0,0);return n-t>0&&(n-t)/864e5<=this.filter.value}checkToday(e){return e.value.setHours(0,0,0,0)===(new Date).setHours(0,0,0,0)}}const er=[Fn.EQ,Fn.EXISTS,Fn.GT,Fn.LT,Fn.BETWEEN,Fn.IN];class tr extends Gn{static baseLogTag="NumberDataType";value;constructor(e,t){super(Vn.NUMBER,er,e,t),this.event||(this.value=this.getPageContextObjectValue(t.name))}evaluate(){let e=!1;if(this.event){const e=this.event.attributes.filter(e=>e.key===this.filter.name);this.value=e.length>0?e[0].value:null}if(null!=this.value&&"number"==typeof this.value)switch(this.filter.operator){case Fn.EQ:e=this.checkEq();break;case Fn.EXISTS:e=this.checkExists();break;case Fn.GT:e=this.checkGreaterThan();break;case Fn.LT:e=this.checkLessThan();break;case Fn.BETWEEN:e=this.checkBetween();break;case Fn.IN:e=this.checkIn()}return this.filter.negate?!e:e}checkGreaterThan(){return this.value>this.filter.value}checkLessThan(){return this.value<this.filter.value}checkBetween(){return this.filter.value2?this.filter.value&&this.filter.value2&&this.filter.value<=this.value&&this.value<this.filter.value2:this.filter.value&&this.filter.value1&&this.filter.value<=this.value&&this.value<this.filter.value1}checkIn(){return Array.isArray(this.filter.value)&&this.filter.value.indexOf(this.value)>=0}}const nr=[Fn.EQ,Fn.EXISTS,Fn.CONTAINS,Fn.STARTSWITH,Fn.ENDSWITH,Fn.IN,Fn.LT,Fn.GT,Fn.BETWEEN,Fn.INTHELAST,Fn.INTHENEXT,Fn.AFTER,Fn.BEFORE,Fn.ON,Fn.TODAY];class rr extends Gn{constructor(e,t){super(t.data_type,nr,e,t)}evaluate(){let e=!1;const t=this.event.attributes.filter(e=>e.key===this.filter.name),n=t.length>0?t[0]:null;return null!=n&&Yn(n.value)&&(e=this.filter.array_filter_type&&this.filter.array_filter_type===Kn.ANYOFF?this.checkAnyOf(n):this.checkAllOf(n)),e}checkAllOf(e){return e.value.every(t=>this.getFilterResult(t,e))}checkAnyOf(e){return e.value.some(t=>this.getFilterResult(t,e))}getFilterResult(e,t){let n=!1;const r=this.createCustomEvent(t.key,e),i=this.getDataType(r);return i.validate()&&(n=i.evaluate()),n}createCustomEvent(e,t){const n=new Mn(e,t);return new xn(this.event.name,[n])}getDataType(e){let t;switch(this.filter.data_type){case Vn.ARRAY_BOOL:t=new Jn(e,this.filter);break;case Vn.ARRAY_DATETIME:t=new Zn(e,this.filter);break;case Vn.ARRAY_NUMBER:t=new tr(e,this.filter);break;case Vn.ARRAY_STRING:t=new $n(e,this.filter)}return t}}class ir{static baseLogTag="TriggerEvaluator";static doesEventMatchFilters(e,t){ir.baseLogTag;let n=!1,r=null;switch(t.data_type){case Vn.BOOL:r=new Jn(e,t),r.validate()&&(n=r.evaluate());break;case Vn.STRING:r=new $n(e,t),r.validate()&&(n=r.evaluate());break;case Vn.NUMBER:case Vn.LONG:r=new tr(e,t),r.validate()&&(n=r.evaluate());break;case Vn.DATE:r=new Zn(e,t),r.validate()&&(n=r.evaluate());break;case Vn.ARRAY_STRING:case Vn.ARRAY_DATETIME:case Vn.ARRAY_BOOL:case Vn.ARRAY_NUMBER:r=new rr(e,t),r.validate()&&(n=r.evaluate())}return n}static doesValueMatchFilter(e,t){const n=new Mn(t.name,e),r=new xn("sample event",[n]);return ir.doesEventMatchFilters(r,t)}}function sr(e){const t=(e=>rt(e,"url_filters.filters",[]))(e);let n=!0;if(t&&t.length>0){const r=new xn("MOE_PAGE_VIEWED",[]),i=e.url_filters.filter_operator,s=t.map(e=>ir.doesEventMatchFilters(r,e));n=s[0];for(let e=0;e<s.length;e++)if(i===Wn.AND){if(n=n&&s[e],!1===n)break}else if(i===Wn.OR&&(n=n||s[e],!0===n))break}return n}const ar={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var or,cr=new Uint8Array(16);function lr(){if(!or&&!(or="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return or(cr)}for(var ur=[],dr=0;dr<256;++dr)ur.push((dr+256).toString(16).slice(1));function gr(e,t=0){return(ur[e[t+0]]+ur[e[t+1]]+ur[e[t+2]]+ur[e[t+3]]+"-"+ur[e[t+4]]+ur[e[t+5]]+"-"+ur[e[t+6]]+ur[e[t+7]]+"-"+ur[e[t+8]]+ur[e[t+9]]+"-"+ur[e[t+10]]+ur[e[t+11]]+ur[e[t+12]]+ur[e[t+13]]+ur[e[t+14]]+ur[e[t+15]]).toLowerCase()}const pr=function(e,t,n){if(ar.randomUUID&&!t&&!e)return ar.randomUUID();var r=(e=e||{}).random||(e.rng||lr)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return gr(r)},hr=async e=>{if(fr(e)){const t=Er(e);ht.inSessionStore.setItem(nt.IN_SESSION_EVENTS,t)}},fr=e=>!!mr(e).length,mr=e=>e.filter(e=>!!e.in_session_behaviour_segment),Er=e=>{let t=[];return e.forEach(e=>{e?.in_session_behaviour_segment?.included_filters&&(t=t.concat(e.in_session_behaviour_segment.included_filters.filters[0].action_name))}),t},_r=async()=>ht&&ht.inSessionStore?new Promise(async(e,t)=>{e(await ht.inSessionStore.getItem(nt.IN_SESSION_EVENTS_HISTORY)||[])}):[];async function vr(e){const t=rt(e,"in_session_behaviour_segment.included_filters.filters",[]),n=rt(e,"in_session_behaviour_segment.included_filters.filter_operator","and");if(!await async function(e,t){return new Promise(async(n,r)=>{const{count:i,type:s}=e,a=await Sr(t);let o;switch(s){case"exactly":o=a===i;break;case"atleast":o=a>=i;break;case"atmost":o=a<=i}n(o)})}(t[0].execution,t[0].action_name))return!1;let r=await br(t[0]);if(t.length>1)for(let e=0;e<t.length;e++)if(n===Wn.AND){if(r=!(!r||!await br(t[e])),!1===r)break}else if(n===Wn.OR&&(r=!(!r&&!await br(t[e])),!0===r))break;return r}async function br(e){const t=rt(e,"attributes.filters",[]);let n=!0;if(t&&t.length>0){const r=await Tr(e.action_name),i=rt(e,"attributes.filter_operator","and"),s=t.map(e=>!!r.find(t=>ir.doesEventMatchFilters(t,e)));n=s[0];for(let e=1;e<s.length;e++)if(i===Wn.AND){if(n=n&&s[e],!1===n)break}else if(i===Wn.OR&&(n=n||s[e],!0===n))break}return n}const Tr=async e=>(await _r()).filter(t=>e===t.name),Sr=async e=>{const t=await _r();let n=0;return t.forEach(t=>{t.name===e&&n++}),n};async function yr(e){const t=rt(e,"page_attributes.filters",[]),n=rt(e,"page_attributes.filter_operator","and"),r=await async function(e,t){if(!window[xe])return!1;let n=!0;if(e&&e.length>0){const r=e.map(e=>ir.doesEventMatchFilters(void 0,e));n=r[0];for(let e=1;e<r.length;e++)if(t===Wn.AND){if(n=n&&r[e],!1===n)break}else if(t===Wn.OR&&(n=n||r[e],!0===n))break}return n}(t,n);return r}const Ir=["MOE_OPT_IN_ATTEMPT"],Ar={TOPIC:"MOE_AUTOMATED_EVENTS",NAMES:["MOE_WEB_UNSUBSCRIBED","EVENT_ACTION_WEB_SESSION_START","MOE_PAGE_VIEWED","EVENT_ACTION_USER_ATTRIBUTE","EVENT_ACTION_DEVICE_ATTRIBUTE","MOE_WEB_OPTIN_BANNER_LOAD","MOE_WEB_OPTIN_CLOSED","MOE_WEB_OPTIN_ACCEPTED","MOE_USER_SUBSCRIBED","MOE_OPT_IN_ATTEMPT","MOE_OPT_IN_SHOWN","MOE_OPT_IN_ALLOWED","MOE_OPT_IN_DISMISSED","MOE_OPT_IN_BLOCKED","MOE_PUSH_PERMISSION_STATE_ALLOWED","MOE_PUSH_PERMISSION_STATE_BLOCKED","MOE_LOGOUT","MOE_FIRST_VISIT","MOE_WEBP_MESSAGE_SHOWN","MOE_WEBP_MESSAGE_CLICKED","MOE_WEBP_MESSAGE_DISMISSED","MOE_WEBP_MESSAGE_DELIVERED","MOE_ONSITE_MESSAGE_CLICKED","MOE_ONSITE_MESSAGE_SHOWN","MOE_ONSITE_MESSAGE_DISMISSED","MOE_ONSITE_MESSAGE_AUTO_DISMISS","MOE_ONSITE_MESSAGE_DELIVERED","MOE_CARD_DELIVERED","MOE_CARD_IMPRESSION","MOE_CARD_CLICKED","MOE_CARD_DISMISSED","MOE_CARD_INBOX_CLICKED","MOE_OFFERING_CLICKED","MOE_OFFERING_SHOWN","MOE_LANDING_PAGE_SHOWN","MOE_LANDING_PAGE_CLICKED","MOE_RESPONSE_SUBMITTED","MOE_PAGE_EXIT","MOE_PAGE_SCROLL","MOE_PAGE_URL_EVENT","MOE_EXIT"]},wr=1,Or={REPORT_ADD:"v2/sdk/report/"},Dr={TIME_BETWEEN_BATCHES:15e3},Nr={TRACK:"v1/sdk/track/click"},Rr="moeq",Lr="User is offline.",kr="moe_tracking",Pr="batched_events",Cr="moe_database",Mr="moe_offline_data_sync",xr={OFFLINE_DATA:{NAME:"offline_data"}};class Ur{static baseLogTag="IdentityMethods";static moeDataStore;static getIdentityMap(){const e=Cn.get(Q.WEB_SETTINGS);return e?.isDomainLevelStorage?this.getIdentitiesFromCookies():this.getIdentitiesFromLocalStorage()}static getIdentitiesFromLocalStorage(){const e=Cn.get(Q.IDENTITY_MAP);return e?.userIdentities?e:null}static getIdentitiesFromCookies(){const e=kn.get(Q.IDENTITY_MAP);if(e&&"object"==typeof e&&e.userIdentities){const t={userIdentities:e.userIdentities};return e.previousIdentities&&(t.previousIdentities=e.previousIdentities,t.previousIdentitiesUpdatedTime=e.previousIdentitiesUpdatedTime),t}return null}static getUserIdentities(){const e=this.getIdentityMap();return e?.userIdentities?e.userIdentities:null}static async updateCurrentUserIdentities(e){let t;const n=this.getIdentityMap();n?.userIdentities?(t={...n,userIdentities:{...n.userIdentities,...e}},Cn.set(Q.IDENTITY_MAP,t)):(this.createIdentityMap(),t={...this.getIdentityMap(),userIdentities:e},Cn.set(Q.IDENTITY_MAP,t)),await this.updateIdentifiersIDB(t)}static broadcastUserIdentityUpdate(){const e=this.baseLogTag+".broadcastUserIdentityUpdate";ct.log(1,e,"User Identities Updated."),Ni.broadcastToWindow({topic:w.TOPIC_NAME,name:w.EVENT_NAMES.USER_IDENTITY_UPDATE})}static broadcastLogout(){Ni.broadcastToWindow({topic:w.TOPIC_NAME,name:w.EVENT_NAMES.LOGOUT})}static async updatePreviousUserIdentities(e,t){let n;const r=this.getIdentityMap();if(r?.userIdentities){const i=r?.previousIdentities||{};n={...r,previousIdentities:{...i,...e},previousIdentitiesUpdatedTime:t||(new Date).getTime()},Cn.set(Q.IDENTITY_MAP,n)}else this.createIdentityMap(),n={...this.getIdentityMap(),previousIdentities:e,previousIdentitiesUpdatedTime:t||(new Date).getTime()},Cn.set(Q.IDENTITY_MAP,n);await this.updateIdentifiersIDB(n)}static async updateIdentifiersIDB(e){if(this.moeDataStore?.getItem||(this.moeDataStore=pt().createInstance({driver:[pt().INDEXEDDB],name:ce,storeName:le})),this.moeDataStore)if(Object.keys(e).length){const t=await this.moeDataStore.getItem(m)||{};await this.moeDataStore.setItem(m,{...t,...e})}else await this.moeDataStore.setItem(m,e)}static copyUidIntoIdentityMap(e){const t=this.baseLogTag+".copyUidIntoIdentityMap",n=e.getAttribute("id");if(n){const e={uid:n};this.updateCurrentUserIdentities(e),ct.log(1,t,"UID copied into IdentityMap.")}}static getIdentifiersFromIdentities(){const{userIdentities:e,previousIdentities:t,previousIdentitiesUpdatedTime:n}=this.getIdentityMap()||{},r={};return e&&Object.keys(e).length&&(r.userIdentities=e),n>0&&((new Date).getTime()-n>216e5?this.removePreviousUserIdentities():r.previousIdentities=t),r}static async removePreviousUserIdentities(){const e=this.baseLogTag+".removePreviousUserIdentities",t={...this.getIdentityMap(),previousIdentities:{},previousIdentitiesUpdatedTime:0};Cn.set(Q.IDENTITY_MAP,t),await this.updateIdentifiersIDB(t),ct.log(1,e,"previousIdentities removed from IdentityMap.")}static createIdentityMap(){Cn.set(Q.IDENTITY_MAP,{userIdentities:{},previousIdentities:{},previousIdentitiesUpdatedTime:0})}}function Br(){const e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))}function Wr(){const e=navigator.userAgent.toLowerCase(),t=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(e);return/nexus player|neo-x5|adt-2|tsbnettv|roku|tizen|smart-tv.+(samsung)|hbbtv.+maple;(\d+)|(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))|(apple) ?tv|crkey|droid.+aft(\w)( bui|\))|\(dtv[\);].+(aquos)|(aquos-tv[\w ]+)\)|(bravia[\w ]+)( bui|\))|(mitv-\w{5}) bui|Hbbtv.*(technisat) (.*);|\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)|hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)|\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i.test(e)?L.TV:t?L.TABLET:Br()?L.MOBILE:L.WEB}function Vr(e,t){const n=t&&new RegExp("^("+t.join("|")+")$");return Wr()!==L.TV||!n?.test(e)&&t?{}:{moe_os_type:Fr(),os:L.TV.toUpperCase()}}function Fr(){const e=navigator.userAgent.toLowerCase();return/tizen/i.test(e)?k:/web0s/i.test(e)?P:/xbox/i.test(e)?C:/vizio/i.test(e)?M:x}function Kr(e,t){if(null==e||null==t)return e===t;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;const n=Object.keys(e);return Object.keys(t).every(e=>-1!==n.indexOf(e))&&n.every(n=>Kr(e[n],t[n]))}class jr{os="web";osPlatform;isMobile;name;isIncognito;constructor(e,t,n){this.osPlatform=e.userAgent,this.isMobile=Br(),this.os=Br()?"mweb":"web",this.name=jr.getBrowserName(e.userAgent,t),this.isIncognito=n}static async getInstance(){if(null==it.get(ee)){const e=await jr.isIncognito(window),t=new jr(navigator,document,e);it.set(ee,t);const n=Cn.get(Q.BROWSER_DETAILS);return n&&jr.isBrowserUpdated(n,t)||Cn.set(ee,t),t}return it.get(ee)}static isIncognito(e){const t=e.RequestFileSystem||e.webkitRequestFileSystem;return new Promise(n=>{t?t(e.TEMPORARY,100,()=>{n(!1)},()=>{n(!0)}):n(!1)})}static getBrowserName(e,t){return-1!==e.indexOf("MSIE")||1==t.documentMode?jr.BROWSER_NAMES.INTERNET_EXPLORER:e.indexOf("Edg")>-1?jr.BROWSER_NAMES.EDGE:e.indexOf("OPR")>-1||e.indexOf("Opera")>-1?jr.BROWSER_NAMES.OPERA:e.indexOf("Chrome")>-1||e.match(/\b(?:crmo|crios)\/([\w\.]+)/i)?e.indexOf("MMS")>-1?jr.BROWSER_NAMES.OPERA_NEON:jr.BROWSER_NAMES.CHROME:e.indexOf("Safari")>-1?jr.BROWSER_NAMES.SAFARI:e.indexOf("Firefox")>-1?jr.BROWSER_NAMES.FIREFOX:jr.BROWSER_NAMES.OTHERS}static isBrowserUpdated(e,t){return Kr(e,t)}isWebPushCompatible(){return this.isChrome()||this.isFirefox()||this.isOpera()||this.isSafari()||this.isEdge()}isChrome(){return this.name===jr.BROWSER_NAMES.CHROME}isFirefox(){return this.name===jr.BROWSER_NAMES.FIREFOX}isOpera(){return this.name===jr.BROWSER_NAMES.OPERA||this.name===jr.BROWSER_NAMES.OPERA_NEON}isSafari(){return this.name===jr.BROWSER_NAMES.SAFARI}isEdge(){return this.name===jr.BROWSER_NAMES.EDGE}static isIOS(){return!(!navigator.userAgent.match(/iPad/i)&&!navigator.userAgent.match(/iPhone/i))}}!function(e){let t;!function(e){e.CHROME="Google Chrome",e.FIREFOX="Mozilla Firefox",e.OPERA="Opera",e.OPERA_NEON="Opera Neon",e.SAFARI="Apple Safari",e.INTERNET_EXPLORER="Internet Explorer",e.EDGE="Edge",e.OTHERS="Others"}(t=e.BROWSER_NAMES||(e.BROWSER_NAMES={}))}(jr||(jr={}));const Gr=jr,Hr=()=>new Promise((e,t)=>{try{const n=JSON.parse(localStorage.getItem("MOE_DATA"));n&&n.WEB_SETTINGS&&n.WEB_SETTINGS.configs&&e(n.WEB_SETTINGS),t("Error in getting sdk settings from localstorage - no data found")}catch(e){ct.error(1,"getSDKSettings","Error in getting sdk settings from localstorage ",e),t(e)}}),qr=()=>new Promise((e,t)=>{try{const t=JSON.parse(localStorage.getItem("MOE_DATA"));return t&&t.INIT_DATA&&e(t.INIT_DATA),{}}catch(e){ct.error(1,"getSDKSettings","Error in getting init data from localstorage ",e),t(e)}});class Yr{key;value;updated_at;level;constructor(e,t,n){this.key=e,this.value=t,this.updated_at=(new Date).getTime(),n===Yr.USER_ATTRIBUTE_LEVEL.PORTFOLIO&&(this.level=n)}static equal(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)}}!function(e){let t;!function(e){e.PORTFOLIO="PORTFOLIO",e.PROJECT="PROJECT"}(t=e.USER_ATTRIBUTE_LEVEL||(e.USER_ATTRIBUTE_LEVEL={}))}(Yr||(Yr={}));const zr=Yr;class $r{p=null;res=null;rej=null;constructor(){try{this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}catch(e){ct.error(1,"Utils.PromiseObject","Promises not supported")}}}const Xr=e=>e===W||e===G;const Jr=e=>{let n;try{n=JSON.stringify(e)}catch(e){return!1}return new Blob([n]).size/1024>t};function Qr(e){return`Event "${e}" can't get tracked as its size is more than ${t} KB. Max permissible event size is ${t} KB.`}function Zr(){return Cn.get(Q.SUBSCRIPTION_DETAILS)?.token||null}class ei{static shouldTriggerSubscriberBilling(e){const t="MoEngage.billing.shouldTriggerSubscriberBilling";let n=[];return e.attributeNames?.length?n=e.attributeNames:e.user?.attributes?.length&&(n=e.user.attributes.map(e=>e.key)),n?.length&&ei.checkAttributeTrigger(n,e.sdkSettings)?(ct.log(1,t,"Subscriber billing is/ can be triggered by available user attributes"),!0):ei.checkPushTokenTrigger(e.pushToken)?(ct.log(1,t,"Subscriber billing is/ can be triggered by current web push subscription"),!0):!!ei.checkIdentityTrigger(e.identities||Ur.getUserIdentities(),e.sdkSettings)&&(ct.log(1,t,"Subscriber billing is/ can be triggered by available user identities"),!0)}static checkAttributeTrigger(e,t){return e.some(e=>ft(h.find(t=>t.moeName===e)?.attributeName||e,t.configs?.subscriberBasedBillingAttributes||[]))}static checkPushTokenTrigger(e){return null!==e&&!(!e&&!Zr())}static checkIdentityTrigger(e,t){if(!e)return!1;const n=t.configs?.subscriberBasedBillingAttributes||[];return Object.keys(e).some(e=>{if(n.includes(e))return!0;if(["u_em","u_mb"].includes(e))return!0;const t=h.find(t=>t.moeName===e);return!(!t||!n.includes(t.attributeName))})}}class ti{static NON_INTERACTIVE_EVENTS=[V,F,V,K];initiateSessionAndSource(e){return new Promise((t,n)=>{(()=>{this.isSessionRunning()&&this.isCurrentSourceSameAsPreviousSource()||this.startNewSession(e),t(!0)})()})}clearSessionAndSource(){Cn.remove(E)}isSessionRunning(){return this.getSessionKey()&&!this.isSessionExpired()}isSessionExpired(){const e=this.getSessionExpiryTime(),t=it.get("wasBrowserInactive");return!(!t&&null!==t)&&(this.isWindowActive()&&it.set("wasBrowserInactive",!1),(new Date).getTime()>e)}isNonEventInteractive(e){return ti.NON_INTERACTIVE_EVENTS.includes(e.name)||e.attributes.filter(e=>"moe_non_interactive"===e.key&&1===e.value).length>0}getCurrentSource(){const e=lt(window.location.href);let t="";const n={};if(!Object.keys(e).includes("utm_source"))return;t="utm_",this.geCustomIdentifiersToTrack().forEach(t=>{e[t]&&(n[t]=e[t])});const r={source_url:window.location.href};return e[t+"source"]&&(r.source=e[t+"source"]),e[t+"medium"]&&(r.medium=e[t+"medium"]),e[t+"term"]&&(r.term=e[t+"term"]),e[t+"campaign"]&&(r.campaign_name=e[t+"campaign"]),e[t+"content"]&&(r.content=e[t+"content"]),e.utm_id&&(r.campaign_id=e.utm_id),Object.keys(n).length&&(r.extra=n),r}getActiveSource(){const e=this.getSavedSource();return e||this.getCurrentSource()}isSourceOrganic(){const e=lt(window.location.href),t=Object.keys(e);let n=!1;return this.geCustomIdentifiersToTrack().forEach(t=>{e[t]&&(n=!0)}),!t.includes("utm_source")&&!t.includes("source")&&!n}setCurrentSource(e){const t=this.getSession()||{};t.currentSource=e,Cn.set(E,t)}removeCurrentSource(){const e=this.getSession();e&&(e.currentSource=void 0,Cn.set(E,e))}getSavedSource(){const e=rt(this.getSession(),y,void 0);if(e)return e}isCurrentSourceSameAsPreviousSource(){if(this.isSourceOrganic())return!0;const e={...this.getCurrentSource()};delete e.source_url;const t={...this.getSavedSource()};return delete t.source_url,Kr(e,t)}getSessionKey(){return rt(this.getSession(),_,null)}getSessionStartTime(){return rt(this.getSession(),v,null)}getSessionExpiryTime(){return rt(this.getSession(),b,null)}getSessionMaxTime(){return rt(this.getSession(),T,null)}getSession(){return Cn.get(E)}geCustomIdentifiersToTrack(){return rt(this.getSession(),S,[])||[]}generateSessionKey(){return pr()}startNewSession(e){this.removeCurrentSource();let t=this.getNumberOfSessions();const n={sessionKey:this.generateSessionKey(),sessionStartTime:(new Date).toISOString(),sessionMaxTime:e.configs.sessionInactiveDuration,customIdentifiersToTrack:e.configs.sourceExtraParams,sessionExpiryTime:(new Date).getTime()+1e3*e.configs.sessionInactiveDuration,numberOfSessions:++t};Cn.set(E,n)}extendSession(){const e=this.getSession();e&&(e.sessionExpiryTime=(new Date).getTime()+1e3*e.sessionMaxTime,Cn.set(E,e))}handleBrowserInactivity(e){"hidden"===e&&it.set("wasBrowserInactive",!0)}isWindowActive(){return!!it.get("isWindowActive")}getNumberOfSessions(){return rt(Cn.get(E),I)||0}}const ni=n(372),ri=Q.Q;class ii{static baseLogTag="QManager";static intervals={};static processing={};static clear(e){const t=ii.baseLogTag+".clear";if(!Ai())return;const n=[];for(;!mt.isEmpty(e);)switch(e){case ri.REPORT:const r=mt.dequeue(ri.REPORT);n.push(e=>{Ti.reportAdd(r).then(()=>{e()})});break;case ri.DEVICE:mt.dequeue(ri.DEVICE)&&n.push(e=>{Ti.deviceAdd().then(()=>{e()})});break;default:ct.error(1,t,"Do not know how to handle queue with name:",e)}setTimeout(()=>{ii.processing[e]=!0,ni(n,5,(t,n)=>{ii.processing[e]=!1})},0)}static startPeriodicClear(e){const t=ii.baseLogTag+".startPeriodicCleanQ";ii.clearInterval(e);const n=()=>{mt.isEmpty(e)?(ct.log(1,t,"If you see multiple event tracks with same, they were captured over multiple visits or page refreshes."),rt(ii.processing,e,!1)||ii.clearInterval(e)):(ii.clear(e),ct.log(1,t,"Starting periodic queue clear for",e))};n(),ii.intervals[e]=setInterval(n,6e3)}static clearInterval(e){null!=ii.intervals[e]&&(clearInterval(ii.intervals[e]),ii.intervals[e]=null)}}function si(e){const t=e?new Date(e):new Date;return`${t.getDate()}:${t.getMonth()+1}:${t.getFullYear()}:${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`}class ai{static baseLogTag="ReportAddViewEvent";EVENT_ACTION;EVENT_ATTRS;EVENT_L_TIME;EVENT_G_TIME;EVENT_ATTRS_CUST;N_I_E;IS_PORTFOLIO;constructor(e){this.EVENT_ACTION=e.event.name,this.EVENT_ATTRS=e.event.attributes&&oi(e.event.attributes),this.EVENT_G_TIME=(new Date).getTime().toString(),this.EVENT_L_TIME=si(e.event.timestamp),this.EVENT_ATTRS_CUST=e.postData.c,this.N_I_E=e.postData.nie,e.isPortfolioAttribute&&(this.IS_PORTFOLIO=e.isPortfolioAttribute)}}const oi=e=>{const t={};return e.forEach(e=>{t[e.key]=e.value}),t};class ci{static windowClosed=!1;static visibilityChange(){"hidden"===document.visibilityState&&(ci.windowClosed||pi.reactToTriggerEvents())}static removeEventListeners(){document.removeEventListener("visibilitychange",ci.visibilityChange,!1)}static addListeners(){document.addEventListener("visibilitychange",ci.visibilityChange,!1)}}const li=ci;class ui{static ready;static offlineDataStore;static async initialize(){if(null==ui.ready){ui.offlineDataStore=pt().createInstance({driver:[pt().INDEXEDDB],name:Cr,storeName:xr.OFFLINE_DATA.NAME});const e=pt().createInstance({driver:[pt().INDEXEDDB],name:Cr,storeName:"moe_data"}),t=pt().createInstance({driver:[pt().INDEXEDDB],name:Cr,storeName:"moe_backup"}),n=[ui.offlineDataStore.ready(),e.ready(),t.ready()];ui.ready=Promise.all(n)}return await ui.ready}}class di{static batchRemoteLogsApiRetries=1;static getRemoteLogsBatchRequestOptions(e){return new Promise(t=>{Ti.collectGetParams().then(n=>{const r={query_params:{...n,unique_id:n.unique_id,os:"web"===n.os?"Web":"mWeb"},logs:[...e]};t(r)})})}static sendBatchOfLogs(e){const t=Ti.baseLogTag+".sendBatchOfLogs";return new Promise((n,r)=>{di.getRemoteLogsBatchRequestOptions(e).then(r=>{const s=qr(),a=s.baseDomainName+i+r.query_params.os.toLowerCase()+"/"+s.appId;ut.post(a,{postData:r}).then(()=>{ct.log(1,t,"[sendBatchOfLogs] batch payload: "+JSON.stringify(e)),ct.log(1,t,"Batch Remote Logs sent to MoEngage successfully"),di.batchRemoteLogsApiRetries=1,n(!0)}).catch(n=>{ct.log(1,t,"Batch Remote Logs API failed",n),this.handleRemoteLogsFailure(e)})})})}static handleRemoteLogsFailure(e){const t=Ti.baseLogTag+".handleRemoteLogsFailure";ct.log(1,t,"Retry Batch Logs Failed API",di.batchRemoteLogsApiRetries),di.batchRemoteLogsApiRetries<3&&setTimeout(()=>{di.batchRemoteLogsApiRetries++,di.sendBatchOfLogs(e)},3e3*di.batchRemoteLogsApiRetries)}static sendBeacon(e){di.getRemoteLogsBatchRequestOptions(e).then(e=>{const t=qr(),n=t.baseDomainName+i+e.query_params.os.toLowerCase()+"/"+t.appId+"?"+(new Date).getTime();ct.log(1,"RemoteLogsApi.sendBeacon","[sendBeacon] Remote Logs batch payload: "+JSON.stringify(e)),navigator.sendBeacon(n,JSON.stringify(e))})}}class gi{static baseLogTag="BatchManager";static reports=[];static remoteLogs=[];static periodicSyncInterval;static lastbatchCreatedAt=null;static lastRemoteLogsbatchCreatedAt=null;static updateEventStore(){if(Wr()!==L.TV){pt().createInstance({driver:[pt().INDEXEDDB,pt().WEBSQL,pt().LOCALSTORAGE],name:kr,storeName:Pr}).setItem(Pr,gi.reports)}}static spliceReports(e=gi.reports.length){const t=gi.reports.splice(0,e);return gi.updateEventStore(),t}static spliceRemoteLogs(e=gi.remoteLogs.length){return gi.remoteLogs.splice(0,e)}static suspendBatching(){const e=gi.baseLogTag+".suspendBatching";this.spliceReports(),this.spliceRemoteLogs(),gi.periodicSyncInterval&&gi.clearInterval(),li.removeEventListeners(),ct.log(2,e,"Batching has stopped.")}static shouldCreateNewBatch(){return!gi.lastbatchCreatedAt||(new Date).getTime()-gi.lastbatchCreatedAt>=Dr.TIME_BETWEEN_BATCHES}static shouldCreateNewBatchForRemoteLogs(){return!gi.lastRemoteLogsbatchCreatedAt||(new Date).getTime()-gi.lastRemoteLogsbatchCreatedAt>=Dr.TIME_BETWEEN_BATCHES}static reactToTriggerEvents(){const e=gi.baseLogTag+".reactToTriggerEvents";gi.reports.length>0?(ct.log(1,e,`Trigger Events: Created Batch of ${gi.reports.length} reports`,si()),gi.createBatch()):ct.log(2,e,`${si()}: No report's to sync for this event.`),gi.remoteLogs.length>0?(ct.log(1,e,`Trigger Events: Created Batch of remote logs ${gi.remoteLogs.length} reports`,si()),gi.createRemoteLogsBatch()):ct.log(2,e,`${si()}: No logs's to sync for remote logs.`)}static periodicSync(e){const t=gi.baseLogTag+".periodicSync";gi.reports.length>0&&gi.shouldCreateNewBatch()?(ct.log(1,t,`Periodic sync: Created Batch of ${gi.reports.length} reports`,si()),gi.createBatch()):ct.log(2,t,`${si()}: No report's to sync at this interval. The next sync will attempt in ${e} seconds`),gi.remoteLogs.length>0&&gi.shouldCreateNewBatchForRemoteLogs()?(ct.log(1,t,`Periodic sync: Created Batch of remote logs ${gi.reports.length} reports`,si()),gi.createRemoteLogsBatch()):ct.log(2,t,`${si()}: No report's to sync at this interval for remote logs. The next sync will attempt in ${e} seconds`)}static clearInterval(){clearInterval(gi.periodicSyncInterval),gi.lastbatchCreatedAt=null}static init(e){Gr.getInstance().then(async t=>{(gi.isOfflineBatchingSupported(t,e)||e.configs.remoteLogTracking)&&(await ui.initialize(),gi.periodicSyncInterval&&gi.clearInterval(),gi.periodicSyncInterval=window.setInterval(gi.periodicSync.bind(this,e.configs.periodicFlushTime),1e3*e.configs.periodicFlushTime),li.addListeners())})}static sendBatch(e){const t=gi.baseLogTag+".sendBatch";return new Promise(n=>{try{Ti.sendBatchOfReports(e).then(()=>{gi.lastbatchCreatedAt=(new Date).getTime(),n(!0)})}catch(e){ct.error(1,t,"Error in sending batch",e),n(!1)}})}static sendRemoteLogs(e){const t=gi.baseLogTag+".sendRemoteLogs";return new Promise(n=>{try{di.sendBatchOfLogs(e).then(()=>{gi.lastRemoteLogsbatchCreatedAt=(new Date).getTime(),n(!0)})}catch(e){ct.error(1,t,"Error in sending batch of remote logs",e),n(!1)}})}static createBatch(e){if(gi.reports.length>0){const t=gi.spliceReports(e);gi.sendBatch(t)}}static createRemoteLogsBatch(e){if(gi.remoteLogs.length>0){const t=gi.spliceRemoteLogs(e);gi.sendRemoteLogs(t)}}static addReport(e,t){const n=gi.baseLogTag+".addReport",r=new ai(e);return Jr(r)?(ct.error(1,n,Qr(r.EVENT_ACTION)),!1):(gi.reports.push(r),Jr(gi.reports)?(gi.reports.pop(),ct.log(1,n,`Created Batch of ${gi.reports.length} reports as payload size would have breached after adding new event to this batch: "${r.EVENT_ACTION}"`,si()),gi.createBatch(),gi.reports.push(r),gi.updateEventStore()):(gi.updateEventStore(),gi.reports.length===t&&(ct.log(1,n,`Created Batch of ${t} reports`,si()),gi.createBatch(t))),!0)}static sendBeacon(){const e=gi.baseLogTag+".sendBeacon";gi.reports.length>0&&(ct.log(1,e,`Window Unload: Created batch of ${gi.reports.length} reports`,si()),Ti.sendBeacon(gi.spliceReports())),gi.remoteLogs.length>0&&(ct.log(1,e,`Window Unload: Created Remote Logs batch of ${gi.remoteLogs.length} reports`,si()),di.sendBeacon(gi.spliceRemoteLogs()),gi.lastRemoteLogsbatchCreatedAt=(new Date).getTime())}static async flushReports(e=!1){const t=gi.baseLogTag+".flushReports";try{e&&li.removeEventListeners(),gi.reports.length>0&&(ct.log(1,t,`Flushed ${gi.reports.length} reports`,si()),await gi.sendBatch(gi.spliceReports())),gi.remoteLogs.length>0&&(ct.log(1,t,`Flushed ${gi.remoteLogs.length} remote logs`,si()),await gi.sendRemoteLogs(gi.spliceRemoteLogs()))}catch(e){ct.error(1,t,"Error in flushing reports",e)}}static isOfflineBatchingSupported(e,t){return t||(t=Cn.get(Q.WEB_SETTINGS)),gi.isBatchingSupported(t,e)}static addRemoteLogs(e,t=15){const n=gi.baseLogTag+".addRemoteLogs";gi.remoteLogs.push(e),gi.remoteLogs.length===t&&(ct.log(1,n,`Created Batch of ${t} reports`,si()),gi.createRemoteLogsBatch(t))}static isBatchingSupported(e,t){try{const n=Wr();return!(!e?.configs.isBatchingEnabled||("web"!==n||t.name!==Gr.BROWSER_NAMES.CHROME&&t.name!==Gr.BROWSER_NAMES.EDGE&&t.name!==Gr.BROWSER_NAMES.OPERA)&&("mobile"!==n||Gr.isIOS()||t.name!==Gr.BROWSER_NAMES.CHROME&&t.name!==Gr.BROWSER_NAMES.OPERA)||!navigator.sendBeacon)}catch(e){ct.error(1,"BatchManager.isBatchingSupported",e)}}}const pi=gi;class hi{static baseLogTag="ReportPostData";e;a;c;h;identifiers;meta;url;nie;constructor(){const e=hi.baseLogTag+".constructor";let t=yi.getSync().getAttribute("id");t=t?t.toString():void 0;const n=window.analytics;let r,i;if(n){i=n._VERSIONS;try{r=n.user().anonymousId()}catch(t){ct.error(1,e,"Error getting anonymous id from segment api",t)}}this.c=void 0,this.h="";const s=Ur.getIdentityMap();(t||r||s?.userIdentities)&&(this.identifiers={moe_user_id:t,segment_id:r,user_identities:s?.userIdentities||void 0,previous_identities:s?.previousIdentities||void 0}),this.meta={bid:pr(),segmentSdkData:n?i:void 0}}}class fi{static baseLogTag="ReportClass";status;type;getParams;postData;event;isPortfolioAttribute;constructor(e,t,n,r=zr.USER_ATTRIBUTE_LEVEL.PROJECT){fi.baseLogTag;this.type=e,this.getParams=t,this.event=n,this.isPortfolioAttribute=r===zr.USER_ATTRIBUTE_LEVEL.PORTFOLIO,this.postData=new hi;const i={},s={};for(const e of n.attributes)if(e&&null!=e.key&&(this.status=fi.STATUS.VALID,null!=e.value))if("function"==typeof e.value.getMonth){const t={};t[e.key]=Math.round(e.value.getTime()-6e4*e.value.getTimezoneOffset()),null==s.timestamp&&(s.timestamp=[]),s.timestamp.push(t)}else i[e.key]=e.value;var a;this.postData.e=n.name,this.postData.a=i,this.postData.c=(a=s,0===Object.keys(a).length&&a.constructor===Object?void 0:s),window&&window.location&&null!=window.location.href&&(this.postData.url=window.location.href)}}!function(e){let t,n;!function(e){e[e.INVALID=0]="INVALID",e[e.VALID=1]="VALID"}(t=e.STATUS||(e.STATUS={})),function(e){e[e.USER_ATTRIBUTE=0]="USER_ATTRIBUTE",e[e.EVENT=1]="EVENT"}(n=e.REPORT_ADD_TYPE||(e.REPORT_ADD_TYPE={}))}(fi||(fi={}));const mi=fi;class Ei{name;attributes;timestamp;constructor(e,t,n=!0){this.name=e,this.attributes=t,this.timestamp=(new Date).getTime(),n&&this.attributes.push(new zr(H,location.href))}static createUserAttributeEvent(e){return new Promise((t,n)=>{const r=[],i=e.key;switch(e.key){case"id":e.key=s;break;case"email":e.key=a;break;case"name":e.key=o;break;case"first_name":e.key=c;break;case"last_name":e.key=l;break;case"mobile":e.key=u;break;case"gender":e.key=d;break;case"birthday":e.key=g}r.push(e),e.key!==i&&ct.log(2,"Event.createUserAttributeEvent","Key changed to MoE reserved keyname: ",e.key),t(new Ei(B,r,!1))})}static createEvent(e,t,n){return new Promise((r,i)=>{yi.get().then(async i=>{try{const s=new zr(q,!!i.getAttribute("id")),a=new ti,o=new zr(Y,a.getNumberOfSessions()<=wr);t.push(s,o),r(new Ei(e,t,n))}catch(e){ct.error(1,"Event.createEvent","Error occurred in create events ",e)}})})}}class _i{static history=[];static listeners=[];static addEvent(e){_i.history.push(e),_i.listeners.forEach(t=>{t(e)})}static getHistory(){return _i.history}static addEventListener(e){_i.listeners.push(e)}static clear(){_i.history=[]}static clearAll(){_i.history=[],_i.listeners=[]}}class vi{static track(e,t,n){const r="MoEngage.event.trackEvent";return new Promise(async(i,s)=>{if(!Ai())return ct.warn(2,r,`Not tracking the event "${e}" as Web SDK has been disabled.`),void i(!1);let a;n=!!n;try{a=await Hr()}catch(n){return ct.warn(1,r,"SDK not yet initialized. Caching event and will track when SDK is initialized.",n),window.moengage_q?.push({f:"track_event",a:[e,t]}),void i(!1)}if("string"==typeof e&&e)if(a.configs.blacklistedEvents&&a.configs.blacklistedEvents.includes(e))ct.error(1,r,`This event "${e}" is blacklisted. Please contact Moengage team to whitelist it.`),i({error:5001,message:`Event "${e}" is blacklisted.`});else if(!Ir.includes(e)||a.configs.whitelistedEvents&&a.configs.whitelistedEvents.includes(e))try{const s=[];if(null==t||null!==t&&t===Object(t)&&"[object Object]"===Object.prototype.toString.call(t)){null==t&&(t={});for(const e in t)t.hasOwnProperty(e)&&s.push(new zr(e,t[e]));const r=new ti;await r.initiateSessionAndSource(a);const o=await Ei.createEvent(e,s);_i.addEvent(o),a?.configs.isWebPersonalizationModuleEnabled&&window.MoeWebP?.handleInSessionEvent(o),Ti.collectGetParams().then(t=>{Xr(e)&&delete t.push_id;const s=new mi(mi.REPORT_ADD_TYPE.EVENT,t,o),a={session_id:r.getSessionKey(),start_time:r.getSessionStartTime(),background_initiated:0},c=[],l=r.getActiveSource();l&&(r.setCurrentSource(l),c.push(l)),s.postData.meta.session=a,c.length&&(s.postData.meta.source=c),r.isNonEventInteractive(o)&&(s.postData.nie=1),Ti.reportAdd(s,n).then(()=>{r.isNonEventInteractive(o)||r.extendSession(),i(!0)})})}else ct.error(1,r,`Event attributes were not passed a key-value pair object for event: ${e}`),i({error:5002,message:"Event value needs to be a key-value pair object"})}catch(e){ct.error(1,r,"Error occurred in tracking events ",e)}else ct.log(2,r,`This event "${e}" has not been whitelisted. Please contact Moengage team to whitelist it.`),i({error:5001,message:`Event "${e}" is not whitelisted.`});else ct.error(1,r,"Event name not a string or null or empty string:",e),i({error:5001,message:"Event name can not be null"})})}}var bi;!function(e){e.PROMPT="prompt",e.GRANTED="granted",e.DENIED="denied",e.DISMISSED="dismissed"}(bi||(bi={}));class Ti{static baseLogTag="MoeApi";static onDeviceAdd=new $r;static webSdkApiRetries=1;static offlineEvents=[];static addReportApiRetries=1;static isExecutingDeviceAdd=!1;static deviceAdd(t=!0){const n=Ti.baseLogTag+".deviceAdd";return Ti.isExecutingDeviceAdd?(ct.warn(2,n,"Device add is already in progress. Skipping this call."),Promise.resolve(!1)):(Ti.isExecutingDeviceAdd=!0,new Promise(async(n,r)=>{if(!Ai())return void n(!1);const i=Et.get();return Ti.collectGetParams(e.DEVICE_ADD).then(s=>{const a={queryParams:s={...s,url:window.location.href}};ut.post(i.baseDomainName+e.DEVICE_ADD,a).then(()=>{t?yi.get().then(e=>{e.deviceAdded=!0,e.save().then(()=>{ii.startPeriodicClear(Q.Q.REPORT),Ti.onDeviceAdd.res()})}).then(()=>{this.trackDeviceAttributes(),Ti.isExecutingDeviceAdd=!1,n(!0)}):(Ti.isExecutingDeviceAdd=!1,n(!0))}).catch(e=>{mt.enqueue(Q.Q.DEVICE,!0),Ti.isExecutingDeviceAdd=!1,r(!1)})})}))}static trackDeviceAttributes(){const e=Ti.baseLogTag+".trackDeviceAttributes";return new Promise(async(t,n)=>{try{let t=Wr().toUpperCase();t="WEB"===t?"DESKTOP":t,vi.track(j,{deviceType:t});let n=!1;Gr.getInstance().then(t=>{Hr().then(async r=>{if(function(e,t){return!Et.get().disableWebPush&&e.isWebPushEnabled&&de.includes(t.name)&&navigator.serviceWorker&&"PushManager"in window&&"Notification"in window}(r,t)){let t=Zr();if(!t)try{const e=st()||{};let n="";"function"==typeof e.getPermissionState&&(n=await e.getPermissionState()),n===bi.GRANTED&&(t=!0)}catch(t){ct.error(2,e,"Failed to get push notification permission state.",t)}n=t}}).then(()=>{vi.track(j,{[f]:!!n,source:"deviceAdd"}),Cn.set(Q.OPTED_STATUS_TRACK_TIME,Date.now())})})}catch(t){ct.error(2,e,"Failed to track device attributes.",t)}t(null)})}static reportAdd(e,t){const n=Ti.baseLogTag+".reportAdd";return new Promise((r,i)=>{t=!!t,Hr().then(s=>{yi.get().then(a=>{const o=it.get(re)&&s?.configs?.landingPageTracking;try{if(o&&!ei.shouldTriggerSubscriberBilling({user:a,sdkSettings:s,attributeNames:[e.event.attributes[0].key]}))return ct.log(2,n,"Landing page tracking enabled (both flag and config), processing report immediately:",e.event.name),mt.isEmpty(Q.Q.REPORT)||(ct.log(2,n,"Flushing queued reports as landing page tracking is enabled"),ii.clear(Q.Q.REPORT)),Ti.executeReportAdd(e,t,r,i)}catch(e){ct.error(2,n,"Error checking push subscription attribute acceptance for landing page tracking:",e)}return s.isPushSubBilling?Ti.handleReportPushSubBilling(e,t,s,a,r,i):Ti.executeReportAdd(e,t,r,i)}).catch(s=>(ct.error(1,n,"Error getting user data for push subscriber billing:",s),Ti.executeReportAdd(e,t,r,i)))}).catch(e=>{ct.error(1,n,"Error in getting Web SDK Settings. This might indicate that the App is blocked."),i(!1)})})}static executeReportAdd(e,t,n,r){Ti.reportAddInternal(e,t).then(()=>{this.sendBroadcast(e),n(!0)}).catch(()=>{r(!1)})}static handleReportPushSubBilling(e,t,n,r,i,s){const a=Ti.baseLogTag+".handleReportPushSubBilling";r.deviceAdded?Ti.executeReportAdd(e,t,i,s):(ct.log(2,a,"Device not added yet, queuing report:",e.event.name),Ti.queueReportForDeviceAdd(e,n,r),i(!0))}static queueReportForDeviceAdd(e,t,n){const r=Ti.baseLogTag+".queueReportForDeviceAdd";mt.enqueue(Q.Q.REPORT,e),ct.log(2,r,"Report added to queue as device not added yet:",e.event.name),e.type===mi.REPORT_ADD_TYPE.USER_ATTRIBUTE&&Ti.handleUserAttributeForPushSubBilling(e,t,n)}static handleUserAttributeForPushSubBilling(e,t,n){const r=Ti.baseLogTag+".handleUserAttributeForPushSubBilling";e.event.attributes&&0!==e.event.attributes.length&&(ei.shouldTriggerSubscriberBilling({user:n,sdkSettings:t,attributeNames:[e.event.attributes[0].key]})?(ct.log(2,r,"Attribute accepted for push sub billing."),Ti.deviceAdd()):ct.log(2,r,"Attribute NOT accepted for push sub billing."))}static sendBroadcast(e){Ar.NAMES.includes(e.event.name)&&Ni.broadcastToWindow({topic:Ar.TOPIC,name:e.event.name,data:e.event.attributes})}static getSegmentId(){const e=window.analytics;if(e&&e.user)return e.user().anonymousId()}static getBatchRequestOptions(e){return new Promise(t=>{Ti.collectGetParams(Or.REPORT_ADD).then(async n=>{const r=Ti.getSegmentId()||"",i=yi.getSync(),s=Et.get(),a=new ti,o={session_id:a.getSessionKey(),start_time:a.getSessionStartTime(),background_initiated:0},c=[],l=a.getActiveSource();l&&(a.setCurrentSource(l),c.push(l));const{userIdentities:u,previousIdentities:d}=await Ur.getIdentifiersFromIdentities(),g={user_identities:u||void 0,previous_identities:d||void 0},p=await this.getParamsFromCookie();let h=null;const f={...n};null!==p&&"object"==typeof p&&(h=p.moe_user_id,null!==p.push_id&&(f.push_id=p.push_id),null!==p.unique_id&&(f.unique_id=p.unique_id));const m={query_params:f,identifiers:{moe_user_id:null!==h?h:i.getAttribute("id")||u?.uid||void 0,segment_id:r||void 0,...g,moe_aid:Ii()},meta:{bid:pr(),request_time:(new Date).toISOString(),session:o,source:c.length?c:void 0,initiator:s?.proxyDomains?.api?.length?"proxy_server":void 0},viewsCount:e.length,viewsInfo:[...e]};t(m)})})}static getParamsFromCookie(){const e=`${this.baseLogTag}.getMoeUserIdFromCookies`,t={moe_user_id:null,unique_id:null,push_id:null};return new Promise(n=>{Hr().then(e=>{if(e?.isDomainLevelStorage){const e=kn.get(Q.USER_DATA),n=kn.get(Q.SUBSCRIPTION_DETAILS)?.token;e&&(e.attributes?.length&&e.attributes.find(e=>e.key===s)?t.moe_user_id=e.attributes.find(e=>e.key===s).value:t.moe_user_id=void 0,e.deviceUuid?.length&&(t.unique_id=e.deviceUuid)),n?.length&&wi(n)?t.push_id=n:t.push_id=void 0}n(t)}).catch(r=>{ct.error(2,e,"Error occurred while trying to fetch SDK Settings: ",r),n(t)})})}static async addReportsToOfflineDB(e,t){const n=Ti.baseLogTag+".addReportsToOfflineDB",r=await Ti.getBatchRequestOptions([]);await ui.offlineDataStore.setItem(t||`report_add_${(new Date).getTime()}`,e),await ui.offlineDataStore.setItem("requestMetaData",r),await ui.offlineDataStore.setItem(t||`batch_${(new Date).getTime()}`,{...r,viewsCount:e.length,viewsInfo:e}),navigator.serviceWorker&&navigator.serviceWorker.ready.then(e=>{e.sync?e.sync.register(Mr).then(()=>{ct.log(2,n,"offline sync event registered")}).catch(e=>{ct.error(1,n,"Service worker sync error",e)}):ct.log(2,n,"Service worker sync unavailable")})}static sendReportBeacon(e,t,n){const r=Ti.baseLogTag+".sendReportBeacon";try{if(!e&&navigator.sendBeacon&&navigator.sendBeacon(t,new Blob([JSON.stringify(n)],{type:"text/plain;charset=UTF-8"})))return!0}catch(e){ct.error(2,r,"Failed to send Report call with Beacon:",e)}return!1}static sendBatchOfReports(e){const t=Ti.baseLogTag+".sendBatchOfReports";return new Promise((n,r)=>{Ti.getBatchRequestOptions(e).then(i=>{const s=Et.get(),a=s.baseDomainName+Or.REPORT_ADD+s.appId;Hr().then(r=>window.navigator.onLine?Ti.sendReportBeacon(r.configs.isBeaconDisabled,a,i)?(ct.log(1,t,"[sendBatchOfReports] batch payload: "+JSON.stringify(e)),ct.log(1,t,"Batch sent to MoEngage successfully through beacon"),void n(!0)):void ut.post(a,{postData:i}).then(()=>{ct.log(1,t,"[sendBatchOfReports] batch payload: "+JSON.stringify(e)),ct.log(1,t,"Batch sent to MoEngage successfully"),n(!0)}).catch(i=>{ct.error(1,t,"Batch Report add API failed",i),n(this.sendToOfflineTracking(e,i,r))}):this.sendToOfflineTracking(e,Lr,r)).catch(e=>{e!==Lr&&ct.error(1,t,"Error in getting Web SDK Settings. This might indicate that the App is blocked."),r(e)})})})}static sendToOfflineTracking(e,t,n){const r=Ti.baseLogTag+".sendToOfflineTracking";return new Promise((i,s)=>{if(!Ai())return ct.warn(2,r,"Not adding report(s) to offline db as SDK has been disabled."),void s(t);Gr.getInstance().then(a=>{pi.isOfflineBatchingSupported(a,n)?(ct.error(1,r,"Add Report API failed, adding reports to offline db. ",t),Ti.addReportsToOfflineDB(e).then(()=>{ct.log(2,r,"Network offline: Batch added to offline db")}),i(!0)):(ct.warn(1,r,"Report not added to offline db. Offline tracking is supported only if batching is enabled. It is supported only on Chrome, Edge and Opera browsers on desktop web and Chrome and Opera browsers on Android web."),s(t))}).catch(()=>{s(t)})})}static checkAndTrackUniversalLink(){const e=Ti.baseLogTag+".trackUniversalLink",t=lt(window.location.href)[Rr];if(t){if(ct.log(2,e,"Universal link found: ",t),!Ai())return void ct.warn(2,e,"Not tracking universal link as Web SDK has been disabled.");yi.get().then(async e=>{Gr.getInstance().then(n=>{const r=Et.get(),i={meta_data:{app_id:r.appId,request_id:pr(),project_code:r.projectId||void 0,sdk_ver:"2.64.00",app_ver:"1.0",os:n.os,unique_id:e.deviceUuid,device_unique_id:this.getDeviceUniqueId(),url:window.location.href},tracking_data:{timestamp:(new Date).getTime(),moeq:t}};navigator.sendBeacon(r.baseDomainName+Nr.TRACK,JSON.stringify(i))})})}}static reportAddInternal(t,n){const r=Ti.baseLogTag+".reportAddInternal";return new Promise((i,s)=>{Hr().then(s=>{Gr.getInstance().then(a=>{if(n){const n=Ti.getUpdatedPushDetails();for(const e in n)!n.hasOwnProperty(e)||Xr(t.event.name)&&"push_id"===e||(t.getParams[e]=n[e]);const r=Vr(),o={queryParams:{...t.getParams,...r}};if(t.postData.nie){const e=Object.assign({},t);delete e.postData.meta.source,delete e.postData.meta.session,o.postData=e.postData}else o.postData=t.postData;let c=Et.get().baseDomainName;c+=e.DEVICE_ADD,ut.post(c,o).then(()=>{let e=Wr().toUpperCase();e="WEB"===e?"DESKTOP":e,vi.track(j,{deviceType:e}),i(Ti.handleReportAddSuccess(t))}).catch(e=>{pi.isBatchingSupported(s,a)?mt.enqueue(Q.Q.DEVICE,t):Ti.handleReportAddFailure(t,e)})}else if(pi.isBatchingSupported(s,a))pi.addReport(t,s.configs.eventBatchCount)&&(ct.log(1,r,"Event batched successfully:",t.event),this.addEventsToIDB(t.event)),i(!0);else{const e=new ai(t);Jr(e)?(ct.error(1,r,Qr(e.EVENT_ACTION)),i(!1)):Ti.sendBatchOfReports([e]).then(()=>{i(Ti.handleReportAddSuccess(t))}).catch(e=>{Ti.handleReportAddFailure(t,e)})}})}).catch(e=>{ct.error(1,r,"Error in getting Web SDK Settings. This might indicate that the App is blocked."),s(!1)})})}static handleReportAddSuccess(e){const t=Ti.baseLogTag+".handleReportAddSuccess";return e.type===mi.REPORT_ADD_TYPE.EVENT?(ct.log(1,t,"Event tracked successfully:",e.event),this.addEventsToIDB(e.event)):e.type===mi.REPORT_ADD_TYPE.USER_ATTRIBUTE&&ct.log(1,t,"User attribute added successfully:",e.event.attributes),Ti.addReportApiRetries=1,!0}static handleReportAddFailure(e,t){const n=Ti.baseLogTag+".handleReportAddFailure";ct.error(1,n,"Add Report API failed",t),e.type===mi.REPORT_ADD_TYPE.EVENT?ct.log(1,n,"Queueing unsuccessful event tracking:",e.event):e.type===mi.REPORT_ADD_TYPE.USER_ATTRIBUTE&&ct.log(1,n,"Queueing unsuccessful user attribute add:",e.event.attributes),Ti.addReportApiRetries<3&&setTimeout(()=>{Ti.addReportApiRetries++,mt.enqueue(Q.Q.REPORT,e),ii.startPeriodicClear(Q.Q.REPORT)},3e3*Ti.addReportApiRetries)}static checkIfTokenValid(t){const n=Et.get().baseDomainName+e.DEVICE_TOKEN_CHECK,r=Et.get();return new Promise(e=>{t?yi.get().then(i=>{const s={queryParams:{app_id:r.appId,unique_id:i.deviceUuid,push_id:t}};ut.post(n,s).then(t=>{200===t.status?e(!0):e(!1)}).catch(t=>{e(!1)})}):e(!1)})}static collectGetParams(t){return new Promise((n,r)=>{yi.get().then(async r=>{let i=Et.get();null!=i&&null!=i.appId||(i=new Et(Cn.get(Q.INIT_DATA)));const s=await Hr(),a=new Date,o=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds());Gr.getInstance().then(a=>{const c=this.getDeviceUniqueId(),l=Vr(t,[e.REPORT_ADD,e.DEVICE_ADD,Or.REPORT_ADD]),u={os:a.os,os_platform:a.osPlatform,is_incognito:a.isIncognito,app_id:i.appId,os_ver:a.name,sdk_ver:"2.64.00",model:a.name,app_ver:"1.0",device_ts:Number(o),device_tz_offset:(-6e4*(new Date).getTimezoneOffset()).toString(),unique_id:r.deviceUuid,device_tz:(new Date).getTimezoneOffset().toString(),device_unique_id:c,...l};i.projectId&&(u.project_code=i.projectId);const d=r.getAttribute("cart_token");(function(){const e=Et.get()?.swPath;return!(!e||!e.includes("tools/moengage"))})()&&d&&s?.configs.isMultiIdEnabled&&t!==e.DEVICE_ADD&&(u.cart_token=d);const g=Zr();wi(g)&&(u.push_id=g),a.isWebPushCompatible()&&(!function(e,t){return t.isChrome()||t.isOpera()||t.isEdge()||t.isSafari()?"vapid"===e?.chrome?.subscriptionMode&&!!e?.chrome?.vapidPublicKey||!1:t.isFirefox()&&"vapid"===e?.firefox?.subscriptionMode&&!!e?.firefox?.vapidPublicKey||!1}(s.webPushPlatformData,a)?u.subscription_type="normal":(u.subscription_type="vapid",u.vapid_public=function(e,t){return t.isChrome()||t.isOpera()||t.isEdge()||t.isSafari()?e?.chrome?.vapidPublicKey||"":t.isFirefox()&&e?.firefox?.vapidPublicKey||""}(s.webPushPlatformData,a))),null!=i.environment&&(u.environment=i.environment);const p=Cn.get(Q.SUBSCRIPTION_DETAILS);if(null!=p&&null!=p.keys){for(const e in p.keys)u["keys_"+e]=encodeURI(p.keys[e]);null!=p.endpoint&&(u.endpoint=encodeURI(p.endpoint)),u.expirationTime=p.expirationTime}n(u)})})})}static getDeviceUniqueId(){return Cn.get(Q.DEVICE_DATA)?.deviceUniqueId||void 0}static getUpdatedPushDetails(){const e={},t=Cn.get(Q.SUBSCRIPTION_DETAILS);if(null!=t){const n=t.token;if(null!=n&&"NA"!==n&&""!==n&&"null"!==n&&(e.push_id=n),t.keys){for(const n in t.keys)e["keys_"+n]=encodeURI(t.keys[n]);null!=t.endpoint&&(e.endpoint=encodeURI(t.endpoint)),e.expirationTime=t.expirationTime}}return e}static sendBeacon(e){if(!window.navigator.onLine)return this.sendToOfflineTracking(e,Lr);Ti.getBatchRequestOptions(e).then(e=>{const t=Et.get(),n=t.baseDomainName+Or.REPORT_ADD+t.appId+"?"+(new Date).getTime();ct.log(1,"MoeApi.sendBeacon","[sendBeacon] batch payload: "+JSON.stringify(e)),navigator.sendBeacon(n,JSON.stringify(e))})}static addEventsToIDB(e){if(Wr()!==L.TV){const t=pt().createInstance({driver:[pt().INDEXEDDB,pt().WEBSQL,pt().LOCALSTORAGE],name:ae,storeName:oe});t?.setItem(e.name,e)}}}let Si=null;class yi{static baseLogTag="UserModel";static isResolved=!1;attributes=[];deviceUuid;deviceAdded;static instance=null;subscribedToOldSdk=!1;constructor(e){null==e?(this.deviceUuid=pr(),this.attributes=[],this.deviceAdded=!1):(this.deviceUuid=rt(e,"deviceUuid",pr()),this.attributes=rt(e,"attributes",[]),this.deviceAdded=rt(e,"deviceAdded",!1))}addAttribute(e){const t=yi.baseLogTag+".addAttribute";return new Promise(async n=>{let r=!0;e.key=yi.getMorphedKey(e.key);let i=-1;for(let t=this.attributes.length-1;t>=0;t--)e.key===this.attributes[t].key&&e.level===this.attributes[t].level&&(i=t);i>=0?(Kr(this.attributes[i].value,e.value)&&(ct.log(2,t,"Duplicate attribute found: ",e),r=await this.isAttibuteTrackingRequired(this.attributes[i].updated_at,this.attributes[i].level)),r&&(this.attributes[i].value=e.value,this.attributes[i].updated_at=(new Date).getTime())):(ct.log(2,t,"Adding attribute:",e),this.attributes.push(e)),this.save().then(()=>{n(r)})})}async isAttibuteTrackingRequired(e,t=zr.USER_ATTRIBUTE_LEVEL.PROJECT){const n=await Hr();return t===zr.USER_ATTRIBUTE_LEVEL.PORTFOLIO&&null!==n.configs.portfolioUserAttributeCacheTime?Oi(e)>n.configs.portfolioUserAttributeCacheTime:null===n.configs.userAttributeCacheTime||Oi(e)>n.configs.userAttributeCacheTime}static getLocalUser(){const e=yi.baseLogTag+".getLocalUser";return new Promise(t=>{if(Cn.get(Q.USER_DATA)){ct.log(2,e,"Found user in localstorage");const n=Cn.get(Q.USER_DATA);t(new yi(n))}else t(null)})}static getCookieUser(){return new Promise(e=>{const t=yi.baseLogTag+".getLocalUser";if(kn.get(Q.USER_DATA)){ct.log(2,t,"Found user in cookie");const n=kn.get(Q.USER_DATA);e(new yi(n))}else e(null)})}static getMigrationUser(){const e=yi.baseLogTag+".getLocalUser";return new Promise(t=>{const n=localStorage.getItem(Q.OLD_SDK.USER_DATA);if(n)try{const e=JSON.parse(n);if(e.is_new_sdk_migrated)t(null);else{const n=new yi({deviceAdded:rt(e,"device_add",!1),deviceUuid:rt(e,"uuid",pr())}),r=rt(e,"user_attrs",{});for(const e in r)r.hasOwnProperty(e)&&n.attributes.push(new zr(e,r[e]));const i=localStorage.getItem(Q.OLD_SDK.PUSH_TOKEN);null!=i&&"NA"!==i&&"null"!==i&&(n.subscribedToOldSdk=!0),t(n)}}catch(n){ct.error(1,e,"Error getting the migration user. Resolving as a new user."),ct.error(1,e,n),t(null)}else t(null)})}static getSync(){return yi.instance}static get(){const e=yi.baseLogTag+".get";return null!=Si||(Si=new Promise((t,n)=>{Gr.getInstance().then(e=>Hr()).then(t=>{const n=yi.getLocalUser(),r=t.isDomainLevelStorage?yi.getCookieUser():"resolved",i=yi.getMigrationUser();return Promise.all([n,r,i]).then(n=>{const r=n[0],i=n[1],s=n[2];return s?s.save().then(n=>{const r=localStorage.getItem(Q.OLD_SDK.USER_DATA);if(r)try{const e=JSON.parse(r);e.is_new_sdk_migrated=!0,localStorage.setItem(Q.OLD_SDK.USER_DATA,JSON.stringify(e))}catch(t){ct.error(2,e,"Error parsing migration user JSON",t)}return ct.log(2,e,"User resolved from older SDK: ",n),{resolvedUser:n,sdkSettings:t}}):(()=>{if(i&&"resolved"!==i)return ct.log(2,e,"User resolved from cookie: ",i),i.save();{ct.log(2,e,"Local user: ",r);const n=new yi(r);return t.isPushSubBilling&&(ei.shouldTriggerSubscriberBilling({sdkSettings:t,user:n})?(n.deviceAdded=!0,Ti.trackDeviceAttributes()):n.deviceAdded=!1),n.save()}})().then(e=>({resolvedUser:e,sdkSettings:t}))})}).then(({resolvedUser:e,sdkSettings:n})=>{yi.isResolved=!0,n?.isDomainLevelStorage&&(Si=null),t(e)}).catch(t=>{ct.error(2,e,"Error in fetching/creating user",t),Si=null,n(t)})})),Si}static logout(){return new Promise(e=>{Si=null,this.instance=null,window.MoeWebP&&(window.MoeWebP.deviceUuid=null),e(!0)})}save(){yi.baseLogTag;yi.isAmpEnabled()&&(this.deviceUuid=kn.get("moe_uuid")),Cn.get("WEB_SETTINGS");const e=Cn.get(Q.WEB_SETTINGS);return e?.configs?.isWebPersonalizationModuleEnabled&&window.MoeWebP?.deviceUuid&&this.deviceUuid!==window.MoeWebP.deviceUuid&&(this.deviceUuid=window.MoeWebP.deviceUuid),yi.instance=this,new Promise(e=>{Cn.set(Q.USER_DATA,this),kn.set(X,yi.instance.deviceUuid),e(this)})}static isAmpEnabled(){const e=kn.get(X);return e&&e.includes("amp")}getAttribute(e){let t=null;return e=yi.getMorphedKey(e),this.attributes.map(n=>{n.key===e&&(t=n.value)}),t}indexOfAttribute(e){let t=-1;return e=yi.getMorphedKey(e),this.attributes.map((n,r)=>{n.key===e&&(t=r)}),t}static getMorphedKey(e){switch(e){case"id":e=s;break;case"email":e=a;break;case"name":e=o;break;case"first_name":e=c;break;case"last_name":e=l;break;case"mobile":e=u;break;case"gender":e=d;break;case"birthday":e=g}return e}}function Ii(){if(it.get(ne))return;const e=lt(window.location.href);return e.moe_aid&&!e.moe_aid.includes("{{")?e.moe_aid:void 0}function Ai(){const e=Et.get(),t=!!e&&!!e.disableSdk;let n=!1;return n=function(){const e=Cn.get(Q.WEB_SETTINGS);return e?.isDomainLevelStorage||!1}()?kn.get(Q.SDK_DISABLED):Cn.get(Q.SDK_DISABLED),!(n||t&&!1!==n)}function wi(e){return null!=e&&"NA"!==e&&""!==e&&"null"!==e}function Oi(e){const t=(new Date).getTime()-e;return Math.round(t/1e3)}class Di{static listeners=[];static topicListeners={};static getListeners(){return this.listeners}static getTopicListeners(e){return rt(Di.topicListeners,e,[])}static addListener(e){Di.listeners.push(e)}static addTopicListener(e,t){Di.topicListeners[e]=Di.getTopicListeners(e),Di.topicListeners[e].push(t)}static broadcast(e){Di.listeners.map(t=>{t(e)}),rt(Di.topicListeners,e.topic,[]).map(t=>{t(e)})}static broadcastToWindow(e,t=!1){window&&(t||Ai())&&window.dispatchEvent(new CustomEvent(e.topic,{detail:{name:e.name,data:e.data?e.data:null}}))}static deprecatedSdkCallback(e){window.dispatchEvent(new CustomEvent("MOE_OPT_IN",{detail:e}))}static resetAllListeners(){Di.listeners=[],Di.topicListeners={}}static resetListeners(){Di.listeners=[]}}const Ni=Di;function Ri(e){const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}function Li(e){return new Date(Date.parse(e))}function ki(e,t=15){const n=(new Date).getTime()-new Date(e).getTime();return Math.round(n/6e4)>=t}const Pi=()=>window.Moengage,Ci=()=>{let e={};return e=""!==window.location.search?Hi(window.location.search):Hi(window.location.hash),e},Mi=()=>{const e=Ci();return e[Be]&&"1"===e[Be]&&xi()},xi=()=>window.self===window.top,Ui=e=>e.sort((e,t)=>{return e.delivery.priority===t.delivery.priority&&(n=e.updated_time,r=t.updated_time,Li(n+"Z").getTime()-Li(r+"Z").getTime()>0)?-1:1;var n,r}),Bi=e=>{const t={},n={};return{experiences:e=e.filter(e=>{if(e.is_ai&&(n[e.id]=e.context),0===e.payload.length)return!(Number(e.context.moe_variation_id)>1);let r=!1;return e.payload.forEach(n=>{const i=n.widgetId&&n.type===ye?n.selector+"_"+n.type+"_"+n.widgetId:n.selector+"_"+n.type;n.widgetId&&!n.content||t[i]||(r=!0,t[i]=n,t[i].expId=e.id)}),r}),allOp:t,aiExperienceContext:n}},Wi=async e=>{await Promise.all(e.map(e=>{ht.experiencesStore.setItem(e.id,e)}))},Vi=async()=>{const e=[];return await ht.experiencesStore.iterate(t=>{e.push(t)}),e},Fi=async e=>await ht.experiencesStore.getItem(e),Ki=async e=>await ht.tabbedExperiences.getItem(e),ji=async()=>await(ht.metaStore?.removeItem(Je.LAST_FETCHED_TIME));function Gi(){const e="Web Personalisation.getMetaInfo",t=document.currentScript;let n,r,i,s,a,o,c,l="",u="",d=!1;if(t){"dc_3"in D&&(l=D.dc_3);const g=new URL(t.src),p=new URLSearchParams(g.search);if(n=p.get("app_id")||"",r=p.get("env")||"",i=p.get("api_proxy")||"",s=p.get("cdn_proxy")||"",a=p.get("app-cdn_proxy")||"",o=p.get("image_proxy")||"",d="true"===p.get("enable_split_url"),c="true"===p.get("disable_webp"),p.get("cluster")){const e=p.get("cluster"),t=e?.toUpperCase();e&&t&&t in N&&(l=t)}return"1"!==p.get("debug_logs")||n.includes("_DEBUG")||(n+="_DEBUG"),r?u="https://"+r+"/":l&&l in N&&(u="https://"+N[l]+"/"),i&&(u="https://"+i+"/"),r||l||ct.error(2,e,"Please check WebP integration: data center not present"),n||ct.error(2,e,"Please check WebP integration: app_id not present"),{APP_ID:n,HOST:u,CLUSTER:l,ENABLE_SPLIT_URL:d,CDN_PROXY_DOMAIN:s,APP_CDN_PROXY_DOMAIN:a,IMAGE_PROXY_DOMAIN:o,DISABLE_WEBP:c}}return{}}const Hi=e=>{if(e){const t=e.indexOf("?");if(t<0)return{};const n=(e=e.slice(t+1)).replace("?","").split("&"),r={};return n.forEach(e=>{const t=e.split("="),n=t[0],i=decodeURIComponent(t[1]||"");r[n]?"[object Array]"===Object.prototype.toString.call(r[n])?r[n].push(i):r[n]=[r[n],i]:r[n]=i}),JSON.parse(JSON.stringify(r))}return{}};function qi(){const e=navigator.userAgent.toLowerCase();return function(e){if(/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/i.test(e))return!0;return!1}(e)?"tablet":function(){const e=navigator.userAgent;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))return!0;return!1}()?"mweb":e.includes("mac")&&navigator.maxTouchPoints>1?"tablet":"web"}function Yi(e,t){return e===he&&"tablet"===t?"web":t}function zi(e,t){window.MoeWebP.statsData[e]=t}function $i(){try{let e,t;return e="1"===Xi("moe_c_s")||"true"===Xi("COOKIE_SHARING")?{deviceUuid:Xi(X)}:Cn.get(Q.USER_DATA),e&&e.deviceUuid?t=e.deviceUuid:(t=window.MoeWebP?.deviceUuid,t||(t=pr(),window.MoeWebP=window.MoeWebP||{},window.MoeWebP.deviceUuid=t)),t}catch(e){ct.error(2,"Web Personalisationutils.getOrSetDeviceUUID","Error fetching or setting device UUID:",e)}}function Xi(e){const t=e+"=",n=function(){const e="Web Personalisation.getDecodedCookies",t=document.cookie.split(";");return t.map(t=>{let n=t.trim();"%"===n.slice(-1)&&(n+="25");try{return decodeURIComponent(n)}catch(t){return ct.error(2,e,"Error decoding cookie:",n,t),n}})}();for(let e=n.length-1;e>=0;e--){let r=n[e];for(;" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null}const Ji=(e,t)=>{let n;return function(...r){clearTimeout(n),n=setTimeout(()=>{e.apply(this,r),n=void 0},t)}};function Qi(e){return"is_ai"in e&&e.payload.length>0}function Zi(){return window[xe]}async function es(){const e=ts(window.location.href),t=await(async e=>await ht.splitExperiences.getItem(e))(e);return!!(t&&Li(t.expiry_time+"Z")>new Date)}function ts(e){return(e=e.split("?")[0]).replace(/^(https?:\/\/)?(www\.)?/,"https://").replace(/\/$/,"")}function ns(e){const t=ts(window.location.href);return!(!e||!e.redirection_url||ts(e.redirection_url)===t)&&(location.replace(e.redirection_url),!0)}const rs=async(e,t,n=!1)=>{const r=await Fi(e);return!!r&&(r.payload=t,n&&(r.is_ai=!0),window.MoeWebP.handleDomManipulator(r),!0)};function is(){const e={};try{const t=Cn.get(Q.IDENTITY_MAP),n=$i();(function(){const e=Cn.get(Q.USER_DATA);if(!e)return;let t;e?.attributes.map(e=>{e.key===s&&(t=e.value)}),t?.toString()})();t&&(t.userIdentities&&(e.user_identifiers=t.userIdentities),t.previousIdentities&&(e.previous_user_identifiers=t.previousIdentities)),n&&(e.unique_id=n)}catch(e){ct.error(2,"Web Personalisationutils.getUserIdentifier","Error fetching user identifier :",e)}return e}function ss(e){const t=Cn.get(Q.INIT_DATA),n=!!t?.disableSdk,r=Cn.get(Q.SDK_DISABLED);if(r||n&&!1!==r||!t&&e){const e="Web Personalisationutils.isSdkEnabled";return ct.warn(2,e,"Web Personlization is disabled"),!1}return!0}function as(e,t){const n=Ue,r=e.getAttribute(n);if(r){const i=r.split(",").map(e=>e.trim());i.includes(t)||(i.push(t),e.setAttribute(n,i.join(",")))}else e.setAttribute(n,t)}const os=(e,t)=>{if(!e?.setAttribute)return;const n=t=>{e.setAttribute(He.LABEL_NAME,t)},r=e.getAttribute(He.LABEL_NAME)||"";r&&!r.includes(Ye[t])?n(r+" & "+Ye[t]):n(Ye[t])};let cs;const ls=()=>{cs=(()=>{const e=document.createElement("div");function t(t){t.stopPropagation();const n=this.getAttribute(He.LABEL_NAME);e.textContent=n;const r=t.clientX+15,i=t.clientY-35;e.style.left=r+"px",e.style.top=i+"px",e.classList.add("visible")}function n(){e.classList.remove("visible")}return e.classList.add("tooltip"),window.onload=()=>{document.body.appendChild(e)},{enable:function(e=document){e.querySelectorAll(`[${He.LABEL_NAME}]`).forEach(e=>{e.addEventListener("mousemove",t),e.addEventListener("mouseleave",n)})},disable:function(e=document){e.querySelectorAll(`[${He.LABEL_NAME}]`).forEach(e=>{e.removeEventListener("mousemove",t),e.removeEventListener("mouseleave",n)})}}})()};class us{static baseLogTag="DomManipulator";static initiate(e,t,n,r){const i=us.baseLogTag+".initiate";if(e.content?.length&&(e.content=function(e){let t=e;const{CDN_PROXY_DOMAIN:n,APP_CDN_PROXY_DOMAIN:r,IMAGE_PROXY_DOMAIN:i}=Gi();return"string"==typeof t&&t.length&&(r&&(t=t.replace(/app-cdn\.moengage\.com/gi,r)),n&&(t=t.replace(/cdn\.moengage\.com/gi,n)),i&&(t=t.replace(/image\.moengage\.com/gi,i))),t}(e.content)),!e||!e.type)return ct.error(2,i,"Operation type is missing:",e),{success:!1,reason:"invalid type",operation:e};const{type:s}=e;let a;switch(s){case Te:a=us.handleInsertOp(e,n);break;case ye:a=us.handleInsertJSOp(e,n);break;case De:a=us.handleReplaceOp(e,n);break;case Ie:a=us.handleUpdateOp(e,n);break;case Oe:a=us.handleUpdateHTMLOp(e,n);break;case Ne:a=us.handleDeleteOp(e,n);break;case Re:a=us.handleHideOp(e,n);break;case Ae:a=us.handleAttributeOp(e,n);break;case we:a=us.handleTrackingOp(e,n,t,r);break;case Se:a=us.handleReArrangeOp(e,n);break;default:a={success:!1,reason:"invalid type",operation:e}}return a}static handleInsertOp(e,t){const n=us.baseLogTag+".handleInsertOp";if(e.content&&e.placement){const r=t.querySelector(e?.selector);if(r){const t=Ri(xi()||!e.metaData?.html?e.content:e.metaData?.html);return os(t,e.content.trim().startsWith("<img")?"insert_image":e.type),e.dataMoeId&&as(t,e.dataMoeId),"after"===e.placement?r.parentNode.insertBefore(t,r.nextSibling):"before"===e.placement&&r.parentNode.insertBefore(t,r),ct.log(2,n,"Operation applied successfully: ",e),{success:!0}}return ct.error(1,n,"invalid query selector -> ",e),{success:!1,reason:"invalid query selector",operation:e}}return ct.error(1,n,"Unable to find content / placement.",e),{success:!1,reason:"unable to find content / placement.",operation:e}}static handleInsertJSOp(e,t){const n=us.baseLogTag+".handleInsertJSOp";if(e.content)try{const t=function(e){try{return JSON.parse(e)}catch(e){return null}}(e?.content),r=document.createElement("script");return r.textContent=t,document.body?document.body.appendChild(r):document.head.appendChild(r),ct.log(2,n,"Operation applied successfully: ",e),{success:!0}}catch(t){return{success:!1,reason:`Document is not loaded.: ${t}`,operation:e}}return ct.error(1,n,"Unable to find content / placement.",e),{success:!1,reason:"unable to find content / placement.",operation:e}}static handleReplaceOp(e,t){const n=us.baseLogTag+".handleReplaceOp";if(e.content){const r=t.querySelector(e.selector),i=Ri(e.content);return r&&i?(os(i,e.type),e.dataMoeId&&as(i,e.dataMoeId),r.replaceWith(i),ct.log(2,n,"Operation applied successfully: ",e),{success:!0}):(ct.error(1,n,"invalid "+(r?"content ->":"query selector -> "),e),{success:!1,reason:"invalid "+(r?"content":"query selector"),operation:e})}return ct.error(1,n,"Unable to find content.",e),{success:!1,reason:"unable to find  content.",operation:e}}static handleUpdateOp(e,t){const n=us.baseLogTag+".handleUpdateOp";if(e.content){const r=t.querySelector(e.selector);return r?(e.dataMoeId&&as(r,e.dataMoeId),r.innerHTML=e.content,ct.log(2,n,"Operation applied successfully: ",e),os(r,e.type),{success:!0}):(ct.error(1,n,"invalid query selector ->",e),{success:!1,reason:"unable to find selector / content / placement.",operation:e})}return ct.error(1,n,"Unable to find content.",e),{success:!1,reason:"unable to find content.",operation:e}}static handleUpdateHTMLOp(e,t){const n=us.baseLogTag+".handleUpdateHTMLOp";if(e.content){const r=t.querySelector(e.selector);if(r){const i=Ri(e.content);return e.tab_info&&(os(i,e.type),function(e,t){const n=t.getElementById(e.tab_id);n&&n.classList.remove("moe-hide-tab")}(e.tab_info,t)),e.dataMoeId&&as(r,e.dataMoeId),r.outerHTML=i.outerHTML,ct.log(2,n,"Operation applied successfully: ",e),{success:!0}}return ct.error(1,n,"invalid query selector ->",e),{success:!1,reason:"unable to find selector / content / placement.",operation:e}}return ct.error(1,n,"Unable to find content.",e),{success:!1,reason:"unable to find content.",operation:e}}static handleDeleteOp(e,t){const n=us.baseLogTag+".handleDeleteOp",r=t.querySelector(e.selector);return r?(r.remove(),ct.log(2,n,"Operation applied successfully: ",e),{success:!0}):(ct.error(1,n,"invalid query selector ->",e),{success:!1,reason:"invalid query selector.",operation:e})}static handleHideOp(e,t){const n=us.baseLogTag+".handleHideOp",r=t.querySelector(e.selector);return r&&r.style?(r.style.display="none",os(r,e.type),ct.log(2,n,"Operation applied successfully: ",e),{success:!0}):(ct.error(1,n,"invalid query selector -> ",e),{success:!1,reason:"invalid query selector",operation:e})}static handleAttributeOp(e,t){const n=us.baseLogTag+".handleAttributeOp";if(e.attributes){const r=t.querySelector(e.selector);return r?(Object.keys(e.attributes).forEach(t=>{if("style"===t){const n=r.getAttribute(t)||"",i=n+function(e,t){let n=t.length>0&&";"!==t.slice(-1)?";":"";return Object.keys(e).forEach(t=>{n=n+t+":"+e[t]+";"}),n}(e.attributes[t],n);r.setAttribute(t,i)}else r.setAttribute(t,e.attributes[t])}),e.dataMoeId&&as(r,e.dataMoeId),os(r,e.type),ct.log(2,n,"Operation applied successfully: ",e),{success:!0}):(ct.error(1,n,"invalid "+(r?"attributes":"query selector "),e),{success:!1,reason:r?"unable to find attributes.":"invalid query selector",operation:e})}return ct.error(1,n,"Unable to find attributes.",e),{success:!1,reason:"unable to find attributes.",operation:e}}static handleTrackingOp(e,t,n,r){const i=us.baseLogTag+".handleTrackingOp",s=t.querySelector(e?.selector);if(e.id&&r){if(s&&e.id){function a(t,r){const i=t._moeListeners||[];for(const t of i)if(t.fn===r&&t.operation===e&&t.context===n)return;const s=t=>{r(t,e,n)};t.addEventListener("click",s),t._moeListeners=i.concat({fn:r,operation:e,context:n,clickHandler:s})}return a(s,this.eventTracking),os(s,e.type),ct.log(2,i,"Operation applied successfully: ",e),{success:!0}}return ct.error(1,i,"invalid "+(s?"ID ":"query selector "),e),{success:!1,reason:s?"unable to track ID.":"invalid query selector",operation:e}}return e.id&&os(s,e?.type),ct.error(1,i,"Unable to find ID or it is not a Live Experience.",e),{success:!1,reason:"unable to find ID or it is not a Live Experience.",operation:e}}static eventTracking(e,t,n){const r=e.target.dataset.widgetId,i=e.target.dataset.tabContainerId,s={b_id:t.id,...n};t.widgetId&&(s.widget_id=t.widgetId),i?s.moe_widget_id=i:r&&(s.moe_widget_id=r),Pi().track_event(je,s)}static handleReArrangeOp(e,t){const n=us.baseLogTag+".handleReArrangeOp",r=e.selector&&t.querySelector(e.selector);if(e.orderList&&r){const t=e.orderList.map(e=>(r.children[e].setAttribute("data-moe-rearrange-id",e.toString()),r.children[e]));return r.innerHTML="",t.forEach(e=>{r.appendChild(e)}),e.dataMoeId&&as(r,e.dataMoeId),os(r,e?.type),ct.log(2,n,"Operation applied successfully.",e),{success:!0}}return ct.error(2,n,"unable to find selector / new order list.",e),{success:!1,reason:"unable to find selector / new order list.",operation:e}}}class ds{static baseLogTag="WebPApi";appId;host;deviceType;constructor(){const e=Gi();this.appId=e.APP_ID,this.host=e.HOST,this.deviceType=qi()}async getLiveExperiences(e=!1){const t=Zi(),n={};return!e&&t&&(n.page_attributes=t),new Promise(async(t,r)=>{this.makeAPICall(ge,{all_exp:e},n,!0).then(n=>{t(new Un(n)),n.personalization_used.dpm||e&&(async e=>{await(ht.metaStore?.setItem(Je.LAST_FETCHED_TIME,e))})(new Date)}).catch(e=>{r(e)})})}async getTestExperiences(){return new Promise(async(e,t)=>{e(this.makeAPICall(pe))})}async sendStats(e){return new Promise(async(t,n)=>{t(this.makeAPICall(he,void 0,e,!1))})}async getWebActions(){return new Promise(async(e,t)=>{e(this.makeAPICall(fe))})}async getLiveRecommendations(e){return e.platform=this.deviceType,new Promise(async(t,n)=>{t(this.makeAPICall(me,e))})}async isSplitUrlExperience(){return new Promise(async(e,t)=>{const n=new Date;e(this.makeAPICall(Ee,{},{user_time:Math.floor(n.getTime()/1e3),user_tz_offset:60*n.getTimezoneOffset()}))})}async getTabData(e,t){return new Promise(async(n,r)=>{n(this.makeAPICall(_e,{},{experience_id:e,tab_id:t}))})}async fetchExperiences(e,t){return new Promise(async(n,r)=>{n(this.makeAPICall(ve,{},{experience_key:e,...t}))})}makeAPICall(e,t,n,r){const i=ds.baseLogTag+".makeAPICall";return new Promise((s,a)=>{const o=function(){const e=new Date;return{day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()],hours:String(e.getHours()).padStart(2,"0")}}(),c=is();let l;l=""!==window.location.search?Hi(window.location.search):Hi(window.location.hash);const u=window.location.href.split("?")[0],d={...l,app_id:this.appId,sdk_ver:"2.64.00",platform:Yi(e,this.deviceType),payload_id:l.payload_id,USER_TYPE:(rt(Cn.get(Q.SESSION),I)||0)>1?"Returning":"New",DAY_OF_THE_WEEK:o.day,TIME_OF_THE_DAY:o.hours,current_url:t?u:void 0,unique_id:c.unique_id,...t},g={headers:{},postData:n,queryParams:{}};[ge,me,Ee,_e,ve].includes(e)?(delete d.unique_id,g.postData={...g.postData,...d,identifiers:c}):g.queryParams=d;try{if(g.postData)g.headers={"MOE-APPKEY":this.appId,"Content-Type":"application/json"},ut.post(`${this.host}${e}`,g).then(e=>{const t=JSON.parse(e.responseText);s(t)}).catch(e=>{ct.error(1,i,"Error in POST request: ",e),a(e)});else{const t=(new Date).getTime();ct.log(1,i,`API requested Start Time: ${e} -> `,t),ut.get(`${this.host}${e}`,g).then(n=>{const a=JSON.parse(n.responseText);ct.log(1,i,"Get WebP API call success, response: ",a);const o=(new Date).getTime();ct.log(1,i,`API response received Time : ${e} -> `,o),r&&(zi("api_start_time",t),zi("api_end_time",o)),s(a)}).catch(e=>{ct.error(1,i,"Error in GET request: ",e),a(e)})}}catch(e){if(ct.error(1,i,"Error getting WebP Test Expressions: ",e),!n){const e=(new Date).getTime();r&&zi("api_request_failed_time",e)}a("Error getting WebP Expressions")}})}}class gs{static baseLogTag="Webp.Listener";static observerCounter=1;static observers=[];static listenToDomChanges(e,t,n,r,i){const s=gs.baseLogTag+".listenToDOMChanges",a=i?document:document.querySelector(e.selector),o=document.location.href,c=Ji(gs.retryFailedExperiences.bind(this,i),500),l=Ji(function(e){ct.log(2,s,`Dom Observer is disconnected, Total number of retry: ${gs.observerCounter}`),d.disconnect()},500),u=Ji(this.reApplyRevertedChanges.bind(this),500),d=new MutationObserver(s=>{let a=!0;const d=o!==document.location.href;if(s.forEach(e=>{"childList"===e.type&&e.removedNodes[0]?.nodeValue===e.addedNodes[0]?.nodeValue&&(a=!1)}),a)if(i){const e=Es.failedOperations.length,t=Object.keys(Es.moeOperationsWithDataID).length;e>0?c():(gs.observerCounter>20&&t<1&&e<1||d)&&l(),t>0&&u()}else d||this.selectorObserver(e,t,r,n)});this.observers.push(d),a&&d.observe(a,{childList:!0,subtree:!0,attributes:!1,characterData:!0})}static selectorObserver(e,t,n,r){const i=gs.baseLogTag+".documentObserver",s=t?.cid.split("_")[0];ct.log(1,i,"Re-applying the operation: ",e);us.initiate(e,t,r,n).success&&(s&&!Es.appliedExperiences.hasOwnProperty(s)&&(Es.appliedExperiences[s]=!0),gs.listenToDomChanges(e,t,r,n))}static retryFailedExperiences(e){const t=gs.baseLogTag+".retryFailedExperiences";ct.log(2,t,`Retring Failed Operations, Total number of retry attempts: ${gs.observerCounter}`),e(),gs.observerCounter++}static reApplyRevertedChanges(){const e=Es.moeOperationsWithDataID,t=gs.baseLogTag+".documentObserver";ct.log(2,t,`Retring Failed Operations, Total number of retry attempts: ${gs.observerCounter}`),Object.keys(e).forEach(n=>{const r=e[n],i=function(e,t){const n=e.querySelectorAll(`[${Ue}]`);for(const e of Array.from(n)){const n=(e.getAttribute(Ue)||"").split(",").map(e=>e.trim());if(n.includes(t))return e}return null}(document,n);i||r.forEach(e=>{us.initiate(e,void 0,document,!0),ct.log(2,t,"Re-applying the operation: ",e)})}),gs.observerCounter++}static disconnectObservers(){this.observers&&this.observers.length>0&&(this.observers.forEach(e=>{e.disconnect()}),this.observers=[])}}class ps{static baseLogTag="experienceTriggerManager";static startWatchingRetries=1;events={};listener=null;historyManager=window[J];constructor(e){this.events=e}onTrigger(e){this.listener=e}onEvent=e=>{const t=ps.baseLogTag+".onEvent";try{this.events[e.name]&&this.events[e.name].forEach(t=>{const n=this.getAttributeValue(e.attributes,t);n&&this.trigger(n)})}catch(e){ct.error(2,t,"Error occurred during check event trigger experiences: ",e)}};async startWatching(){const e=ps.baseLogTag+".startWatching";if(this.historyManager){ct.log(2,e,"Initialized event Trigger Watcher for AI experiences");this.historyManager.getHistory().forEach(this.onEvent),this.historyManager.addEventListener(this.onEvent)}else ps.startWatchingRetries<=Me&&setTimeout(()=>{ps.startWatchingRetries++,this.historyManager=window[J],this.startWatching()},2e3*ps.startWatchingRetries)}trigger(e){null!=this.listener&&this.listener(e)}getAttributeValue(e,t){let n=null;for(const r of e)if(r.key===t){n=r.value;break}return n}}class hs{static LogTag="AI Experiences";WebPApis;constructor(){this.WebPApis=new ds}setExperienceTriggerManager=async()=>{const e=hs.LogTag+".setExperienceTriggerManager",t=await this.getWebActionEvents(),n=new ps(t);ct.log(2,e,"Initializing Trigger Manager"),n.onTrigger(this.renderAiExperiences.bind(this)),n.startWatching()};getWebActionEvents=async()=>{const e=hs.LogTag+".getWebActionEvents";let t;return ki(await(async()=>await ht.aiExperiencesStore.getItem(tt.WEB_ACTIONS_LAST_FETCHED_TIME))(),1440)?(ct.log(2,e,"synchronizing Web Actions Events data for Real Time Recommendations as time limit exceeded"),t=await this.WebPApis.getWebActions(),(async e=>{await ht.aiExperiencesStore.setItem(tt.WEB_ACTION_EVENTS,e)})(t),(async e=>{await ht.aiExperiencesStore.setItem(tt.WEB_ACTIONS_LAST_FETCHED_TIME,e)})(new Date)):(t=await(async()=>await ht.aiExperiencesStore.getItem(tt.WEB_ACTION_EVENTS))(),ct.log(2,e,"Using the cached Web Actions Events data for Real Time Recommendations:",t)),t};async renderAiExperiences(e){const t=hs.LogTag+".renderAiExperiences",n=await(async()=>await ht.aiExperiencesStore.getItem(tt.AI_EXPERIENCE_CONTEXT))()||{},r={experience_context:n,product_id:e?.toString()};return this.WebPApis.getLiveRecommendations(r).then(e=>(ct.log(2,t,`AI Live Recommendations experiences payload: ${n}`),Object.keys(e).forEach(t=>{rs(t,e[t]?.data)}),!0)).catch(e=>{ct.error(2,t,"AI Live Recommendations experiences failed:",e)})}}class fs{static baseLogTag="Webp.AntiFlickerListener";static observerCounter=1;static listenToDomChanges(){if(!document.getElementById("moe-flicker-style"))return void ct.log(2,fs.baseLogTag,"Anti Flicker Script not available");const e=Ji(function(){fs.observerCounter>10?t.disconnect():(fs.observerCounter+=1,fs.removeOverLay())},200),t=new MutationObserver(t=>{let n=!0;t.forEach(e=>{"childList"===e.type&&e.removedNodes[0]?.nodeValue===e.addedNodes[0]?.nodeValue&&(n=!1)}),n&&e()});document&&t.observe(document,{childList:!0,subtree:!0,attributes:!1,characterData:!0})}static removeOverLay(){const e=fs.baseLogTag+".removeOverLay",t=document.querySelectorAll(`.${Ve}`);t.length>0&&t.forEach(e=>{e.classList.add("moe-anti-flicker-show"),e.classList.remove(Ve)}),document.documentElement.className.includes(Fe)&&document.documentElement.classList.remove(Fe),ct.log(2,e,"Removed WebP Anti-Flicker Styles From:",t)}}const ms=Gi();class Es{static experiences;static baseLogTag="Web Personalisation";static WebPApis=new ds;static failedOperations=[];static isAnyOperationSuccessful=!1;static appliedExperiences={};statsData={};retryExperienceCount=0;isLiveExperience;domManipulatorStartTime;completeDomManipulationTimer;static allOperations;isDomMutationObserverAdded;trackingDelayCounter=1;AiExperiences;static moeOperationsWithDataID={};deviceUuid;boundIdentityUpdateHandler;constructor(){const e=Es.baseLogTag+".constructor";if(new RegExp(["bot","spider","crawler","crawling","Applebot","PetalBot","pingbot","proximic","AdsBot-Google","Googlebot","Cincraw","SnapchatBot","Snapchat-Proxy/1.0","SnapchatAds","Snapchat-Ads/1.0","YandexRenderResourcesBot","bingbot","slurp","MicrosoftPreview","Baiduspider"].join("|"),"i").test(navigator.userAgent))ct.error(1,e,"Bot detected, Can't initialise the MoEngage WebP SDK");else{if(ms.APP_ID&&ms.HOST){if(ss(ms.DISABLE_WEBP)){window.addEventListener(A.TOPIC_NAME,e=>{const t=e?.detail?.name;t===A.EVENT_NAMES.SDK_DISABLED&&window.MoeWebP.disableWebPersonalization()}),this.deviceUuid=$i(),this.AiExperiences=new hs;const t=(new Date).getTime();this.isLiveExperience=!1,ct.log(2,e,"WEBP SDK Loaded :",t),this.isSentryEnabled()&&("1"===Ci().moeWpT?(Es.WebPApis.getTestExperiences().then(e=>{this.DomManipulator(e.payload)}),fs.removeOverLay(),ct.log(2,e,"Web P Test Campaign Dom Manipulation.")):Mi()?(this.getEditorVersion().then(t=>{t===We?(this.injectEditorFile("https://app-cdn.moengage.com/personalization-ui/editor/moe-web-editor.staging.js"),ct.log(2,e,"Web P module initialized in staging editor mode. Version not found, loading default staging editor.")):(this.injectEditorFile((e=>`https://app-cdn.moengage.com/personalization-ui/editor/moe-web-editor.${e}.js`)(t)),ct.log(2,e,"Web P module initialized in editor mode."))}),fs.removeOverLay()):xi()?(this.boundIdentityUpdateHandler=this.identityUpdateHandler.bind(this),this.statsData.webP_initialization_time=t,this.getLiveExperiences(),this.handleLogoutListener(),this.handleSPA(),this.handleIdentityChange()):((()=>{const e=document.createElement("style");e.id=qe.STYLE_ID,e.innerHTML=qe.STYLE_DATA,document.head.appendChild(e)})(),ls()))}}else ct.error(2,e,"WebP is not properly integrated");window.Moengage?.personalize?Ni.broadcastToWindow({topic:A.TOPIC_NAME,name:A.EVENT_NAMES.WEBP_INIT}):window.addEventListener(A.TOPIC_NAME,e=>{const t=e?.detail?.name;t===A.EVENT_NAMES.MOE_INIT&&Ni.broadcastToWindow({topic:A.TOPIC_NAME,name:A.EVENT_NAMES.WEBP_INIT})})}}resetPageState(){const e=Es.baseLogTag+".resetPageState";ct.log(2,e,"Resetting WebP page state"),Es.appliedExperiences={},Es.failedOperations=[],Es.moeOperationsWithDataID={},Es.isAnyOperationSuccessful=!1,this.completeDomManipulationTimer&&(clearTimeout(this.completeDomManipulationTimer),this.completeDomManipulationTimer=null),this.isDomMutationObserverAdded&&(gs.disconnectObservers(),this.isDomMutationObserverAdded=!1),this.retryExperienceCount=0,this.trackingDelayCounter=1,this.domManipulatorStartTime=0,this.isLiveExperience=!1}async getLiveExperiences(){const e=Es.baseLogTag+".getLiveExperiences";await ht.initialize(),this.syncExperiences().then(async t=>{if(t&&t.experiences&&t.experiences.length){const n=await(async e=>{const t=ts(window.location.href),n=[],r=e.map(async e=>{const r=ts(new URL(e.url).href);if(e?.page_attributes){if(await yr(e))return e}else if(e.url_filters){if(sr(e))return e;n.push(e.id)}else{if(r===t)return e;n.push(e.id)}}),i=(await Promise.all(r)).filter(e=>e?.id);n.length>0&&(zi("current_url",t),zi("url_failed_experiences",n));let s=!1;const a=[];for(const e of i)e?.in_session_behaviour_segment?.included_filters?await vr(e)&&(a.push(e),s=s||Qi(e)):(a.push(e),s=s||Qi(e));return s&&window.MoeWebP.clearLastFetchedTime(),a})(t.experiences);if(n&&n.length>0){const r=(e=>{const t=[],n=e.filter(e=>!!(e&&Li(e.expiry_time+"Z")>new Date)||(t.push(e.id),!1));t.length>0&&zi("expired_experiences",t);const r=n.sort((e,t)=>t.delivery.priority-e.delivery.priority),i=Ui(r);return Bi(i)})(n);Es.allOperations=r.allOp,Es.experiences=r.experiences,(async e=>{await ht.aiExperiencesStore.setItem(tt.AI_EXPERIENCE_CONTEXT,e)})(r.aiExperienceContext),r.aiExperienceContext&&Object.keys(r.aiExperienceContext).length>0&&this.AiExperiences.setExperienceTriggerManager(),Es.experiences&&Es.experiences.length&&Es.experiences[0].id&&zi(Ce,Es.experiences.map(e=>e.id)),ct.log(2,e,"Eligible Experiences found: ",Es.experiences),Es.experiences.forEach(e=>{this.handleLiveExperience(e,t.user_in_gcg)})}else this.noExperienceFoundStats()}}).catch(t=>{ct.error(1,e,"Error syncing Experiences: ",t)}).finally(()=>{fs.listenToDomChanges()})}handleLiveExperience(e,t){const n=Es.baseLogTag+".handleLiveExperience";e&&e.gcg_enabled&&t?(zi(Pe,{experience:e.gcg_enabled,user:t}),ct.log(2,n,"GCG is Enabled for both User and Experience: ",{experience:e,userIsGCG:t}),new Promise(()=>{Es.WebPApis.sendStats({...e.context,gcg_event:!0}),Es.WebPApis.sendStats(this.statsData).then(e=>{e?.success&&(this.statsData={})})})):e?(ct.log(2,n,"Going to trigger this experience: ",e),e.payload.length?e&&this.handleDomManipulator(e):(this.isLiveExperience=!0,Es.appliedExperiences[e.id]=!0,this.handleDomManipulationComplete(e,[],!0))):this.noExperienceFoundStats()}async noExperienceFoundStats(){const e=Es.baseLogTag+".noExperienceFoundStats";return ct.log(2,e,"No eligible experience found"),new Promise(()=>{Es.WebPApis.sendStats(this.statsData).then(e=>{e?.success&&(this.statsData={})})})}async syncExperiences(){const e=Es.baseLogTag+".syncExperiences";return new Promise(async(t,n)=>{try{const n=await(async()=>await(ht.metaStore?.getItem(Je.LAST_FETCHED_TIME)))();if(ki(n)||!n){ct.log(2,e,"synchronizing experiences as time limit exceeded"),ms.ENABLE_SPLIT_URL&&Es.WebPApis.isSplitUrlExperience().then(e=>{ns(e)}),await(async()=>{await ht.experiencesStore.clear(),await ht.aiExperiencesStore.clear(),await ht.metaStore.clear(),await ht.splitExperiences.clear(),await ht.tabbedExperiences.clear()})();const n=await Es.WebPApis.getLiveExperiences();hr(n.experiences),n.experiences&&await Wi(n.experiences),t(n),await Es.WebPApis.getLiveExperiences(!0).then(async e=>{(async e=>{await(ht.metaStore?.setItem(Je.USER_IN_GCG,e))})(e&&e.user_in_gcg),hr(e.experiences),Wi(e.experiences),(async e=>{await Promise.all(e.map(async e=>{const t=ts(e.url);await ht.splitExperiences.setItem(t,e)}))})(e.split_experiences)})}else{if(ms.ENABLE_SPLIT_URL){await es()&&Es.WebPApis.isSplitUrlExperience().then(e=>{ns(e)})}const n=await Vi();t({experiences:n,user_in_gcg:await(async()=>await(ht.metaStore?.getItem(Je.USER_IN_GCG)))()}),ct.log(2,e,"Using the cached experiences for Web Personalisation")}}catch(e){n(e)}})}handleDomManipulator(e){const t=Es.baseLogTag+".DomManipulator";this.isLiveExperience=!0;const n=e&&e.payload;this.domManipulatorStartTime=(new Date).getTime();const{context:r}=e;ct.log(2,t,r?.cid?`Going to render experience with ID: ${r.cid} and `:" ","Operations: ",n),ct.log(2,t,"Dom Manipulator start Time: ",this.domManipulatorStartTime);let i=[];!e.is_ai&&Es.allOperations?Object.keys(Es.allOperations).forEach(t=>{const n=Es.allOperations[t];n.expId===e.id&&i.push(n)}):i=e.payload,i.length&&this.DomManipulator(i,e.id,document,r),Es.failedOperations.length?this.completeDomManipulationTimer=setTimeout(()=>{this.handleDomManipulationComplete(e,this.retryFailedOperations)},3e3):this.handleDomManipulationComplete(e,[],!0),this.isDomMutationObserverAdded||(gs.listenToDomChanges(null,null,null,null,this.retryFailedOperations.bind(this,e)),this.isDomMutationObserverAdded=!0)}DomManipulator(e,t,n=document,r){const i=Es.baseLogTag+".DomManipulator";ss(ms.DISABLE_WEBP)&&e.forEach(e=>{try{us.initiate(e,r,n,this.isLiveExperience).success?(e.dataMoeId?this.saveMoeDataIdOperations(e):Le.includes(e.type)||gs.listenToDomChanges(e,r,n,this.isLiveExperience),Es.appliedExperiences.hasOwnProperty(t)||(Es.appliedExperiences[t]=!0),Es.isAnyOperationSuccessful||(Es.isAnyOperationSuccessful=!0)):Es.failedOperations=Es.failedOperations.concat([[e,r,n,this.isLiveExperience]])}catch(e){ct.error(2,i,"Error in Dom Manipulation",e)}})}retryFailedOperations(e){const t=Es.baseLogTag+".startRetry";ct.log(2,t,"Retrying failed operations: ",Es.failedOperations);const n=Es.failedOperations.concat([]);Es.failedOperations=[];const r=this.handleRetry(n,e.id);this.retryExperienceCount++,0===Es.failedOperations.length&&(ct.log(2,t,"Total number of times retried applying webP changes: ",this.retryExperienceCount-1),clearTimeout(this.completeDomManipulationTimer),this.handleDomManipulationComplete(e,r)),fs.removeOverLay()}handleRetry(e,t){const n=[];for(;e.length>0;){const r=e.pop(),i=us.initiate.apply(null,r);i.success?r[0].type!==ye&&(r[0].dataMoeId?this.saveMoeDataIdOperations(r[0]):ke.includes(r[0].type)||gs.listenToDomChanges.apply(gs,r),Es.appliedExperiences.hasOwnProperty(t)||(Es.appliedExperiences[t]=!0),Es.isAnyOperationSuccessful||(Es.isAnyOperationSuccessful=!0)):(n.push(i),Es.failedOperations=Es.failedOperations.concat([r]))}return n}handleDomManipulationComplete(e,t,n){const r=Es.baseLogTag+".handleDomManipulationComplete",i=e.context,s=(new Date).getTime();ct.log(2,r,"Dom end Time: ",s),this.domManipulatorStartTime&&ct.log(1,r,`Total time taken to manipulate the DOM: ${(s-this.domManipulatorStartTime)/1e3}s`),this.isLiveExperience&&(t&&t.length&&zi("payload_failer",{reason:"Experiences payload Failed to Execute",campaign_id:i?.cid,data:t}),this.domManipulatorStartTime&&(zi("dom_manipulator_start_time",this.domManipulatorStartTime),zi("dom_manipulator_end_time",s)),new Promise(()=>{Es.WebPApis.sendStats(this.statsData).then(e=>{e?.success&&(this.statsData={})})}),(Es.isAnyOperationSuccessful||n)&&(setTimeout(()=>Object.keys(Es.appliedExperiences).map(async e=>{Es.appliedExperiences[e]&&await this.track(e)}),this.trackingDelayCounter),this.trackingDelayCounter++))}async getEditorVersion(){const e=Es.baseLogTag+".getEditorVersion";return new Promise(async(t,n)=>{const r=Hi(window.location.search);if(function(){const{HOST:e}=Gi();return e&&e.includes("moestaging")}())return r.webPStagingVersion&&t(r.webPStagingVersion),void t(We);const i=await ut.get("https://app-cdn.moengage.com/personalization-ui/editor/version.json");if(200===i.status)try{const e=JSON.parse(i.responseText);"1"===r.pre_prod&&t(e.PRE_PROD),t(e[ms.CLUSTER]||"")}catch(t){ct.error(2,e,"Error in getting editor version file",t),n(t)}t("")})}async injectEditorFile(e){return new Promise(async(t,n)=>{const r=document.createElement(be);r.src=e;document.getElementsByTagName("head")[0].appendChild(r)})}async track(e){Es.appliedExperiences[e]=!1;let t=await Fi(e);t||(t=Es.experiences.find(t=>t.id===e)),t&&(this.eventTracking(Ke,t.id,t.context),t.tab_list&&this.renderTabbedExperience(e,t.tab_list))}isSentryEnabled(){const e=Es.baseLogTag+".isSentryEnabled";try{const e=JSON.parse(localStorage.getItem("MOE_DATA"));return!(e&&e.WEB_SETTINGS&&e.WEB_SETTINGS.configs)||e.WEB_SETTINGS.configs.isWebPersonalizationModuleEnabled}catch(t){ct.error(1,e,"Error in getting sentry flag for webp: ",t)}}async clearLastFetchedTime(e){return ct.log(2,"MoeWebP.clearLastFetchedTime","Clearing cache for Web Personalisation"),e&&(Es.failedOperations=[]),await ji()}isEditorModeEnabled(){return Mi()||!xi()}setLogLevel(e){ct.setLogLevel(e,!1),ct.setLogTabStyle("#85586F")}async handleInSessionEvent(e){const t=Es.baseLogTag+".handleInSessionEvent";(await(async()=>{if(ht&&ht.inSessionStore)return await ht.inSessionStore.getItem(nt.IN_SESSION_EVENTS)||[];return[]})()).includes(e.name)&&(ct.log(2,t,"Event found in Web personalization experience: ",e.name),(async e=>{const t=await _r();t.unshift(e),t.length>10&&t.pop(),ht.inSessionStore.setItem(nt.IN_SESSION_EVENTS_HISTORY,t)})(e))}saveMoeDataIdOperations(e){Es.moeOperationsWithDataID[e.dataMoeId]?Es.moeOperationsWithDataID[e.dataMoeId].push(e):Es.moeOperationsWithDataID[e.dataMoeId]=[e]}eventTracking(e,t,n,r){const i=Es.baseLogTag+".eventTracking";try{return Pi()?(ct.log(1,i,e+": Event Tracked"),Pi().track_event(e,{campaign_id:t,...n})):(window.moengage_q=window.moengage_q||[]).push({f:"track_event",a:[e,{campaign_id:t,...n,...r}]}),Promise.resolve()}catch(e){ct.error(2,i,"Failed Tracking expression",e)}}trackClick(e,t,n){return this.eventTracking(je,e,t,n)}previewExperiences(e,t){const n=Es.baseLogTag+".previewExperiences";return ct.log(2,n,(e?"Adding":"Removing")+" border and label to personalized experiences"),e?((e=document)=>{const t="Web Personalisation.previewExperiences";cs.enable||ct.error(2,t,"Preview mode is not enabled"),e.querySelectorAll(`[${He.LABEL_NAME}]`).forEach(e=>{e.classList.add(Ge),e.getAttribute("title")&&e.setAttribute(He.BACKUP_TITLE,e.getAttribute("title")),e.setAttribute("title","")}),cs.enable(e),ct.log(2,t,"Border and label's added to personalized experiences")})(t):((e=document)=>{const t="Web Personalisation.previewExperiences";cs.disable||ct.error(2,t,"Preview mode is not enabled"),e.querySelectorAll(`[${He.LABEL_NAME}]`).forEach(e=>{e.classList.remove(Ge),e.removeAttribute("title"),e.getAttribute(He.BACKUP_TITLE)&&(e.setAttribute("title",e.getAttribute(He.BACKUP_TITLE)),e.removeAttribute(He.BACKUP_TITLE))}),cs.disable(e),ct.log(2,t,"Border and label's removed from personalized experiences")})(t)}async renderTabbedExperience(e,t){const n=Es.baseLogTag+".renderTabbedExperience";try{const r=await Ki(e);if(!r){const r=t.map(t=>t.is_ai?Promise.resolve():Es.WebPApis.getTabData(e,t.tab_id).then(async t=>{if(t&&t[e]){const n=t[e]&&t[e].data;return(async(e,t)=>{let n;Ki(e).then(async r=>{r&&(t=t.concat(r)),n=await ht.tabbedExperiences.setItem(e,t)})})(e,n),rs(e,n,!0)}return ct.error(2,n,"No payload found for tabbed experience",e),!1}).catch(t=>{ct.error(2,n,`Failed to get tabbed experience data ${e}:`,t)}));return Promise.all(r)}await rs(e,r,!0)}catch(t){throw ct.error(2,n,`Error in getTabbedData ${e}:`,t),t}}async renderPageTypeExperience(e){const t=Es.baseLogTag+".renderPageTypeExperience";if(e){!function(e){window[xe]=e}(e);try{const e=await async function(){const e="Web Personalisationutils.getPageTypeExperiences";try{const t=await Vi()||[];return t.length?(await Promise.all(t.map(async t=>{try{if(t.page_attributes)return await yr(t)?t:null}catch(n){ct.error(2,e,"Error evaluating page context for experience:",t,n)}return null}))).filter(Boolean):[]}catch(t){throw ct.error(2,e,"Error getting pageType experiences:",t),t}}();let t=!1;return e&&e.forEach(e=>{e&&!Es.appliedExperiences.hasOwnProperty(e.id)&&(e.is_ai=!0,this.handleDomManipulator(e),t=!0)}),t}catch(e){return ct.error(2,t,"Error getting pageType experiences:",e),!1}}return ct.error(2,t,"No pageContext provided"),!1}handleLogoutListener(){window.addEventListener("USER_ACTIONS",e=>{"FORCED_LOGOUT"===e.detail.name&&this.handleWebPLogout(!0)}),window.addEventListener(w.TOPIC_NAME,e=>{e.detail.name===w.EVENT_NAMES.LOGOUT&&this.handleWebPLogout()})}handleWebPLogout(e){const t=Es.baseLogTag+".handleWebPLogout";ct.log(2,t,"Handling WebP logout"),this.resetPageState(),ht.clear(),e&&this.getLiveExperiences()}handleSPA(){window.addEventListener(O.TOPIC_NAME,e=>{e.detail.name===O.EVENT_NAMES.PAGE_CHANGED&&ss(ms.DISABLE_WEBP)&&(this.resetPageState(),this.getLiveExperiences())})}disableWebPersonalization(){window.removeEventListener(O.TOPIC_NAME,this.getLiveExperiences),window.removeEventListener(w.TOPIC_NAME,this.boundIdentityUpdateHandler),Es.failedOperations=[],gs.disconnectObservers(),this.isDomMutationObserverAdded=!1}handleIdentityChange(){window.removeEventListener(w.TOPIC_NAME,this.boundIdentityUpdateHandler),window.addEventListener(w.TOPIC_NAME,this.boundIdentityUpdateHandler)}async identityUpdateHandler(e){const t=Es.baseLogTag+".identityUpdateHandler";e.detail.name===w.EVENT_NAMES.USER_IDENTITY_UPDATE&&(ct.log(2,t,"User identity updated, resetting state and syncing experiences"),this.resetPageState(),ji(),this.syncExperiences())}async fetchExperiences(e=[],t={}){const n=Es.baseLogTag+".fetchExperiences";ct.log(2,n,"Fetching experiences from remote");try{const r=await Es.WebPApis.fetchExperiences(e,t);return r?.experiences?r.experiences:(ct.error(2,n,"No self-handle experiences found"),{})}catch(e){throw ct.error(2,n,"Error fetching self handle experiences: ",e),e}}}window.MoeWebP=new Es})()})();